import u from"../../__snowpack__/pkg/file-saver.js";import w from"../../__snowpack__/pkg/jszip.js";import{fetcher as h}from"./fetch.js";import r from"../../__snowpack__/pkg/lodash/isString.js";import{toast as _}from"../../__snowpack__/pkg/react-toastify.js";async function b(t){const e=await h(t);return e.data instanceof Blob?e.data:r(e)?e:JSON.stringify(e)}function m(t){return t.replace(/[/\\?%*:|"<>]/g,"_")}export function saveFile(t,e){let i;t instanceof Blob?i=t:i=new Blob([t],{type:"text/plain;charset=utf-8"}),u.saveAs(i,m(e))}export default async function(t,e,i="download.zip"){if(!t)return;let l=t,n=e;r(t)&&(l=[t]),r(e)&&(n=[e]);try{const o=await Promise.all(l.map(b));if(o.length===1)saveFile(o[0],n[0]);else{const p=new w;let s="",f="";if(n.length===1){const a=n[0].split(".");a.length>1&&(f=a.pop()),s=a.join(".")}o.forEach((a,c)=>{p.file(m(s?`${s} - ${c}.${f}`:n[c]),a)});const g=await p.generateAsync({type:"blob"});saveFile(g,i)}}catch(o){_.error(o.message,{position:_.POSITION.TOP_CENTER})}}
