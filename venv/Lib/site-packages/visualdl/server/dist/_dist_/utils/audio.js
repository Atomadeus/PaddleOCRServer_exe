export class AudioPlayer{constructor(t){var e;this.source=null,this.buffer=null,this.decodedSampleRate=Number.NaN,this.startAt=0,this.stopAt=0,this.offset=0,this.toggleVolume=100,this.playing=!1,this.options={context:(e=t==null?void 0:t.context)!=null?e:new AudioContext,volume:100,onplay:()=>{},onstop:()=>{},...t},this.contextFromOptions=!!(t==null?void 0:t.context),this.context=this.options.context,this.gain=this.context.createGain(),this.volume=this.options.volume}get current(){return this.playing?this.context.currentTime-this.startAt+this.offset:this.offset}get duration(){return this.buffer?this.buffer.duration:Number.NaN}get sampleRate(){return this.buffer?this.decodedSampleRate:Number.NaN}get volume(){return this.gain.gain.value*100}set volume(t){t>100?t=100:t<0&&(t=0),this.gain.gain.value=t/100}reset(){var t;this.buffer&&(this.playing&&((t=this.source)==null||t.stop(0)),this.startAt=0,this.stopAt=0,this.offset=0,this.buffer=null)}static getWavSampleRate(t){const s=new Int8Array(t).slice(24,28);return s[0]&255|(s[1]&255)<<8|(s[2]&255)<<16|(s[3]&255)<<24}static getMp3SampleRate(t){let e=new Uint8Array(t);if(String.fromCharCode.apply(null,Array.from(e.slice(0,3)))==="ID3"){e=e.slice(10);let r=0;for(;e[r]!==0;){const n=e[r+4]*4294967296+e[r+5]*65536+e[r+6]*256+e[r+7];r+=10+n}}let s=0;for(;e[s++]!==255;);s--;const h=e.slice(s,s+4),o=(h[1]&24)>>3,i=(h[2]&12)>>2;if(o===3){if(i===0)return 44100;if(i===1)return 48e3;if(i===2)return 32e3}else if(o===2){if(i===0)return 22050;if(i===1)return 24e3;if(i===2)return 16e3}else if(o===0){if(i===0)return 11025;if(i===1)return 12e3;if(i===2)return 8e3}return Number.NaN}load(t,e){return this.reset(),e==="wav"?this.decodedSampleRate=AudioPlayer.getWavSampleRate(t):e==="mpga"||e==="mp3"?this.decodedSampleRate=AudioPlayer.getMp3SampleRate(t):this.decodedSampleRate=Number.NaN,new Promise((s,h)=>{this.context.decodeAudioData(t,o=>{this.buffer=o,s()},h)})}play(){if(!this.buffer)throw new Error("No audio loaded");this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gain).connect(this.context.destination),this.source.addEventListener("ended",()=>{this.stopAt=this.context.currentTime,this.offset+=this.stopAt-this.startAt,this.playing=!1,this.options.onstop(),this.source=null}),this.offset>=this.duration&&(this.offset=0),this.source.start(0,this.offset),this.startAt=this.context.currentTime,this.playing=!0,this.options.onplay()}pause(){var t;if(!this.buffer)throw new Error("No audio loaded");(t=this.source)==null||t.stop(0)}toggle(){this.playing?this.pause():this.play()}stop(){this.pause(),this.startAt=0,this.stopAt=0,this.offset=0}seek(t){if(t!=null&&(t<0||t>this.duration))throw new Error("Invalid offset");this.offset=t}toggleMute(){this.volume===0?this.volume=this.toggleVolume||100:(this.toggleVolume=this.volume,this.volume=0)}dispose(){this.reset(),this.contextFromOptions||this.context.close(),this.source=null,this.buffer=null}}
