import{formatTime as _,humanizeDuration as D}from"../../utils/index.js";import{format as P}from"../../../__snowpack__/pkg/d3-format.js";import{xAxisMap as C}from"./index.js";const d=P(".5"),x="inf",A="nan";export const options={legend:{data:[]},tooltip:{position:["10%","100%"]}},chartData=({data:p,rawData:u,ranges:e,runs:m,xAxis:r,smoothedOnly:s})=>p.map((o,a)=>{const z=m[a].label,y=m[a].colors[0],i=m[a].colors[1],n=C[r],w=[];o.forEach((t,c)=>{if(t[2]!=null){const f=c===0?null:o[c-1][2],b=c===o.length-1?null:o[c+1][2];f==null&&b==null&&w.push(c)}});const h=[{name:z,z:m.length+a,itemStyle:{color:y},lineStyle:{color:y},data:o,encode:{x:[n],y:[3]},markPoint:{symbol:"circle",symbolSize:4,itemStyle:{color:"#fff",borderColor:y,borderWidth:1},label:{show:!1},data:w.map(t=>({coord:[o[t][n],o[t][3]]}))}}];if(!s){const t=e[a],c=o.find(l=>l[2]===(t==null?void 0:t.min)),f=o.find(l=>l[2]===(t==null?void 0:t.max));h.push({name:z,z:a,itemStyle:{color:i},lineStyle:{color:i},data:o,encode:{x:[n],y:[2]},markPoint:{symbol:"circle",symbolSize:6,itemStyle:{color:"#fff",borderColor:i,borderWidth:1},label:{show:!1},data:[...w.map(l=>({coord:[o[l][n],o[l][2]],symbol:"circle",symbolSize:4})),...c?[{coord:[c[n],c[2]]}]:[],...f?[{coord:[f[n],f[2]]}]:[]]}});const b=u[a],S=[],N=[];if(b.length===o.length){let l=null;b.forEach(([,V,k],g)=>{g>0&&o[g][2]!=null&&(l=o[g][2]),k===x?S.push([V,l]):k===A&&N.push([V,l])})}h.push({data:S,symbolShow:!1,lineStyle:{width:0,opacity:0},markPoint:{symbol:"rect",symbolSize:6,itemStyle:{color:"#fff",borderColor:i,borderWidth:1},label:{show:!1},data:S.map(l=>({coord:l}))}}),h.push({data:N,symbolShow:!1,lineStyle:{width:0,opacity:0},markPoint:{symbol:"triangle",symbolSize:6,itemStyle:{color:"#fff",borderColor:i,borderWidth:1},label:{show:!1},data:N.map(l=>({coord:l}))}})}return h}).flat(),tooltip=(p,u,e)=>{const m=r=>r===x?"Inf":r===A?"NaN":r==null?"--":d(r);return{columns:[{label:e.t("scalar:smoothed"),width:"5em"},{label:e.t("common:scalar-value"),width:"4.285714286em"},{label:e.t("common:time-mode.step"),width:`${Math.max(u*.571428571,2.857142857)}em`},{label:e.t("scalar:min"),width:"4.285714286em"},{label:e.t("scalar:max"),width:"4.285714286em"},{label:e.t("common:time-mode.wall"),width:"10.714285714em"},{label:e.t("common:time-mode.relative"),width:"4.285714286em"}],data:p.map(({min:r,max:s,item:o,rawItem:a})=>[o[3]==null?"--":d(o[3]),m(a[2]),o[1],d(r!=null?r:Number.NaN),d(s!=null?s:Number.NaN),_(o[0],e.language),D(o[4])])}};
