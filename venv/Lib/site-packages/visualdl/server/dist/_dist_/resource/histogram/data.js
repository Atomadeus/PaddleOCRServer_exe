import{Modes as x}from"./types.js";function g(c,o,r,f=30){o===r&&(r=o*1.1+1,o=o/1.1-1);const s=(r-o)/f,h=[];for(let n=o;n<r;n+=s)h.push(n);let t=0;return h.map(n=>{const a=n+s;let e=0;for(;t<c.length;){const i=Math.min(r,c[t].right),m=Math.max(o,c[t].left),p=Math.min(i,a)-Math.max(m,n),u=p/(i-m)*c[t].count;if(p>0&&(e+=u),i>a)break;t++}return{x:n,dx:s,y:e}})}export function transform({data:c,mode:o}){const r=c.map(([t,n,a])=>({time:t,step:n,min:Math.min(...a.map(e=>e[0])),max:Math.max(...a.map(e=>e[1])),items:a.map(([e,i,m])=>({left:e,right:i,count:m}))})),f=Math.min(...r.map(({min:t})=>t)),s=Math.max(...r.map(({max:t})=>t)),h=r.map(({time:t,step:n,items:a})=>g(a,f,s).map(({x:e,dx:i,y:m})=>[t,n,e+i/2,Math.floor(m)]));if(o===x.Overlay)return{min:f,max:s,data:h};if(o===x.Offset){let t=Infinity,n=-Infinity,a=Infinity,e=-Infinity;const i=h.map(m=>{const p=m[0][1];return p>n&&(n=p),p<t&&(t=p),m.reduce((u,[,,M,l])=>(l>e&&(e=l),l<a&&(a=l),[...u,M,p,l]),[])});return{minX:f,maxX:s,minZ:a,maxZ:e,minStep:t,maxStep:n,data:i}}}
