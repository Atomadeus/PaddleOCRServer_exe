import s,{useCallback as T,useEffect as A,useMemo as l,useState as U}from"../../../__snowpack__/pkg/react.js";import V,{DownloadDataTypes as O,chartSize as f,chartSizeInRem as P}from"../ScalarChart.js";import{XAxis as tt,chartData as et,nearestPoint as at,singlePointRange as $,sortingMethodMap as rt,tooltip as nt,xAxisMap as F}from"../../resource/scalar/index.js";import L from"../Chart.js";import{Chart as q}from"../Loader/ChartPage.js";import{XAxisType as u}from"../LineChart.js";import{cycleFetcher as ot}from"../../utils/fetch.js";import M from"../../../__snowpack__/pkg/query-string.js";import st from"../../utils/saveFile.js";import lt from"../../../__snowpack__/pkg/styled-components.js";import{useRunningRequest as ct}from"../../hooks/useRequest.js";import{useTranslation as it}from"../../../__snowpack__/pkg/react-i18next.js";import y from"../../hooks/useWebAssembly.js";const mt=lt.div`
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
`,pt=({runs:r,tag:i,smoothing:j,xAxis:n,sortingMethod:b,outlier:k,smoothedOnly:C,showMostValue:E,running:z})=>{const{t:I,i18n:S}=it(["scalar","common"]),{data:p,error:W,loading:X}=ct(r.map(t=>`/scalar/list?${M.stringify({run:t.label,tag:i})}`),!!z,(...t)=>ot(t)),c=l(()=>{var t;return(t=p==null?void 0:p.filter(a=>a!=null).slice(0,r.length))!=null?t:[]},[p,r.length]),_=l(()=>n===tt.WallTime?u.time:u.value,[n]),B=l(()=>{var t;return[(t=c.map(a=>{var g;return(g=a.map(m=>[m[0],m[1],Number.isFinite(m[2])?m[2]:null]))!=null?g:[]}))!=null?t:[],j]},[c,j]),{data:h}=y("scalar_transform",B),e=l(()=>h!=null?h:[],[h]),G=l(()=>[e,!!k],[e,k]),{data:w}=y("scalar_axis_range",G),H=l(()=>[e],[e]),{data:o}=y("scalar_range",H),R=l(()=>{let t,a=w;return e.length===1&&e[0].length===1&&([u.value,u.log].includes(_)&&(t=$(e[0][0][F[n]])),a=$(e[0][0][2])),{x:t,y:a}},[e,w,_,n]),[v,J]=U([]);A(()=>{e.length===r.length&&c.length===r.length&&J(et({data:e,rawData:c,ranges:E?o!=null?o:[]:[],runs:r,xAxis:n,smoothedOnly:C}))},[e,c,E,o,r,n,C]);const x=l(()=>String(Math.max(...e.map(t=>Math.max(...t.map(a=>a[1]))))).length,[e]),K=T((t,a)=>{const g=F[n],m=at(e,c,r,g,a).map(d=>({...d,...o==null?void 0:o[r.findIndex(Z=>Z.label===d.run.label)]})),D=rt[b](m,a),{columns:Q,data:Y}=nt(D,x,S);return{runs:D.map(d=>d.run),columns:Q,data:Y}},[n,e,c,r,b,x,S,o]),N=T(t=>{st(r.map(a=>`/scalar/data?${M.stringify({run:a.label,tag:i,type:t})}`),r.map(a=>`visualdl-scalar-${a.label}-${i}.${O[t]}`),`visualdl-scalar-${i}.zip`)},[r,i]);return!v&&W?s.createElement(mt,null,I("common:error")):s.createElement(V,{title:i,data:v,loading:X,xAxisType:_,xRange:R.x,yRange:R.y,getTooltipTableData:K,downloadData:N})};export default pt;export const Loader=()=>s.createElement(s.Fragment,null,s.createElement(L,{...P},s.createElement(q,{width:f.width-2,height:f.height-2})),s.createElement(L,{...P},s.createElement(q,{width:f.width-2,height:f.height-2})));
