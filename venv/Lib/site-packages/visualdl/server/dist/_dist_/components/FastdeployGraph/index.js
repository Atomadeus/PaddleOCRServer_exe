import V from"../../../__snowpack__/pkg/styled-components.js";import t,{useState as f,useEffect as I,useRef as Bt,useCallback as qt}from"../../../__snowpack__/pkg/react.js";import{Graph as Gt,Shape as we}from"../../../__snowpack__/pkg/@antv/x6.js";import{Modal as P,Cascader as Kt}from"../../../__snowpack__/pkg/antd.js";import{toast as M}from"../../../__snowpack__/pkg/react-toastify.js";import{Snapline as Lt}from"../../../__snowpack__/pkg/@antv/x6-plugin-snapline.js";import{Keyboard as Rt}from"../../../__snowpack__/pkg/@antv/x6-plugin-keyboard.js";import{Clipboard as Ut}from"../../../__snowpack__/pkg/@antv/x6-plugin-clipboard.js";import{Export as Yt}from"../../../__snowpack__/pkg/@antv/x6-plugin-export.js";import{DownOutlined as Dt}from"../../../__snowpack__/pkg/@ant-design/icons.js";import{Tree as Ye}from"../../../__snowpack__/pkg/antd.js";import{fetcher as F}from"../../utils/fetch.js";import{useTranslation as Wt}from"../../../__snowpack__/pkg/react-i18next.js";import{History as Ht}from"../../../__snowpack__/pkg/@antv/x6-plugin-history.js";import{MinusCircleOutlined as H,PlusOutlined as Jt,PlusCircleOutlined as ee,VerticalAlignBottomOutlined as te,DeleteOutlined as De}from"../../../__snowpack__/pkg/@ant-design/icons.js";import{Button as Xt,Form as r,Input as E,Select as j,Space as ne}from"../../../__snowpack__/pkg/antd.js";import{isArray as Ce}from"../../../__snowpack__/pkg/lodash.js";const{TreeNode:We}=Ye,Qt=V.div`
    height: 100%;
    .ant-select-selector {
        .ant-select-selection-item {
            .select_icon {
                display: none;
            }
        }
    }
    #container {
        height: 100%;
        display: flex;
        border: 1px solid #dfe3e8;
        .custom-html {
            width: 100%;
            height: 100%;
            border-radius: 1em;
            perspective: 600px;
            text-align: center;
            line-height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            box-shadow: 0 0.125em 0.3125em rgba(0, 0, 0, 0.25), 0 0.02125em 0.06125em rgba(0, 0, 0, 0.25);
        }
    }
    #stencil_content {
        min-width: 180px;
        width: auto;
        height: 100%;
        position: relative;
        border-right: 1px solid #dfe3e8;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        border-left: 1px solid #dfe3e8;
        .stencli_select {
            height: 50px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #dfe3e8;
        }
        #stencil {
            height: 80%;
            .dnd-rect {
                min-width: 100px;
                width: auto;
                height: 40px;
                border: 1px solid #8f8f8f;
                padding-left: 10px;
                padding-right: 10px;
                border-radius: 6px;
                text-align: center;
                line-height: 40px;
                margin: 16px;
                cursor: move;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
        }
        #buttonContent {
            display: flex;
            position: absolute;
            width: 100%;
            bottom: 1%;
            display: flex;
            justify-content: center;
        }
    }
    #graph-container {
        width: calc(100% - 180px);
        height: 100%;
    }
    .x6-widget-stencil {
        background-color: #fff;
    }
    .x6-widget-stencil-title {
        background-color: #fff;
    }
    .x6-widget-stencil-group-title {
        background-color: #fff !important;
    }
    .x6-widget-transform {
        margin: -1px 0 0 -1px;
        padding: 0px;
        border: 1px solid #239edd;
    }
    .x6-widget-transform > div {
        border: 1px solid #239edd;
    }
    .x6-widget-transform > div:hover {
        background-color: #3dafe4;
    }
    .x6-widget-transform-active-handle {
        background-color: #3dafe4;
    }
    .x6-widget-transform-resize {
        border-radius: 0;
    }
    .x6-widget-selection-inner {
        border: 1px solid #239edd;
    }
    .x6-widget-selection-box {
        opacity: 0;
    }
`,Zt=V.div`
    height: 50px;
    width: 100%;
    display: flex;
    align-items: center;
    .ant-select {
        .ant-select-selector {
            height: 100%;
            border: none;
            .ant-select-selection-placeholder {
                line-height: 50px;
            }
            .ant-select-selection-item {
                line-height: 50px;
            }
        }
    }
`,Ie=V.div`
    height: 2.5714285714285716rem;
    line-height: 2.5714285714285716rem;
    text-align: center;
    font-size: 16px;
    margin-left: 2px;
    padding-left: 5px;
    padding-right: 5px;
    min-width: 86px;
    color: white;
    background-color: var(--navbar-background-color);
`,Vt=V(Ie)`
    min-width: 138px;
    height: 32px;
    padding-left: 5px;
    padding-right: 5px;
    line-height: 32px;
    padding-left: 5px;
    padding-right: 5px;
    margin-left: 20px;
`,{Option:oe}=j,le={labelCol:{span:6},wrapperCol:{span:16}},B=["TYPE_BOOL","TYPE_UINT8","TYPE_UINT16","TYPE_UINT32","TYPE_UINT64","TYPE_INT8","TYPE_INT16","TYPE_INT32","TYPE_INT64","TYPE_FP16","TYPE_FP32","TYPE_FP64","TYPE_STRING","TYPE_BF16"],Fe=["KIND_AUTO","KIND_GPU","KIND_CPU","KIND_MODEL"],en=["name","backend","version","maxBatchSize","input","output","instanceGroup","optimization"],tn=({modelData:h,dirValue:_,ChangeServerId:He})=>{var Re,Ue;const[T,q]=f(h),[G,Je]=f(),[Te,Xe]=f(),[v,Oe]=f(),[se,ae]=f({}),z={"server-name":null,"model-repository":"yolov5_serving/models","backend-config":"python,shm-default-byte-size=10485760","http-port":8e3,"grpc-port":8001,"metrics-port":8002,gpus:null},[re,J]=f(!1),[ce,X]=f(!1),[ie,me]=f(!1),[Qe,pe]=f(!1),[Ze,de]=f(!1),[Ve,ue]=f(!1),[et,ge]=f(!1),tt=Bt(null),[fe,nt]=f(),[ye,Q]=f([]),[w,ot]=f(),[k,Ne]=f(),[Z,Me]=f(!1),[lt,$e]=f(!1),[st,Se]=f([]),[A,Pe]=f(),[K,ze]=f(),[he,at]=f(),[x,Ee]=f(),[L,$]=f(),[rt,Ae]=f(!0),[be,xe]=f(),[ct,je]=f([]),[C]=r.useForm(),[R]=r.useForm(),[U]=r.useForm(),[Y]=r.useForm(),[Be,it]=f();console.log("form",C.getFieldsValue(!0));const[D,O]=f((Re=h==null?void 0:h.ensembles)==null?void 0:Re.versions),{t:p,i18n:mt}=Wt(["Fastdeploy"]),ke=mt.language,pt={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{id:"top",group:"top"},{id:"bottom",group:"bottom"}]};I(()=>{const e=new Gt({container:document.getElementById("graph-container"),grid:!0,mousewheel:{enabled:!0,zoomAtMousePosition:!0,minScale:.5,maxScale:3},panning:!0,connecting:{router:{name:"manhattan",args:{padding:1}},connector:{name:"rounded",args:{radius:8}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,snap:{radius:20},createEdge(){return new we.Edge({attrs:{line:{stroke:"#A2B1C3",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},zIndex:0})},validateConnection({targetMagnet:n}){return!!n}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}}});e.on("node:dblclick",({node:n})=>{at({name:n.id})}),Oe(e),Je(!0)},[]),I(()=>{!G||!v||dt(v)},[G]),I(()=>{Te&&v&&ut(v)},[Te]),I(()=>{var e,n;if(!!h){if(console.log("modelData.ensembles",h==null?void 0:h.ensembles),(h==null?void 0:h.ensembles.length)===0)Ee(""),Se([]);else{const l=(e=h==null?void 0:h.ensembles)==null?void 0:e.map(o=>({value:o.name,label:o.name}));Se(l),Ee((n=h.ensembles[0])==null?void 0:n.name)}q(h)}},[h]),I(()=>{var n,l,o,a;if(x===void 0||!h)return;console.log("modelData.ensembles",h.ensembles);const e=(n=h.ensembles)==null?void 0:n.filter(i=>{if(i.name===x)return i});if(e==null?void 0:e.length)if(Pe((l=e[0])==null?void 0:l.step),(o=e[0])==null?void 0:o.versions){const i=N((a=e[0])==null?void 0:a.versions),u=i==null?void 0:i.map(s=>({...s,selectable:!0,icon:t.createElement(te,null)}));O(u)}else O([]);else Pe([]),O([])},[x]),I(()=>{if(!G||!A)return;v==null||v.clearCells();const e={};A==null||A.map(s=>{const d=s.inputModels;for(const g of d){let c=e[g];c||(c={from:[],to:[]},e[g]=c),c.to.push(s.modelName)}const m=s.outputModels;for(const g of m){let c=e[g];c||(c={from:[],to:[]},e[g]=c),c.from.push(s.modelName)}});const n=[],l=[];for(const s of Object.keys(e)){l.push({id:`${s}`,width:60,height:40,label:s});const d=e[s];for(const m of d.to)n.push({source:s,target:m});console.log("nodes",l),console.log("edges",n)}const o=[];for(const s of n)o.push({source:{cell:s.source,connectionPoint:{name:"boundary",args:{sticky:!0}}},target:{cell:s.target,connectionPoint:"boundary"},inherit:"edge",attrs:{line:{stroke:"#5755a1"}},defaultLabel:{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{label:{fill:"black",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},body:{ref:"label",fill:"white",stroke:"#5755a1",strokeWidth:2,rx:4,ry:4,refWidth:"140%",refHeight:"140%",refX:"-20%",refY:"-20%"}},position:{distance:100,options:{absoluteDistance:!0}}}});const a=[],i={};let u=0;for(const s of A){const d=s.modelName;d.length>u&&(u=d.length),i[d]={x:s.pos_x,y:s.pos_y,lengths:d.length}}for(let s=0;s<l.length;s++){const d=l[s],m=i[d==null?void 0:d.id];we.HTML.register({shape:d.id,width:10+u*10,height:40,html(){const g=document.createElement("div"),c=document.createTextNode(d.id);return g.className="custom-html",g.appendChild(c),g}}),a.push({id:d.id,shape:d.id,size:{width:10+u*10,height:40},x:300+m.x*90,y:50+m.y*80,ports:pt})}console.log("nodess",a,we.HTML.shapeMaps),v==null||v.fromJSON({nodes:a,edges:o}),Oe(v)},[A,G]);const dt=e=>{e.use(new Yt),e.use(new Lt({enabled:!0,sharp:!0})),e.use(new Rt({enabled:!0})),e.use(new Ut({enabled:!0})),e.use(new Ht({enabled:!0})),Xe(!0)},N=e=>e==null?void 0:e.map(l=>{let o="";return l.children&&(o=N(l.children)),o?{...l,children:o,selectable:!1}:{...l,selectable:!1}}),qe=(e,n)=>{for(let l=0,o=e.length;l<o;l=l+1)e[l].style.visibility=n?"visible":"hidden"},ut=e=>{e.bindKey(["meta+c","ctrl+c"],()=>{const n=e.getSelectedCells();return n.length&&e.copy(n),!1}),e.bindKey(["meta+x","ctrl+x"],()=>{const n=e.getSelectedCells();return n.length&&e.cut(n),!1}),e.bindKey(["meta+v","ctrl+v"],()=>{if(!e.isClipboardEmpty()){const n=e.paste({offset:32});e.cleanSelection(),e.select(n)}return!1}),e.bindKey(["meta+z","ctrl+z"],()=>(e.canUndo()&&e.undo(),!1)),e.bindKey(["meta+shift+z","ctrl+shift+z"],()=>(e.canRedo()&&e.redo(),!1)),e.bindKey(["meta+a","ctrl+a"],()=>{const n=e.getNodes();n&&e.select(n)}),e.bindKey("backspace",()=>{const n=e.getSelectedCells();n.length&&e.removeCells(n)}),e.bindKey(["ctrl+1","meta+1"],()=>{e.zoom()<1.5&&e.zoom(.1)}),e.bindKey(["ctrl+2","meta+2"],()=>{e.zoom()>.5&&e.zoom(-.1)}),e.on("node:mouseenter",()=>{const l=document.getElementById("graph-container").querySelectorAll(".x6-port-body");qe(l,!0)}),e.on("node:mouseleave",()=>{const l=document.getElementById("graph-container").querySelectorAll(".x6-port-body");qe(l,!1)})},Ge=(e,n,l)=>{let o=[];const a={name:e,dir:n,config:JSON.stringify(l)};a.config_filename=C.getFieldValue("config_filenames");for(const i in a){const u=encodeURIComponent(i),s=encodeURIComponent(a[i]);o.push(u+"="+s)}o=o.join("&"),F("/fastdeploy/config_update",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:o}).then(i=>{console.log("blobres",i),q(l),J(!1);const u=ke==="zh"?`${e} \u66F4\u65B0\u914D\u7F6E\u6210\u529F`:`Update ${e} configuration successfully`;M.success(u,{autoClose:2e3})},i=>{console.log("blobres",i)})},gt=()=>{J(!0)},ft=()=>{if(!rt){M.error(p("Fastdeploy:Backup-config"),{autoClose:2e3});return}C==null||C.validateFields().then(async e=>{var s,d,m,g;const n=T,l=(s=e.cpuExecutionAccelerator)==null?void 0:s.map(c=>{const b={};if(c.parameters)for(const y of c.parameters)b[y.key]=y.value;return{name:c.name,parameters:b}}),o=(d=e.gpuExecutionAccelerator)==null?void 0:d.map(c=>{const b={};if(c.parameters)for(const y of c.parameters)b[y.key]=y.value;return{name:c.name,parameters:b}}),a=e.input.map(c=>{const y=Ce(c.dims)?c.dims:c.dims.split(",");return{...c,dims:y}}),i=e.output.map(c=>{const y=Ce(c.dims)?c.dims:c.dims.split(",");return{...c,dims:y}}),u=e.instanceGroup.map(c=>{if(c.gpus){const y=Ce(c.gpus)?c.gpus:c.gpus.split(",");return{...c,gpus:y}}else return{...c}});if(k){console.log("values",e);const c=(m=T.ensembles)==null?void 0:m.map(b=>{if(b.name===x){const y={...b,...e,input:a,output:i,instanceGroup:u,optimization:{cpuExecutionAccelerator:l,gpuExecutionAccelerator:o}};return delete y.cpuExecutionAccelerator,delete y.gpuExecutionAccelerator,y}else return b});n.ensembles=c,console.log("ModelDatas",n),Ge(x,_,n)}else{const c=(g=n.models)==null?void 0:g.map(b=>{if(b.name===w){const y={...b,...e,input:a,output:i,instanceGroup:u,optimization:{cpuExecutionAccelerator:l,gpuExecutionAccelerator:o}},S=y.instanceGroup.map(W=>W.kind!=="KIND_CPU"&&W.kind!=="KIND_MODEL"?W:{count:W.count,gpus:void 0,kind:W.kind});return y.instanceGroup=S,delete y.cpuExecutionAccelerator,delete y.gpuExecutionAccelerator,y}else return b});n.models=c,console.log("ModelDatas",n),Ge(w,_,n)}}).catch(e=>{console.log("errorInfo",e)})},yt=()=>{R==null||R.validateFields().then(e=>{const n={...e,default_model_name:x};Be&&(n["ensemble-img"]=Be);let l=[];const o={config:JSON.stringify(n)};for(const a in o){const i=encodeURIComponent(a),u=encodeURIComponent(o[a]);l.push(i+"="+u)}l=l.join("&"),console.log("formBody",l),F("/fastdeploy/start_server",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:l}).then(a=>{console.log("resss",a),He(a),X(!1),M.success(p("Fastdeploy:Launch-server-successfully"),{autoClose:2e3})},a=>{console.log(a),X(!1)})}).catch(e=>{alert(e)})},ht=()=>{U==null||U.validateFields().then(e=>{console.log("valuesssss",e);const n=e.models[e.models.length-1];F(`/fastdeploy/download_pretrain_model?dir=${_}&name=${k?x:w}&version=${be}&pretrain_model_name=${n}`).then(o=>{var s,d;const a=T;if(k){console.log("values",e);const m=(s=T.ensembles)==null?void 0:s.map(g=>g.name===x?{...g,versions:o}:g);a.ensembles=m}else{const m=(d=a.models)==null?void 0:d.map(g=>g.name===w?{...g,versions:o}:g);a.models=m}const i=N(o),u=i==null?void 0:i.map(m=>({...m,selectable:!0}));C.setFields([{name:"versions",value:o}]),O(u),q(a),je([]),me(!1),$(null),M.success(p("Download-successfully"),{autoClose:2e3})},o=>{console.log(o),J(!1),$(null)})}).catch(e=>{alert(e)})},Et=()=>{const e=k?x:w,n=C.getFieldValue("config_filenames");F(`/fastdeploy/set_default_config_for_model?dir=${_}&name=${e}&config_filename=${n}`).then(l=>{console.log("set_default_config_for_model",l),pe(!1),F(`/fastdeploy/get_config_filenames_for_model?dir=${_}&name=${e}`).then(o=>{Q(o),M.success(p("Set-successfully"),{autoClose:2e3}),n!=="config.pbtxt"&&ve("config.pbtxt")})},l=>{console.log(l)})},bt=()=>{F(`/fastdeploy/delete_resource_for_model?dir=${_}&name=${k?x:w}&version=${be}&resource_filename=${L}`).then(n=>{var i,u;const l=T;if(k){const s=(i=T.ensembles)==null?void 0:i.map(d=>d.name===x?{...d,versions:n}:d);l.ensembles=s}else{const s=(u=l.models)==null?void 0:u.map(d=>d.name===w?{...d,versions:n}:d);l.models=s}const o=N(n),a=o==null?void 0:o.map(s=>({...s,selectable:!0}));C.setFields([{name:"versions",value:n}]),O(a),q(l),de(!1),M.success(p("Delete-resource-successfully"),{autoClose:2e3})},n=>{console.log(n)})},xt=()=>{Y==null||Y.validateFields().then(e=>{console.log("valuesssss",e);const n=e.new_filename;F(`/fastdeploy/rename_resource_for_model?dir=${_}&name=${k?x:w}&version=${be}&new_filename=${n}&resource_filename=${L}`).then(o=>{var s,d;const a=T;if(k){const m=(s=T.ensembles)==null?void 0:s.map(g=>g.name===x?{...g,versions:o}:g);a.ensembles=m}else{const m=(d=a.models)==null?void 0:d.map(g=>g.name===w?{...g,versions:o}:g);a.models=m}const i=N(o),u=i==null?void 0:i.map(m=>({...m,selectable:!0}));C.setFields([{name:"versions",value:o}]),O(u),q(a),ue(!1),Y.setFields([{name:"new_filename",value:""}]),M.success(p("Rename-successfully"),{autoClose:2e3})},o=>{console.log(o)})})},kt=async()=>{F(`/fastdeploy/delete_config_for_model?dir=${_}&name=${k?x:w}&config_filename=${L}`).then(n=>{console.log("delete_config",n),Q(n),ve(n[0]),ge(!1),M.success(p("Delete-config-successfully"),{autoClose:2e3})})},_t=()=>{J(!1),K&&ze(void 0)},vt=()=>{X(!1)},wt=()=>{$(null),me(!1)},Ct=()=>{pe(!1)},It=()=>{de(!1)},Ft=()=>{ue(!1)},Tt=()=>{ge(!1)},Ot=e=>{console.log("selected",e),$(e),xe(e),F("/fastdeploy/get_pretrain_model_list").then(n=>{je(n),me(!0)})},Nt=e=>{$(e),ge(!0)},Mt=e=>{console.log("selected",e,D);let n="";for(const l of D){if(l.key===e){n=l.key;return}if(l.children){for(const o of l.children)if(o.key===e){n=l.key,$(e),xe(n),de(!0);return}}}},$t=e=>{console.log("selected",e);let n="";for(const l of D){if(l.key===e){n=l.key;return}if(l.children){for(const o of l.children)if(o.key===e){n=l.key,$(e),xe(n),ue(!0);return}}}},_e=e=>{var i,u,s,d;const n=(u=(i=e==null?void 0:e.optimization)==null?void 0:i.cpuExecutionAccelerator)==null?void 0:u.map(m=>{const g=Object.keys(m),c=m[g[1]]&&Object.keys(m[g[1]]),b=c==null?void 0:c.map(y=>{var S;return{key:y,value:(S=m==null?void 0:m.parameters)==null?void 0:S[y]}});return{name:m.name,parameters:b}}),l=(d=(s=e==null?void 0:e.optimization)==null?void 0:s.gpuExecutionAccelerator)==null?void 0:d.map(m=>{const g=Object.keys(m),c=m[g[1]]&&Object.keys(m[g[1]]),b=c==null?void 0:c.map(y=>{var S;return{key:y,value:(S=m==null?void 0:m.parameters)==null?void 0:S[y]}});return{name:m.name,parameters:b}}),o={...e,cpuExecutionAccelerator:n,gpuExecutionAccelerator:l},a=[];if(o==null?void 0:o.instanceGroup)for(const m of o==null?void 0:o.instanceGroup)m.kind!=="KIND_CPU"&&m.kind!=="KIND_MODEL"?a.push(!0):a.push(!1);ae(a);for(const m of en)o[m]||(o[m]=void 0);console.log("modelss",o),C.setFieldsValue(o)},St=e=>{R.setFieldsValue(e)},Pt=()=>{U.setFieldsValue({models:[]})},Ke=(e,n)=>{if(ot(n),nt(e),e==null?void 0:e.versions){const o=N(e==null?void 0:e.versions),a=o==null?void 0:o.map(i=>({...i,selectable:!0,icon:t.createElement(te,null)}));O(a)}else O([]);k&&Ne(!1),Me(!Z)},zt=()=>{Ne(!0),Me(!Z)},At=e=>{Ee(e)},Le=qt(e=>e&&e.length>0?e.map(n=>n.children?t.createElement(We,{key:n.key,title:t.createElement("div",{style:{display:"flex",alignItems:"center"}},t.createElement("div",{style:{marginRight:"20px"}},n.title),t.createElement(te,{onClick:()=>{Ot(n.key)}}))},Le(n.children)):t.createElement(We,{key:n.key,title:t.createElement("div",{style:{display:"flex",alignItems:"center"}},t.createElement("div",{style:{marginRight:"20px"},onClick:()=>{$t(n.key)}},n.title),t.createElement(De,{onClick:()=>{Mt(n.key)}}))})):[],[D]);I(()=>{!G||gt()},[Z]),I(()=>{!K||Ke(K.data,K.name)},[K]),I(()=>{if(re&&h){if(!k)F(`/fastdeploy/get_config_filenames_for_model?dir=${_}&name=${w}`).then(e=>{Q(e),fe&&_e(fe)});else for(const e of h.ensembles)if(e.name===x){if(e==null?void 0:e.versions){const n=N(e==null?void 0:e.versions),l=n==null?void 0:n.map(o=>({...o,selectable:!0}));O(l)}else O([]);F(`/fastdeploy/get_config_filenames_for_model?dir=${_}&name=${x}`).then(n=>{Q(n),_e(e)});return}}},[re,fe,k]),I(()=>{if(ce&&_){St({"server-name":z["server-name"],"backend-config":z["backend-config"],"metrics-port":z["metrics-port"],"http-port":z["http-port"],"grpc-port":z["grpc-port"],"model-repository":_,gpus:z.gpus});const e=`.custom-html {
                width: 100%;
                height: 100%;
                border-radius: 1em;
                perspective: 600px;
                text-align: center;
                line-height: 40px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                box-shadow: 0 0.125em 0.3125em rgba(0, 0, 0, 0.25), 0 0.02125em 0.06125em rgba(0, 0, 0, 0.25);
            }`;v&&v.toPNG(n=>{console.log("dataUri",n),it(n)},{copyStyles:!0,preserveDimensions:!0,stylesheet:e,padding:50})}},[_,ce]),I(()=>{ie&&Pt()},[ie]),I(()=>{if(!he)return;const e=he.name;for(const n of h.models)if(n.name===e){ze({name:n.name,data:n});return}},[he]);const jt=()=>{pe(!0)},ve=e=>{F(`/fastdeploy/get_config_for_model?dir=${_}&name=${k?x:w}&config_filename=${e}`).then(l=>{C.setFields([{name:"versions",value:l.versions}]);const o=N(l==null?void 0:l.versions),a=o==null?void 0:o.map(i=>({...i,selectable:!0,icon:t.createElement(te,null)}));O(a),$e(!1),l&&_e(l),e.includes("vdlbackup")?Ae(!1):Ae(!0)})};return console.log("graphssss"),console.log("showFlag",Z),t.createElement(Qt,{style:{height:"100%",width:"100%"}},t.createElement("div",{id:"container"},t.createElement("div",{id:"graph-container"}),t.createElement("div",{id:"stencil_content"},t.createElement("div",{className:"stencli_select"},t.createElement(Zt,null,t.createElement(j,{style:{width:"100%",height:"50px"},placeholder:"Search to Select",optionFilterProp:"children",value:x,options:st,onChange:e=>{At(e)}}))),t.createElement("div",{id:"stencil",ref:tt},h&&((Ue=T==null?void 0:T.models)==null?void 0:Ue.map(e=>t.createElement("div",{"data-type":e.name,className:"dnd-rect",key:e.name,onClick:()=>{Ke(e,e.name)}},e.name)))),t.createElement("div",{id:"buttonContent"},t.createElement(Ie,{style:{position:"absolute",left:ke==="zh"?"-180px":"-200px",minWidth:"160px"},onClick:zt},p("Fastdeploy:ensemble-configuration")),t.createElement(Ie,{style:{width:"160px"},onClick:()=>{X(!0)}},p("Fastdeploy:launch-server"))))),t.createElement(P,{width:800,title:p(k?"Fastdeploy:Ensemble-configuration":"Fastdeploy:Model-configuration"),visible:re,cancelText:p("Fastdeploy:cancel"),okText:p("Fastdeploy:update"),onOk:ft,onCancel:_t},t.createElement(r,{...le,form:C,name:"dynamic_form_complex",autoComplete:"off"},t.createElement(r.Item,{label:"config_filenames"},t.createElement("div",{style:{display:"flex"}},t.createElement(r.Item,{name:"config_filenames",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}],style:{marginBottom:"0px",width:ke==="zh"?"340px":"316px"}},t.createElement(j,{onChange:e=>{ve(e)},onDropdownVisibleChange:()=>{$e(!0)}},ye==null?void 0:ye.map(e=>t.createElement(oe,{key:e,value:e},t.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},t.createElement("div",{title:e,style:{overflow:"hidden",width:"298px",whiteSpace:"nowrap",textOverflow:"ellipsis"}},e),t.createElement(De,{style:{display:lt?"nomal":"none"},onClick:()=>{Nt(e)}})))))),t.createElement(Vt,{onClick:jt},p("Fastdeploy:set-as-launch-config")))),t.createElement(r.Item,{name:"name",label:"name",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,{disabled:!0})),k?t.createElement(r.Item,{name:"platform",label:"platform",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,{disabled:!0})):t.createElement(r.Item,{name:"backend",label:"backend",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,{disabled:!0})),t.createElement(r.Item,{name:"versions",label:"versions"},t.createElement(Ye,{showLine:!0,showIcon:!0,switcherIcon:t.createElement(Dt,null),defaultExpandedKeys:["0-0-0"]},Le(D))),t.createElement(r.Item,{name:"maxBatchSize",label:"maxBatchSize"},t.createElement(E,null)),t.createElement(r.Item,{label:"input"},t.createElement(r.List,{name:"input"},e=>t.createElement("div",null,e==null?void 0:e.map((n,l)=>t.createElement("div",{key:n.key},t.createElement("div",{style:{display:"flex",marginBottom:"10px",paddingTop:l?"10px":"40px",alignItems:"center"}},t.createElement("div",{style:{marginRight:"10px"}},`${p("Fastdeploy:variable")}${l+1}`)),t.createElement("div",{key:n.key},t.createElement(r.Item,{...n,label:"name",labelCol:{span:4},name:[n.name,"name"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{...n,label:"dataType",labelCol:{span:4},name:[n.name,"dataType"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(j,null,B==null?void 0:B.map(o=>t.createElement(oe,{key:o,value:o},o)))),t.createElement(r.Item,{...n,label:"dims",labelCol:{span:4},name:[n.name,"dims"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)))))))),t.createElement("div",null),t.createElement(r.Item,{label:"output"},t.createElement(r.List,{name:"output"},e=>t.createElement("div",null,e==null?void 0:e.map((n,l)=>t.createElement("div",{key:n.key},t.createElement("div",{style:{display:"flex",marginBottom:"10px",paddingTop:l?"10px":"40px",alignItems:"center"}},t.createElement("div",{style:{marginRight:"10px"}},`${p("Fastdeploy:variable")}${l+1}`)),t.createElement("div",{key:n.key},t.createElement(r.Item,{...n,label:"name",labelCol:{span:4},name:[n.name,"name"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{...n,label:"dataType",labelCol:{span:4},name:[n.name,"dataType"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(j,null,B==null?void 0:B.map(o=>t.createElement(oe,{key:o,value:o},o)))),t.createElement(r.Item,{...n,label:"dims",labelCol:{span:4},name:[n.name,"dims"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)))))))),t.createElement(r.Item,{label:"instanceGroup"},t.createElement(r.List,{name:"instanceGroup"},(e,{add:n,remove:l})=>t.createElement("div",null,e==null?void 0:e.map((o,a)=>t.createElement("div",{key:o.key},t.createElement("div",{style:{display:"flex",marginBottom:"10px",paddingTop:a?"10px":"40px",alignItems:"center"}},t.createElement("div",{style:{marginRight:"10px"}},`${p("Fastdeploy:instance")}${a+1}`),t.createElement(H,{onClick:()=>l(o.name)})),t.createElement("div",{key:o.key},t.createElement(r.Item,{...o,label:"count",labelCol:{span:4},name:[o.name,"count"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{...o,label:"kind",labelCol:{span:4},name:[o.name,"kind"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(j,{onChange:i=>{console.log("valuess",i);const u=[...se];i!=="KIND_CPU"&&i!=="KIND_MODEL"?u[a]||(u[a]=!0):u[a]&&(u[a]=!1),ae(u)}},Fe==null?void 0:Fe.map(i=>t.createElement(oe,{key:i,value:i},i)))),se[a]&&t.createElement(r.Item,{...o,label:"gpus",labelCol:{span:4},name:[o.name,"gpus"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null))))),t.createElement(r.Item,null,t.createElement(Xt,{type:"dashed",onClick:()=>{const o=[...se,!0];ae(o),n()},block:!0,icon:t.createElement(Jt,null)},"Add sights"))))),t.createElement(r.Item,{name:"optimization",label:"optimization"},t.createElement("div",null,t.createElement(r.List,{name:"cpuExecutionAccelerator"},(e,{add:n,remove:l})=>t.createElement("div",null,t.createElement("div",{style:{display:"flex",marginBottom:"10px",paddingTop:"40px",alignItems:"center"}},t.createElement("div",{style:{marginRight:"10px"}},"cpuExecutionAccelerator"),t.createElement(ee,{onClick:()=>n()})),e==null?void 0:e.map(o=>t.createElement(ne,{align:"baseline",key:o.key},t.createElement("div",null,t.createElement("div",{style:{display:"flex"}},t.createElement(r.Item,{name:[o.name,"name"],fieldKey:[o.name,"name"],label:"name",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(H,{style:{marginLeft:"10px",marginTop:"10px"},onClick:()=>l(o.name)})),t.createElement(r.Item,null,t.createElement(r.List,{name:[o.name,"parameters"],key:o.key},(a,{add:i,remove:u})=>t.createElement("div",{style:{paddingLeft:"60px"}},t.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px"}},t.createElement("div",{style:{marginRight:"10px"}},"parameters"),t.createElement(ee,{onClick:()=>i()})),a==null?void 0:a.map(s=>t.createElement(ne,{align:"baseline",key:s.key},t.createElement(r.Item,{...s,name:[s.name,"key"],fieldKey:[s.name,"key"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{...s,name:[s.name,"value"],fieldKey:[s.name,"value"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(H,{onClick:()=>u(s.name)})))))))))))),t.createElement("div",null,t.createElement(r.List,{name:"gpuExecutionAccelerator"},(e,{add:n,remove:l})=>t.createElement("div",null,t.createElement("div",{style:{display:"flex",marginBottom:"10px",paddingTop:"40px",alignItems:"center"}},t.createElement("div",{style:{marginRight:"10px"}},"gpuExecutionAccelerator"),t.createElement(ee,{onClick:()=>n()})),e==null?void 0:e.map(o=>t.createElement(ne,{align:"baseline",key:o.key},t.createElement("div",null,t.createElement("div",{style:{display:"flex"}},t.createElement(r.Item,{name:[o.name,"name"],fieldKey:[o.name,"name"],label:"name",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(H,{style:{marginLeft:"10px",marginTop:"10px"},onClick:()=>l(o.name)})),t.createElement(r.Item,null,t.createElement(r.List,{name:[o.name,"parameters"],key:o.key},(a,{add:i,remove:u})=>t.createElement("div",{style:{paddingLeft:"60px"}},t.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px"}},t.createElement("div",{style:{marginRight:"10px"}},"parameters"),t.createElement(ee,{onClick:()=>i()})),a==null?void 0:a.map(s=>t.createElement(ne,{align:"baseline",key:s.key},t.createElement(r.Item,{...s,name:[s.name,"key"],fieldKey:[s.name,"key"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{...s,name:[s.name,"value"],fieldKey:[s.name,"value"],rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(H,{onClick:()=>u(s.name)}))))))))))))))),t.createElement(P,{width:800,title:p("Fastdeploy:Launch-parameters-configuration"),cancelText:p("Fastdeploy:cancel"),okText:p("Fastdeploy:launch"),visible:ce,onOk:yt,onCancel:vt},t.createElement(r,{...le,form:R,name:"dynamic_form_complex",autoComplete:"off"},t.createElement(r.Item,{name:"server-name",label:"server-name"},t.createElement(E,null)),t.createElement(r.Item,{name:"model-repository",label:"model-repository",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,{disabled:!0})),t.createElement(r.Item,{name:"backend-config",label:"backend-config",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{name:"http-port",label:"http-port",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{name:"grpc-port",label:"grpc-port",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{name:"metrics-port",label:"metrics-port",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(E,null)),t.createElement(r.Item,{name:"gpus",label:"gpus"},t.createElement(E,null)))),t.createElement(P,{width:800,title:p("Fastdeploy:Download-pre-trained-model"),cancelText:p("Fastdeploy:cancel"),okText:p("Fastdeploy:ok"),visible:ie,onOk:ht,onCancel:wt},t.createElement(r,{...le,form:U,name:"dynamic_form_complex",autoComplete:"off"},t.createElement(r.Item,{name:"models",label:p("Fastdeploy:Pre-trained"),rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}]},t.createElement(Kt,{options:ct,placeholder:"Please select"})))),t.createElement(P,{width:800,title:p("Fastdeploy:set-as-launch-config"),cancelText:p("Fastdeploy:cancel"),okText:p("Fastdeploy:ok"),visible:Qe,onOk:Et,onCancel:Ct},p("Fastdeploy:The-config")),t.createElement(P,{width:800,title:p("Fastdeploy:Delete-resource-file"),cancelText:p("Fastdeploy:cancel"),okText:p("Fastdeploy:ok"),visible:Ze,onOk:bt,onCancel:It},`${p("Fastdeploy:Confirm-delete-resource")} ${L}`),t.createElement(P,{width:800,title:p("Fastdeploy:Rename-resource-file"),cancelText:p("Fastdeploy:cancel"),okText:p("Fastdeploy:ok"),visible:Ve,onOk:xt,onCancel:Ft},t.createElement(r,{...le,form:Y,name:"dynamic_form_complex",autoComplete:"off"},t.createElement(r.Item,{name:"new_filename",label:"\u65B0\u6587\u4EF6\u540D",rules:[{required:!0,message:"\u8BE5\u5B57\u6BB5\u4E3A\u5FC5\u586B\u9879\u8BF7\u586B\u5199\u5BF9\u5E94\u4FE1\u606F"}],style:{marginBottom:"0px"}},t.createElement(E,null)))),t.createElement(P,{width:800,title:p("Fastdeploy:Delete-config-file"),cancelText:p("Fastdeploy:cancel"),okText:p("Fastdeploy:ok"),visible:et,onOk:kt,onCancel:Tt},`${p("Fastdeploy:Confirm-delete-config")} ${L}`))};export default tn;
