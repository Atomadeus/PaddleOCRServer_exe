import y,{AsideSection as a}from"../components/Aside.js";import Se from"../components/GraphPage/GraphDynamic.js";import e,{useCallback as s,useEffect as X,useMemo as F,useRef as Y,useState as r}from"../../__snowpack__/pkg/react.js";import Ce from"../components/Select.js";import{actions as ke,selectors as we}from"../store/index.js";import{rem as S}from"../utils/style.js";import{useDispatch as je,useSelector as De}from"../../__snowpack__/pkg/react-redux.js";import xe from"../components/Check.js";import N from"../components/Button.js";import C from"../components/Checkbox.js";import be from"../components/Content.js";import c from"../components/Field.js";import ve from"../components/GraphPage/ModelPropertiesDialog.js";import Ge from"../components/GraphPage/NodeDocumentationSidebar.js";import _e from"../components/GraphPage/NodePropertiesSidebar.js";import Z from"../components/RadioButton.js";import ye from"../components/RadioGroup.js";import Fe from"../components/GraphPage/Search.js";import Ne from"../components/Title.js";import Pe from"../components/GraphPage/Uploader.js";import k from"../../__snowpack__/pkg/styled-components.js";import{fetcher as ee}from"../utils/fetch.js";import{useTranslation as Re}from"../../__snowpack__/pkg/react-i18next.js";const te=k(N)`
    width: 100%;
`,Me=k(Ce)`
    width: 100%;
`,Ie=k.div`
    display: flex;
    justify-content: space-between;

    > * {
        flex: 1 1 auto;

        &:not(:last-child) {
            margin-right: ${S(20)};
        }
    }
`,ze=k(a)`
    max-height: calc(100% - ${S(40)});
    display: flex;
    flex-direction: column;

    &:not(:last-child) {
        padding-bottom: 0;
    }
`,Ae=()=>{const{t:n}=Re(["graph","common"]),P=je(),oe=De(we.graph.model),l=Y(null),i=Y(null),[R,ne]=r(oe),[w,M]=r(0),[m,re]=r(),[j,I]=r(""),[z,le]=r(!1),A=s(t=>{P(ke.graph.setModel(t)),ne(t)},[P]),p=s(()=>{i.current&&(i.current.value="",i.current.click())},[]),ae=t=>{const o=t.target;if(o.files[0].name.split(".")[1]!=="pdmodel"){alert("\u8BE5\u9875\u9762\u53EA\u80FD\u89E3\u6790paddle\u7684\u6A21\u578B,\u5982\u9700\u89E3\u6790\u8BF7\u8DF3\u8F6C\u7F51\u7EDC\u7ED3\u6784\u9759\u6001\u56FE\u9875\u9762");return}o&&o.files&&o.files.length&&se(o.files)},se=t=>{const o=new FormData;o.append("file",t[0]),o.append("filename",t[0].name),ee("/graph/upload",{method:"POST",body:o}).then(E=>{console.log("res",E);const _=w+1;M(_)},E=>{console.log("errres",E);const _=w+1;M(_)})},[D,ce]=r([]),[B,T]=r(""),ie=s(t=>{ce(t.graphs),T(t.selected||"")},[]),U=s(t=>{var o;T(t),(o=l.current)==null||o.changeGraph(t)},[]),[O,x]=r(""),[d,W]=r(!1),[K,$]=r({text:"",result:[]}),H=s(t=>{var o;x(t),(o=l.current)==null||o.search(t)},[]),q=s(t=>{var o;x(t.name),(o=l.current)==null||o.select(t)},[]),[h,me]=r(!1),[u,pe]=r(!0),[g,de]=r(!1),[b,he]=r(!1),[ue,J]=r(null),[f,L]=r(null),[v,G]=r(null);X(()=>{ee("/graph_runs").then(t=>{const o=t;re(o),I(o[0])})},[w]),X(()=>{x(""),$({text:"",result:[]})},[R,h,u,g]);const Q=F(()=>d?null:e.createElement(te,{type:"primary",rounded:!0,onClick:p},n("graph:change-model")),[n,p,d]),[V,ge]=r(!1),fe=F(()=>V?v?e.createElement(y,{width:S(360)},e.createElement(Ge,{data:v,onClose:()=>G(null)})):f?e.createElement(y,{width:S(360)},e.createElement(_e,{data:f,onClose:()=>L(null),showNodeDocumentation:()=>{var t;return(t=l.current)==null?void 0:t.showNodeDocumentation(f)}})):e.createElement(y,{bottom:Q},e.createElement(ze,null,e.createElement(Fe,{text:O,data:K,onChange:H,onSelect:q,onActive:()=>W(!0),onDeactive:()=>W(!1)})),!d&&e.createElement(e.Fragment,null,e.createElement(a,null,e.createElement(te,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.showModelProperties()}},n("graph:model-properties"))),D.length>1&&e.createElement(a,null,e.createElement(c,{label:n("graph:subgraph")},e.createElement(Me,{list:D,value:B,onChange:U}))),e.createElement(a,null,e.createElement(c,{label:n("graph:display-data")},e.createElement("div",null,e.createElement(C,{checked:h,onChange:me},n("graph:show-attributes"))),e.createElement("div",null,e.createElement(C,{checked:u,onChange:pe},n("graph:show-initializers"))),e.createElement("div",null,e.createElement(C,{checked:g,onChange:de},n("graph:show-node-names"))),e.createElement("div",null,e.createElement(C,{checked:z,onChange:le},n("graph:keep-expanded"))))),e.createElement(a,null,e.createElement(c,{label:n("graph:direction")},e.createElement(ye,{value:b,onChange:he},e.createElement(Z,{value:!1},n("graph:vertical")),e.createElement(Z,{value:!0},n("graph:horizontal"))))),e.createElement(a,null,e.createElement(c,{label:n("graph:export-file")},e.createElement(Ie,null,e.createElement(N,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.export("png")}},n("graph:export-png")),e.createElement(N,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.export("svg")}},n("graph:export-svg"))))),e.createElement(a,null,e.createElement(c,{label:n("graph:Choose-model")},e.createElement("div",{className:"run-list"},m&&m.map((t,o)=>e.createElement("div",{key:o},e.createElement(xe,{checked:j===t,value:t,title:t,onChange:()=>{I(t)}},e.createElement("span",{className:"run-item"},t.split("/")[t.split("/").length-1]))))))))):null,[n,Q,O,m,d,K,j,D,B,U,H,q,h,u,g,b,V,f,v]),Ee=F(()=>e.createElement(Pe,{onClickUpload:p,onDropFiles:A}),[p,A]);return e.createElement(e.Fragment,null,e.createElement(Ne,null,n("common:graph")),e.createElement(ve,{data:ue,onClose:()=>J(null)}),e.createElement(be,{aside:fe},e.createElement(Se,{ref:l,files:R,uploader:Ee,showAttributes:h,showInitializers:u,showNames:g,isKeepData:z,horizontal:b,selectedRuns:j,onRendered:()=>ge(!0),onOpened:ie,onSearch:t=>$(t),onShowModelProperties:t=>J(t),runs:m,onShowNodeProperties:t=>{L(t),G(null)},onShowNodeDocumentation:t=>G(t)}),e.createElement("input",{ref:i,type:"file",multiple:!1,onChange:ae,style:{display:"none"}})))};export default Ae;
