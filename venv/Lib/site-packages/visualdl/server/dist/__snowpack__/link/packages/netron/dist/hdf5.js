var hdf5=hdf5||{},long=long||{Long:require("long")},zip=zip||require("./zip");hdf5.File=class{constructor(t){const e=new hdf5.Reader(t,0);if(this._globalHeap=new hdf5.GlobalHeap(e),!e.match("Â‰HDF\r\n\n"))throw new hdf5.Error("Not a valid HDF5 file.");const s=e.byte();switch(s){case 0:case 1:{if(this._freeSpaceStorageVersion=e.byte(),this._rootGroupEntryVersion=e.byte(),e.skip(1),this._sharedHeaderMessageVersionFormat=e.byte(),e.initialize(),e.skip(1),this._groupLeafNodeK=e.uint16(),this._groupInternalNodeK=e.uint16(),e.skip(4),s>0&&(this._indexedStorageInternalNodeK=e.uint16(),this.seek(2)),this._baseAddress=e.offset(),e.offset(),this._endOfFileAddress=e.offset(),e.offset(),0!=this._baseAddress)throw new hdf5.Error("Base address is not zero.");const t=new hdf5.SymbolTableEntry(e);this._rootGroup=new hdf5.Group(e,t,null,this._globalHeap,"","");break}case 2:case 3:{e.initialize(),e.byte(),this._baseAddress=e.offset(),this._superBlockExtensionAddress=e.offset(),this._endOfFileAddress=e.offset();const t=new hdf5.DataObjectHeader(e.at(e.offset()));this._rootGroup=new hdf5.Group(e,null,t,this._globalHeap,"","");break}default:throw new hdf5.Error("Unsupported Superblock version "+s+".")}}get rootGroup(){return this._rootGroup}},hdf5.Group=class{constructor(t,e,s,i,a,r){this._reader=t,this._entry=e,this._dataObjectHeader=s,this._globalHeap=i,this._name=r,this._path="/"==a?a+r:a+"/"+r}get name(){return this._name}get path(){return this._path}group(t){this._decodeGroups();const e=t.indexOf("/");if(-1!=e){const s=t.substring(e+1),i=t.substring(0,e),a=this.group(i);if(null!=a)return a.group(s)}else{const e=this._groupMap[t];if(e)return e}return null}get groups(){return this._decodeGroups(),this._groups}attribute(t){return this._decodeDataObject(),this._attributes[t]}get attributes(){return this._decodeDataObject(),this._attributes}get value(){return this._decodeDataObject(),this._value}_decodeDataObject(){if(this._dataObjectHeader||(this._dataObjectHeader=new hdf5.DataObjectHeader(this._reader.at(this._entry.objectHeaderAddress))),!this._attributes){this._attributes={};for(const t of this._dataObjectHeader.attributes){const e=t.name,s=t.decodeValue(this._globalHeap);this._attributes[e]=s}this._value=null;const t=this._dataObjectHeader.datatype,e=this._dataObjectHeader.dataspace,s=this._dataObjectHeader.dataLayout,i=this._dataObjectHeader.filterPipeline;t&&e&&s&&(this._value=new hdf5.Variable(this._reader,this._globalHeap,t,e,s,i))}}_decodeGroups(){if(!this._groups)if(this._groupMap={},this._groups=[],this._entry){if(this._entry.treeAddress||this._entry.heapAddress){const t=new hdf5.Heap(this._reader.at(this._entry.heapAddress)),e=new hdf5.Tree(this._reader.at(this._entry.treeAddress));for(const s of e.nodes)for(const e of s.entries){const s=t.getString(e.linkNameOffset),i=new hdf5.Group(this._reader,e,null,this._globalHeap,this._path,s);this._groups.push(i),this._groupMap[s]=i}}}else{this._decodeDataObject();for(const t of this._dataObjectHeader.links)if(Object.prototype.hasOwnProperty.call(t,"objectHeaderAddress")){const e=t.name,s=new hdf5.DataObjectHeader(this._reader.at(t.objectHeaderAddress)),i=new hdf5.Group(this._reader,null,s,this._globalHeap,this._path,e);this._groups.push(i),this._groupMap[e]=i}}}},hdf5.Variable=class{constructor(t,e,s,i,a,r){this._reader=t,this._globalHeap=e,this._datatype=s,this._dataspace=i,this._dataLayout=a,this._filterPipeline=r}get type(){return this._datatype.type}get littleEndian(){return this._datatype.littleEndian}get shape(){return this._dataspace.shape}get value(){const t=this.data;if(t){const e=new hdf5.Reader(t),s=this._dataspace.read(this._datatype,e);return this._dataspace.decode(this._datatype,s,s,this._globalHeap)}return null}get data(){switch(this._dataLayout.layoutClass){case 1:if(this._dataLayout.address)return this._reader.at(this._dataLayout.address).bytes(this._dataLayout.size);break;case 2:{const t=new hdf5.Tree(this._reader.at(this._dataLayout.address),this._dataLayout.dimensionality);if(2==this._dataLayout.dimensionality&&1==this._dataspace.shape.length){let e=this._dataLayout.datasetElementSize;for(let t=0;t<this._dataspace.shape.length;t++)e*=this._dataspace.shape[t];const s=new Uint8Array(e);for(const e of t.nodes){if(2!==e.fields.length||0!==e.fields[1])return null;if(0!==e.filterMask)return null;const t=e.fields[0]*this._dataLayout.datasetElementSize;let i=e.data;if(this._filterPipeline)for(const t of this._filterPipeline.filters)i=t.decode(i);for(let e=0;e<i.length;e++)s[t+e]=i[e]}return s}break}default:throw new hdf5.Error("Unknown data layout class '"+this.layoutClass+"'.")}return null}},hdf5.Reader=class{constructor(t){t&&(this._buffer=t,this._dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),this._position=0,this._offset=0)}initialize(){this._offsetSize=this.byte(),this._lengthSize=this.byte()}skip(t){if(this._offset+=t,this._position+this._offset>this._buffer.length)throw new hdf5.Error("Expected "+(this._position+this._offset-this._buffer.length)+" more bytes. The file might be corrupted. Unexpected end of file.")}int8(){const t=this._offset;return this.skip(1),this._dataView.getInt8(this._position+t)}byte(){const t=this._offset;return this.skip(1),this._dataView.getUint8(this._position+t)}bytes(t){const e=this._offset;return this.skip(t),this._buffer.subarray(this._position+e,this._position+this._offset)}int16(){const t=this._offset;return this.skip(2),this._dataView.getInt16(this._position+t,!0)}uint16(){const t=this._offset;return this.skip(2),this._dataView.getUint16(this._position+t,!0)}int32(){const t=this._offset;return this.skip(4),this._dataView.getInt32(this._position+t,!0)}uint32(){const t=this._offset;return this.skip(4),this._dataView.getUint32(this._position+t,!0)}int64(){const t=this._offset;this.skip(8);const e=this._dataView.getUint32(this._position+t,!0),s=this._dataView.getUint32(this._position+t+4,!0);return new long.Long(e,s,!1).toNumber()}uint64(){const t=this._offset;this.skip(8);const e=this._dataView.getUint32(this._position+t,!0),s=this._dataView.getUint32(this._position+t+4,!0);return new long.Long(e,s,!0).toNumber()}uint(t){switch(t){case 0:return this.byte();case 1:return this.uint16();case 2:return this.uint32();case 3:return this.uint64()}}float16(){const t=this._offset;this.skip(2);const e=this._dataView.getUint16(this._position+t,!0),s=(32768&e)>>15,i=(31744&e)>>10,a=1023&e;return 0==i?(s?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==i?a?NaN:1/0*(s?-1:1):(s?-1:1)*Math.pow(2,i-15)*(1+a/Math.pow(2,10))}float32(){const t=this._offset;return this.skip(4),this._dataView.getFloat32(this._position+t,!0)}float64(){const t=this._offset;return this.skip(8),this._dataView.getFloat64(this._position+t,!0)}string(t,e){if(!t||-1==t){let e=this._position+this._offset;for(;0!=this._buffer[e];)e++;t=e-this._position-this._offset+1}const s=this.bytes(t);return hdf5.Reader.decode(s,e)}static decode(t,e){let s="";return"utf-8"==e?(hdf5.Reader._utf8Decoder||(hdf5.Reader._utf8Decoder=new TextDecoder("utf-8")),s=hdf5.Reader._utf8Decoder.decode(t)):(hdf5.Reader._asciiDecoder||(hdf5.Reader._asciiDecoder=new TextDecoder("ascii")),s=hdf5.Reader._asciiDecoder.decode(t)),s.replace(/\0/g,"")}offset(){switch(this._offsetSize){case 8:{const t=this.uint32(),e=this.uint32();if(4294967295===t&&4294967295===e)return;return new long.Long(t,e,!0).toNumber()}case 4:{const t=this.uint32();if(4294967295===t)return;return t}}throw new hdf5.Error("Unsupported offset size '"+this._offsetSize+"'.")}length(){switch(this._lengthSize){case 8:{const t=this.uint32(),e=this.uint32();if(4294967295===t&&4294967295===e)return;return new long.Long(t,e,!0).toNumber()}case 4:{const t=this.uint32();if(4294967295===t)return;return t}}throw new hdf5.Error("Unsupported length size '"+this._lengthSize+"'.")}at(t){const e=new hdf5.Reader(null);return e._buffer=this._buffer,e._dataView=this._dataView,e._position=t,e._offset=0,e._offsetSize=this._offsetSize,e._lengthSize=this._lengthSize,e}clone(){const t=new hdf5.Reader(this._buffer,this._position);return t._buffer=this._buffer,t._dataView=this._dataView,t._position=this._position,t._offset=this._offset,t._offsetSize=this._offsetSize,t._lengthSize=this._lengthSize,t}align(t){this._offset%t!=0&&(this._offset=(Math.floor(this._offset/t)+1)*t)}match(t){if(this._position+this._offset+t.length>this._buffer.length)return!1;const e=this._offset,s=this.bytes(t.length);for(let i=0;i<t.length;i++)if(t.charCodeAt(i)!=s[i])return this._offset=e,!1;return!0}get position(){return this._position+this._offset}get size(){return this._buffer.length}},hdf5.SymbolTableNode=class{constructor(t){if(!t.match("SNOD"))throw new hdf5.Error("Not a valid 'SNOD' block.");const e=t.byte();if(1!=e)throw new hdf5.Error("Unsupported symbol table node version '"+e+"'.");{t.skip(1);const e=t.uint16();this.entries=[];for(let s=0;s<e;s++)this.entries.push(new hdf5.SymbolTableEntry(t))}}},hdf5.SymbolTableEntry=class{constructor(t){this.linkNameOffset=t.offset(),this.objectHeaderAddress=t.offset();const e=t.uint32();switch(t.skip(4),e){case 0:break;case 1:{const e=t.clone();this.treeAddress=e.offset(),this.heapAddress=e.offset();break}default:throw new hdf5.Error("Unsupported cache type '"+e+"'.")}t.skip(16)}},hdf5.DataObjectHeader=class{constructor(t){this.attributes=[],this.links=[],this.continuations=[];const e=(t.match("OHDR"),t.byte());switch(e){case 1:{t.skip(1);const e=t.uint16();t.uint32();const s=t.uint32();t.align(8);let i=t.position+s;for(let s=0;s<e;s++){const e=t.uint16(),s=t.uint16(),a=t.byte();if(t.skip(3),t.align(8),(!this._readMessage(t,e,s,a)||t.position>=i)&&this.continuations.length>0){const e=this.continuations.shift();t=t.at(e.offset),i=e.offset+e.length}else t.align(8)}break}case 2:{const e=t.byte();0!=(32&e)&&(t.uint32(),t.uint32(),t.uint32(),t.uint32()),0!=(16&e)&&(t.uint16(),t.uint16());const s=t.uint(3&e);let i=!0,a=t.position+s;for(;i&&t.position<a;){const s=t.byte(),r=t.uint16(),n=t.byte();if(t.position<a&&(0!=(4&e)&&t.uint16(),i=this._readMessage(t,s,r,n)),(!i||t.position>=a)&&this.continuations.length>0){const e=this.continuations.shift();if(t=t.at(e.offset),a=e.offset+e.length,!t.match("OCHK"))throw new hdf5.Error("Invalid continuation block signature.");i=!0}}break}default:throw new hdf5.Error("Unsupported data object header version '"+e+"'.")}}_readMessage(t,e,s,i){switch(e){case 0:return!1;case 1:this.dataspace=4!=s||1!=i?new hdf5.Dataspace(t.clone()):null;break;case 2:this.linkInfo=new hdf5.LinkInfo(t.clone());break;case 3:this.datatype=new hdf5.Datatype(t.clone());break;case 4:case 5:this.fillValue=new hdf5.FillValue(t.clone(),e);break;case 6:this.links.push(new hdf5.Link(t.clone()));break;case 8:this.dataLayout=new hdf5.DataLayout(t.clone());break;case 10:this.groupInfo=new hdf5.GroupInfo(t.clone());break;case 11:this.filterPipeline=new hdf5.FilterPipeline(t.clone());break;case 12:this.attributes.push(new hdf5.Attribute(t.clone()));break;case 13:this.comment=t.string(-1,"ascii");break;case 16:this.continuations.push(new hdf5.ObjectHeaderContinuation(t.clone()));break;case 17:this.symbolTable=new hdf5.SymbolTable(t.clone());break;case 14:case 18:this.objectModificationTime=new hdf5.ObjectModificationTime(t.clone(),e);break;case 21:this.attributeInfo=new hdf5.AttributeInfo(t.clone());break;default:throw new hdf5.Error("Unsupported message type '"+e+"'.")}return t.skip(s),!0}},hdf5.Message=class{constructor(t,e,s){this._type=t,this._data=e,this._flags=s}},hdf5.Dataspace=class{constructor(t){this._sizes=[];const e=t.byte();switch(e){case 1:this._dimensions=t.byte(),this._flags=t.byte(),t.skip(1),t.skip(4);for(let e=0;e<this._dimensions;e++)this._sizes.push(t.length());if(0!=(1&this._flags)){this._maxSizes=[];for(let e=0;e<this._dimensions;e++)if(this._maxSizes.push(t.length()),this._maxSizes[e]!=this._sizes[e])throw new hdf5.Error("Max size is not supported.")}if(0!=(2&this._flags))throw new hdf5.Error("Permutation indices not supported.");break;case 2:this._dimensions=t.byte(),this._flags=t.byte(),this._type=t.byte();for(let e=0;e<this._dimensions;e++)this._sizes.push(t.length());if(0!=(1&this._flags)){this._maxSizes=[];for(let e=0;e<this._dimensions;e++)this._maxSizes.push(t.length())}break;default:throw new hdf5.Error("Unsupported dataspace message version '"+e+"'.")}}get shape(){return this._sizes}read(t,e){return 0==this._dimensions?t.read(e):this._readArray(t,e,this._sizes,0)}_readArray(t,e,s,i){const a=[],r=s[i];if(i==s.length-1)for(let s=0;s<r;s++)a.push(t.read(e));else for(let n=0;n<r;n++)a.push(this._readArray(t,e,s,i+1));return a}decode(t,e,s){return 0==this._dimensions?t.decode(e,s):this._decodeArray(t,e,s,this._sizes,0)}_decodeArray(t,e,s,i,a){const r=i[a];if(a==i.length-1)for(let i=0;i<r;i++)e[i]=t.decode(e[i],s);else for(let s=0;s<r;s++)e[s]=this._decodeArray(t,e[s],i,a+1);return e}},hdf5.LinkInfo=class{constructor(t){const e=t.byte();switch(e){case 0:{const e=t.byte();0!=(1&e)&&(this.maxCreationIndex=t.uint64()),this.fractalHeapAddress=t.offset(),this.nameIndexTreeAddress=t.offset(),0!=(2&e)&&(this.creationOrderIndexTreeAddress=t.offset());break}default:throw new hdf5.Error("Unsupported link info message version '"+e+"'.")}}},hdf5.Datatype=class{constructor(t){const e=t.byte(),s=e>>4;switch(this._class=15&e,s){case 1:case 2:switch(this._flags=t.byte()|t.byte()<<8|t.byte()<<16,this._size=t.uint32(),this._class){case 0:this._bitOffset=t.uint16(),this._bitPrecision=t.uint16();break;case 8:{this._base=new hdf5.Datatype(t),this._names=[],this._values=[];const e=65535&this._flags;for(let s=0;s<e;s++){const e=t.clone().string(-1,"ascii");this._names.push(e),t.skip(8*Math.round((e.length+1)/8))}for(let s=0;s<e;s++)this._values.push(this._base.read(t));break}}break;default:throw new hdf5.Error("Unsupported datatype version '"+s+"'.")}}get type(){switch(this._class){case 0:if(0==(65526&this._flags))if(0!==(this._flags&&8))switch(this._size){case 1:return"int8";case 2:return"int16";case 4:return"int32";case 8:return"int64"}else switch(this._size){case 1:return"uint8";case 2:return"uint16";case 4:return"uint32";case 8:return"uint64"}break;case 1:if(2==this._size&&3872==this._flags)return"float16";if(4==this._size&&7968==this._flags)return"float32";if(8==this._size&&16160==this._flags)return"float64";break;case 3:return"string";case 5:return"uint8[]";case 8:if("int8"===this._base.type&&2===this._names.length&&"FALSE"===this._names[0]&&"TRUE"===this._names[1]&&2===this._values.length&&0===this._values[0]&&1===this._values[1])return"boolean";break;case 9:if(1==(15&this._flags))return"char[]"}throw new hdf5.Error("Unsupported datatype class '"+this._class+"'.")}get littleEndian(){switch(this._class){case 0:case 1:return 0==(1&this.flags)}return!0}read(t){switch(this._class){case 0:if(1==this._size)return 0!=(8&this._flags)?t.int8():t.byte();if(2==this._size)return 0!=(8&this._flags)?t.int16():t.uint16();if(4==this._size)return 0!=(8&this._flags)?t.int32():t.uint32();if(8==this._size)return 0!=(8&this._flags)?t.int64():t.uint64();throw new hdf5.Error("Unsupported fixed-point datatype.");case 1:if(2==this._size&&3872==this._flags)return t.float16();if(4==this._size&&7968==this._flags)return t.float32();if(8==this._size&&16160==this._flags)return t.float64();throw new hdf5.Error("Unsupported floating-point datatype.");case 3:switch(this._flags>>8&15){case 0:return hdf5.Reader.decode(t.bytes(this._size),"ascii");case 1:return hdf5.Reader.decode(t.bytes(this._size),"utf-8")}throw new hdf5.Error("Unsupported character encoding.");case 5:return t.bytes(this._size);case 9:return{length:t.uint32(),globalHeapID:new hdf5.GlobalHeapID(t)}}throw new hdf5.Error("Unsupported datatype class '"+this._class+"'.")}decode(t,e){switch(this._class){case 0:case 1:case 3:case 5:return t;case 9:{const s=e.get(t.globalHeapID);if(null!=s){switch(this._flags>>8&15){case 0:return hdf5.Reader.decode(s.data,"ascii");case 1:return hdf5.Reader.decode(s.data,"utf-8")}throw new hdf5.Error("Unsupported character encoding.")}break}default:throw new hdf5.Error("Unsupported datatype class '"+this._class+"'.")}return null}},hdf5.FillValue=class{constructor(t,e){switch(e){case 4:{const e=t.uint32();this.data=t.bytes(e);break}case 5:default:{const e=t.byte();switch(e){case 1:case 2:{t.byte(),t.byte();const s=t.byte();if(1===e||1===s){const e=t.uint32();this.data=t.bytes(e)}break}default:throw new hdf5.Error("Unsupported fill value version '"+e+"'.")}break}}}},hdf5.Link=class{constructor(t){const e=t.byte();switch(e){case 1:{const e=t.byte();this.type=0!=(8&e)?t.byte():0,0!=(4&e)&&(this.creationOrder=t.uint32());const s=0!=(16&e)&&1==t.byte()?"utf-8":"ascii";switch(this.name=t.string(t.uint(3&e),s),this.type){case 0:this.objectHeaderAddress=t.offset()}break}default:throw new hdf5.Error("Unsupported link message version '"+e+"'.")}}},hdf5.DataLayout=class{constructor(t){const e=t.byte();switch(e){case 1:case 2:switch(this.dimensionality=t.byte(),this.layoutClass=t.byte(),t.skip(5),this.layoutClass){case 1:this.address=t.offset(),this.dimensionSizes=[];for(let e=0;e<this.dimensionality-1;e++)this.dimensionSizes.push(t.int32());break;case 2:this.address=t.offset(),this.dimensionSizes=[];for(let e=0;e<this.dimensionality-1;e++)this.dimensionSizes.push(t.int32());this.datasetElementSize=t.int32();break;default:throw new hdf5.Error("Unsupported data layout class '"+this.layoutClass+"'.")}break;case 3:switch(this.layoutClass=t.byte(),this.layoutClass){case 1:this.address=t.offset(),this.size=t.length();break;case 2:this.dimensionality=t.byte(),this.address=t.offset(),this.dimensionSizes=[];for(let e=0;e<this.dimensionality-1;e++)this.dimensionSizes.push(t.int32());this.datasetElementSize=t.int32();break;case 0:default:throw new hdf5.Error("Unsupported data layout class '"+this.layoutClass+"'.")}break;default:throw new hdf5.Error("Unsupported data layout version '"+e+"'.")}}},hdf5.GroupInfo=class{constructor(t){const e=t.byte();switch(e){case 0:{const e=t.byte();0!=(1&e)&&(this.maxCompactLinks=t.uint16(),this.minDenseLinks=t.uint16()),0!=(2&e)&&(this.estimatedEntriesNumber=t.uint16(),this.estimatedLinkNameLengthEntires=t.uint16());break}default:throw new hdf5.Error("Unsupported group info version '"+e+"'.")}}},hdf5.FilterPipeline=class{constructor(t){const e=t.byte();switch(e){case 1:{this.filters=[];const e=t.byte();t.skip(2),t.skip(4);for(let s=0;s<e;s++)this.filters.push(new hdf5.Filter(t)),t.align(8);break}default:throw new hdf5.Error("Unsupported filter pipeline message version '"+e+"'.")}}},hdf5.Filter=class{constructor(t){this.id=t.int16();const e=t.int16();this.flags=t.int16();const s=t.int16();this.name=t.string(e,"ascii"),this.clientData=t.bytes(4*s)}decode(t){switch(this.id){case 1:{const e=t.subarray(2,t.length);return(new zip.Inflater).inflateRaw(e)}default:throw hdf5.Error("Unsupported filter '"+this.name+"'.")}}},hdf5.Attribute=class{constructor(t){const e=t.byte();switch(e){case 1:{t.skip(1);const e=t.uint16(),s=t.uint16(),i=t.uint16();this.name=t.string(e,"utf-8"),t.align(8),this._datatype=new hdf5.Datatype(t.clone()),t.skip(s),t.align(8),this._dataspace=new hdf5.Dataspace(t.clone()),t.skip(i),t.align(8),this._data=this._dataspace.read(this._datatype,t);break}case 3:{t.byte();const e=t.uint16(),s=t.uint16(),i=t.uint16(),a=1==t.byte()?"utf-8":"ascii";this.name=t.string(e,a),this._datatype=new hdf5.Datatype(t.clone()),t.skip(s),this._dataspace=new hdf5.Dataspace(t.clone()),t.skip(i),this._data=this._dataspace.read(this._datatype,t);break}default:throw new hdf5.Error("Unsupported attribute message version '"+e+"'.")}}decodeValue(t){return this._data?this._dataspace.decode(this._datatype,this._data,t):null}},hdf5.ObjectHeaderContinuation=class{constructor(t){this.offset=t.offset(),this.length=t.length()}},hdf5.SymbolTable=class{constructor(t){this._treeAddress=t.offset(),this._heapAddress=t.offset()}},hdf5.ObjectModificationTime=class{constructor(t,e){switch(e){case 14:this.year=t.uint32(),this.month=t.uint16(),this.day=t.uint16(),this.hour=t.uint16(),this.minute=t.uint16(),this.second=t.uint16(),t.skip(2);break;case 18:{const e=t.byte();switch(t.skip(3),e){case 1:this.timestamp=t.uint32();break;default:throw new hdf5.Error("Unsupported object modification time message version '"+e+"'.")}break}}}},hdf5.AttributeInfo=class{constructor(t){const e=t.byte();switch(e){case 0:{const e=t.byte();0!=(1&e)&&(this.maxCreationIndex=t.uint64()),this.fractalHeapAddress=t.offset(),this.attributeNameTreeAddress=t.offset(),0!=(2&e)&&(this.attributeCreationOrderTreeAddress=t.offset());break}default:throw new hdf5.Error("Unsupported attribute info message version '"+e+"'.")}}},hdf5.Tree=class{constructor(t,e){if(!t.match("TREE"))throw new hdf5.Error("Not a valid 'TREE' block.");this.type=t.byte(),this.level=t.byte();const s=t.uint16();switch(t.offset(),t.offset(),this.nodes=[],this.type){case 0:for(let e=0;e<s;e++){t.length();const e=t.offset();if(0==this.level)this.nodes.push(new hdf5.SymbolTableNode(t.at(e)));else{const s=new hdf5.Tree(t.at(e));this.nodes=this.nodes.concat(s.nodes)}}break;case 1:for(let i=0;i<s;i++){const s=t.int32(),i=t.int32(),a=[];for(let s=0;s<e;s++)a.push(t.uint64());const r=t.offset();if(0==this.level){const e=t.at(r).bytes(s);this.nodes.push({data:e,fields:a,filterMask:i})}else{const s=new hdf5.Tree(t.at(r),e);this.nodes=this.nodes.concat(s.nodes)}}break;default:throw new hdf5.Error("Unsupported B-Tree node type '"+this.type+"'.")}}},hdf5.Heap=class{constructor(t){if(this._reader=t,!t.match("HEAP"))throw new hdf5.Error("Not a valid 'HEAP' block.");const e=t.byte();switch(e){case 0:t.skip(3),this._dataSize=t.length(),this._offsetToHeadOfFreeList=t.length(),this._dataAddress=t.offset();break;default:throw new hdf5.Error("Unsupported Local Heap version '"+e+"'.")}}getString(t){return this._reader.at(this._dataAddress+t).string(-1,"utf-8")}},hdf5.GlobalHeap=class{constructor(t){this._reader=t,this._collections=new Map}get(t){const e=t.address;return this._collections.has(e)||this._collections.set(e,new hdf5.GlobalHeapCollection(this._reader.at(e))),this._collections.get(t.address).getObject(t.objectIndex)}},hdf5.GlobalHeapCollection=class{constructor(t){const e=t.position;if(!t.match("GCOL"))throw new hdf5.Error("Not a valid 'GCOL' block.");const s=t.byte();switch(s){case 1:{t.skip(3),this._objects=new Map;const s=e+t.length();for(;t.position<s;){const e=t.uint16();if(0==e)break;this._objects.set(e,new hdf5.GlobalHeapObject(t)),t.align(8)}break}default:throw new hdf5.Error("Unsupported global heap collection version '"+s+"'.")}}getObject(t){return this._objects.has(t)?this._objects.get(t):null}},hdf5.GlobalHeapObject=class{constructor(t){t.uint16(),t.skip(4),this.data=t.bytes(t.length())}},hdf5.GlobalHeapID=class{constructor(t){this.address=t.offset(),this.objectIndex=t.uint32()}},hdf5.Error=class extends Error{constructor(t){super(t),this.name="HDF5 Error"}},"undefined"!=typeof module&&"object"==typeof module.exports&&(module.exports.File=hdf5.File);