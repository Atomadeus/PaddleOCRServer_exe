var cntk=cntk||{},long=long||{Long:require("long")},protobuf=protobuf||require("./protobuf"),cntk_v1={},cntk_v2=null;cntk.ModelFactory=class{match(t){const e=t.identifier.split(".").pop().toLowerCase();if("model"==e||"cmf"==e||"dnn"==e||"cntk"==e){const e=t.buffer,n=[138,10,108,252,156,70,249,32,106,168,80,25];if(e&&e.length>14&&128==e[0]&&n.every(((t,n)=>t==e[n+2])))return!1;if(e&&e.length>=8&&66==e[0]&&0==e[1]&&67==e[2]&&0==e[3]&&78==e[4]&&0==e[5]&&0==e[6]&&0==e[7])return!0;const i=t.tags("pb");return 0===i.get(1)&&2===i.get(2)}}open(t,e){return e.require("./cntk-proto").then((()=>{let n=0,i=null;try{const e=t.buffer;e&&e.length>=8&&66==e[0]&&0==e[1]&&67==e[2]&&0==e[3]&&78==e[4]&&0==e[5]&&0==e[6]&&0==e[7]&&(i=new cntk_v1.ComputationNetwork(e),n=1)}catch(e){throw new cntk.Error("File format is not CNTK v1 ("+e.message+") in '"+t.identifier+"'.")}try{if(!i){(cntk_v2=protobuf.get("cntk").CNTK.proto).PoolingType={0:"Max",1:"Average"};const e=protobuf.Reader.create(t.buffer),s=cntk_v2.Dictionary.decode(e);i=cntk.ModelFactory._convertDictionary(s),n=2}}catch(e){throw new cntk.Error("File format is not cntk.Dictionary ("+e.message+") in '"+t.identifier+"'.")}return cntk.Metadata.open(e).then((t=>{try{return new cntk.Model(t,n,i)}catch(t){throw new cntk.Error(t.message)}}))}))}static _convertDictionary(t){const e={};for(const n of Object.keys(t.data).filter((t=>"version"!=t)))e[n]=cntk.ModelFactory._convertDictionaryValue(t.data[n]);return e}static _convertDictionaryValue(t){switch(t.value_type){case cntk_v2.DictionaryValue.Type.Bool:return t.bool_value;case cntk_v2.DictionaryValue.Type.Int:return t.int_value;case cntk_v2.DictionaryValue.Type.SizeT:return t.size_t_value;case cntk_v2.DictionaryValue.Type.Float:return t.float_value;case cntk_v2.DictionaryValue.Type.Double:return t.double_value;case cntk_v2.DictionaryValue.Type.String:return t.string_value;case cntk_v2.DictionaryValue.Type.Vector:return cntk.ModelFactory._convertVectorValue(t.vector_value);case cntk_v2.DictionaryValue.Type.NDShape:return t.nd_shape_value;case cntk_v2.DictionaryValue.Type.Axis:return t.axis_value;case cntk_v2.DictionaryValue.Type.Dictionary:return cntk.ModelFactory._convertDictionary(t.dictionary_value);case cntk_v2.DictionaryValue.Type.NDArrayView:return t.nd_array_view_value}throw new cntk.Error("Unknown dictionary value type '"+t.value_type.toString()+"'.")}static _convertVectorValue(t){return t.value.map((t=>cntk.ModelFactory._convertDictionaryValue(t)))}},cntk.Model=class{constructor(t,e,n){switch(e){case 1:this._format="CNTK v1"+(n.version?"."+n.version.toString():"");break;case 2:this._format="CNTK v2"}this._graphs=[],this._graphs.push(new cntk.Graph(t,e,n))}get graphs(){return this._graphs}get format(){return this._format}},cntk.Graph=class{constructor(t,e,n){this._inputs=[],this._outputs=[],this._nodes=[],this._functions=[];const i={};switch(e){case 1:for(const t of Object.keys(n.nodes)){const s=n.nodes[t];switch(s.__type__){case"InputValue":this._inputs.push(new cntk.Parameter(s.name,[new cntk.Argument(e,s)]));break;case"LearnableParameter":i[s.name]=new cntk.Argument(e,s)}}for(const s of Object.keys(n.nodes)){const o=n.nodes[s];"InputValue"!=o.__type__&&"LearnableParameter"!=o.__type__&&this._nodes.push(new cntk.Node(t,e,o,i))}if(n.output)for(const t of n.output)this._outputs.push(new cntk.Parameter(t,[new cntk.Argument(e,t)]));break;case 2:{const s=new Map;for(const t of n.primitive_functions)s.set(t.uid,t);for(const t of n.inputs){const n=new cntk.Argument(e,t);if(i[t.uid]=n,0==t.kind){const e=t.name||t.uid;this._inputs.push(new cntk.Parameter(e,[n]))}}for(const o of n.primitive_functions)if(57==o.op&&o.block_function_composite){const n=[o.block_function_composite.root],a=[];for(;n.length>0;){const o=n.shift();if(s.has(o)){const r=s.get(o);a.push(new cntk.Node(t,e,r,i)),s.delete(o);for(let t=0;t<r.inputs.length;t++){const e=r.inputs[t].split("_");e.length>=3&&(e.pop(),"Output"==e.pop()&&n.push(e.join("_")))}}}const r=[],u=[o.block_function_composite.root];this._functions.push(new cntk.Function(o.block_function_op_name,a,r,u))}for(const o of n.primitive_functions)s.has(o.uid)&&this._nodes.push(new cntk.Node(t,e,o,i));break}default:throw new cntk.Error("Unsupported graph version '"+e+"'.")}}get nodes(){return this._nodes}get functions(){return this._functions}get inputs(){return this._inputs}get outputs(){return this._outputs}},cntk.Function=class{constructor(t,e,n,i){this._name=t,this._inputs=n,this._outputs=i,this._nodes=e}get name(){return this._name}get description(){return""}get inputs(){return this._inputs}get outputs(){return this._outputs}get nodes(){return this._nodes}},cntk.Parameter=class{constructor(t,e){this._name=t,this._arguments=e}get name(){return this._name}get visible(){return!0}get arguments(){return this._arguments}},cntk.Argument=class{constructor(t,e){if("string"==typeof e)this._name=e;else switch(t){case 1:switch(e.__type__){case"InputValue":this._name=e.name,this._type=new cntk.TensorType(t,e.precision,e.sampleLayout),this._initializer=null;break;case"LearnableParameter":this._name=e.name,this._type=null,this._initializer=new cntk.Tensor(t,e)}break;case 2:e.value?(this._name=e.name||e.uid,this._type=null,this._initializer=new cntk.Tensor(t,e)):(this._name=e.uid,this._type=new cntk.TensorType(t,e.data_type,e.shape),this._initializer=null)}}get name(){return this._name}get type(){return this._type?this._type:this._initializer?this._initializer.type:null}get description(){return""}get initializer(){return this._initializer}},cntk.Node=class{constructor(t,e,n,i){this._metadata=t,this._attributes=[],this._inputs=[],this._outputs=[];let s=[],o=[];const a=[];switch(e){case 1:this._type=n.__type__,this._name=n.name;for(const e of Object.keys(n))"__type__"!=e&&"name"!=e&&"inputs"!=e&&"precision"!=e&&this._attributes.push(new cntk.Attribute(t.attribute(this._type,e),e,n[e]));s=n.inputs.map((t=>i[t]?i[t]:new cntk.Argument(e,t))),o=[new cntk.Argument(e,this._name)];break;case 2:{this._name=n.name||n.uid||null;const r=n.uid;if(57==n.op)this._type="Block",n.block_function_op_name&&(this._type=n.block_function_op_name,this._function=!0);else if(Object.prototype.hasOwnProperty.call(n,"op"))this._type=this._metadata.name(n.op),null==this.type&&(this._type=n.op?n.op.toString():"?");else if(this._type=n.type,n.user_defined_state)for(const e of Object.keys(n.user_defined_state))this._attributes.push(new cntk.Attribute(t.attribute(this._type,e),e,n.user_defined_state[e]));if(n.attributes)for(const e of Object.keys(n.attributes))this._attributes.push(new cntk.Attribute(t.attribute(this._type,e),e,n.attributes[e]));for(const t of n.inputs){const n=i[t];n?n.initializer?a.push(n):s.push(n):s.push(new cntk.Argument(e,t))}o.push(new cntk.Argument(e,r+"_Output_0")),s=s.concat(a);break}}let r=0;const u=this._metadata.type(this._function?"Function:"+this._type:this._type);if(u&&u.inputs)for(const t of u.inputs)if(r<s.length||"optional"!=t.option){const e="variadic"==t.option?s.length-r:1,n=[];for(const i of s.slice(r,r+e))""==i.name&&"optional"==t.option||n.push(i);this._inputs.push(new cntk.Parameter(t.name,n)),r+=e}this._inputs=this._inputs.concat(s.slice(r).map(((t,e)=>new cntk.Parameter((r+e).toString(),[t]))));let c=0;if(u&&u.outputs)for(const t of u.outputs)if(c<o.length||"optional"!=t.option){const e="variadic"==t.option?o.length-c:1;this._outputs.push(new cntk.Parameter(t.name,o.slice(c,c+e))),c+=e}this._outputs=this._outputs.concat(o.slice(c).map((t=>new cntk.Parameter(c.toString(),[t]))))}get name(){return this._name}get type(){return this._type}get function(){return this._function||!1}get metadata(){return this._metadata.type(this._function?"Function:"+this._type:this._type)}get attributes(){return this._attributes}get inputs(){return this._inputs}get outputs(){return this._outputs}},cntk.Attribute=class{constructor(t,e,n){if(this._name=e,this._value=n,this._type=null,cntk_v1&&this._value instanceof cntk_v1.TensorShape&&(this._value=new cntk.TensorShape(1,n),this._type="shape"),cntk_v2&&this._value instanceof cntk_v2.NDShape&&(this._value=new cntk.TensorShape(2,n),this._type="shape"),cntk_v2&&this._value instanceof cntk_v2.Axis){const t={__type__:"Axis"};for(const e of Object.keys(n).filter((t=>"name"!==t)))t[e]=n[e];this._value=t}if(t){if(t.type){this._type=t.type;const e=cntk_v1[this._type]||cntk_v2[this._type];e&&e[this._value]&&(this._value=e[this._value])}if(Object.prototype.hasOwnProperty.call(t,"visible")&&!t.visible)this._visible=!1;else if(Object.prototype.hasOwnProperty.call(t,"default")){let e=t.default;if("function"==typeof(n=this._value)&&(n=n()),"shape"==this._type&&(n=n.dimensions),n==e)this._visible=!1;else if(Array.isArray(n)&&Array.isArray(e)){if(e=e.slice(0,e.length),e.length>1&&null==e[e.length-1])for(e.pop();e.length<n.length;)e.push(e[e.length-1]);n.every(((t,n)=>t==e[n]))&&(this._visible=!1)}}}}get name(){return this._name}get type(){return this._type}get value(){return this._value}get visible(){return 0!=this._visible}},cntk.Tensor=class{constructor(t,e){switch(t){case 1:"LearnableParameter"==e.__type__&&(this._name=e.name||null,this._type=new cntk.TensorType(t,e.precision,e.sampleLayout));break;case 2:this._name=e.name||e.uid||null,this._type=new cntk.TensorType(t,e.data_type,e.shape),this._value=e.value}}get name(){return this._name}get type(){return this._type}get state(){return this._context().state||null}get value(){const t=this._context();return t.state?null:(t.limit=Number.MAX_SAFE_INTEGER,this._decode(t,0))}toString(){const t=this._context();if(t.state)return"";t.limit=1e4;const e=this._decode(t,0);return JSON.stringify(e,null,4)}_context(){const t={index:0,count:0,state:null};if("?"==this._type.dataType)return t.state="Tensor has unknown data type.",t;if(!this._type.shape)return t.state="Tensor has no dimensions.",t;const e=this._value;if(!e)return t.state="Tensor data is empty.",t;switch(this._type.dataType){case"float32":e.float_values&&e.float_values.value&&e.float_values.value.length>0?t.data=e.float_values.value:t.state="Tensor data is empty.";break;default:t.state="Tensor data type is not implemented."}return t.dataType=this._type.dataType,t.shape=this._type.shape.dimensions,t}_decode(t,e){let n=t.shape;0==t.shape.length&&(n=[1]);const i=[],s=n[e];if(e==n.length-1)for(let e=0;e<s;e++){if(t.count>t.limit)return i.push("..."),i;i.push(t.data[t.index++]),t.count++}else for(let n=0;n<s;n++){if(t.count>t.limit)return i.push("..."),i;i.push(this._decode(t,e+1))}return 0==t.shape.length?i[0]:i}},cntk.TensorType=class{constructor(t,e,n){switch(this._dataType="?",t){case 1:switch(e){case"float":this._dataType="float32";break;case"double":this._dataType="float64";break;case"half":this._dataType="float16";break;case"":this._dataType="float32"}this._shape=new cntk.TensorShape(t,n);break;case 2:switch(long.Long.isLong(e)&&(e=e.toNumber()),e){case 1:this._dataType="float32"}this._shape=new cntk.TensorShape(t,n)}}get dataType(){return this._dataType}get shape(){return this._shape}toString(){return this._dataType+this._shape.toString()}},cntk.TensorShape=class{constructor(t,e){switch(t){case 1:this._dimensions=e.dims;break;case 2:this._dimensions=e.shape_dim.map((t=>-1==t.low&&-1==t.high&&1==t.unsigned?-1:t&&long.Long.isLong(t)?t.toNumber():t))}}get dimensions(){return this._dimensions}toString(){return this._dimensions&&this._dimensions.length?"["+this._dimensions.join(",")+"]":""}},cntk.Metadata=class{static open(t){return cntk.Metadata._metadata?Promise.resolve(cntk.Metadata._metadata):t.request(null,"cntk-metadata.json","utf-8").then((t=>(cntk.Metadata._metadata=new cntk.Metadata(t),cntk.Metadata._metadata))).catch((()=>(cntk.Metadata._metadata=new cntk.Metadata(null),cntk.Metadata._metadata)))}constructor(t){if(this._map={},this._attributeCache={},this._typeMap={},t){const e=JSON.parse(t);if(e)for(const t of e)if(t.name&&t.schema){const e=t.name,n=t.schema;n.name=e,this._map[e]=n,Object.prototype.hasOwnProperty.call(n,"operator")&&(this._typeMap[n.operator.toString()]=e)}}}name(t){return this._typeMap[t]||null}type(t){return this._map[t]||null}attribute(t,e){let n=this._attributeCache[t];if(!n){n={};const e=this.type(t);if(e&&e.attributes&&e.attributes.length>0)for(const t of e.attributes)n[t.name]=t;this._attributeCache[t]=n}return n[e]||null}},cntk_v1.ComputationNetwork=class{constructor(t){const e=new cntk_v1.Reader(t);e.assert("BCN"),e.assert("BVersion"),this.version=e.uint64(),e.assert("EVersion");const n=e.uint64();e.assert("BNodeList");const i={Minus:function(){},Plus:function(){},GreaterEqual:function(){},Equal:function(){},NotEqual:function(){},Exp:function(){},Log:function(){},Reciprocal:function(){},ElementTimes:function(){},ClassificationError:function(){},RectifiedLinear:function(){},InputValue:function(t,e){this.rows=t.uint64(),this.cols=t.uint64(),this.sampleLayout=new cntk_v1.TensorShape(t,!0),this.dynamicAxisNodeName="",e>=8&&1==t.uint32()&&(this.dynamicAxisNodeName=t.string()),this.learningRateMultiplier=0,e>=10&&(this.learningRateMultiplier=t.float32())},LearnableParameter:function(t,e){if(!(e>=3))throw new cntk.Error("LeanableParameter reader implemented.");this.learningRateMultiplier=t.float32(),this.sampleLayout=new cntk_v1.TensorShape(t),this.value=new cntk_v1.Matrix(t)},CrossEntropyWithSoftmax:function(t){this.evalMode=t.uint32(),this.evalMode>2&&(this.evalMode=0,t.skip(-4))},Times:function(t,e){this.outputRank=e>=3?t.uint64():1,this.inferInputRankToMap=e>=12?t.int32():-1},Dropout:function(t,e){e>=16&&(this.rngSeed=16==e?t.uint32():t.uint64(),this.rngOffset=t.uint64())},ConvolutionBase:function(t,e){e>=5&&(this.kernelShape=new cntk_v1.TensorShape(t),this.mapCount=new cntk_v1.TensorShape(t),this.strides=new cntk_v1.TensorShape(t),this.sharing=t.booleans(t.uint64()),this.autoPadding=t.booleans(t.uint64()),this.lowerPad=new cntk_v1.TensorShape(t),this.upperPad=new cntk_v1.TensorShape(t),this.poolKind=t.enum(),this.imageLayoutKind=t.enum(),this.maxTempMemSizeInSamples=t.uint64()),e>=9&&(this.transpose=t.boolean()),e>=20&&(this.outputShape=new cntk_v1.TensorShape(t)),e>=21&&(this.ceilOutDim=t.boolean()),e>=23&&(this.includePad=t.boolean())},Convolution:function(t,e){i.ConvolutionBase.apply(this,[t,e]),e<5?(this.kernelShape=new cntk_v1.TensorShape([t.uint64(),t.uint64(),1]),this.strides=new cntk_v1.TensorShape([t.uint64(),t.uint64(),1]),this.mapCount=new cntk_v1.TensorShape([t.uint32()]),this.imageLayoutKind=t.enum(),this.autoPadding=[t.boolean()],this.maxTempMemSizeInSamples=t.uint64(),this.poolKind="None",this.convolution2D=!0,this.sharing=[!0],this.lowerPad=new cntk_v1.TensorShape([0]),this.upperPad=new cntk_v1.TensorShape([0])):(this.convolution2D=t.boolean(),this.dilation=e>=18?new cntk_v1.TensorShape(t):new cntk_v1.TensorShape([1]))},Pooling:function(t,e){i.ConvolutionBase.apply(this,[t,e])},PoolingBase:function(t){this.imageLayoutKind=t.enum(),this.windowWidth=t.uint32(),this.windowHeight=t.uint64(),this.horizontalSubsample=t.uint64(),this.verticalSubsample=t.uint64()},MaxPooling:function(t,e){i.PoolingBase.apply(this,[t,e])},ROIPooling:function(t,e){this.roiOutputShape=new cntk_v1.TensorShape(t),this.poolKind=e<26?"Max":t.enum(),this.spatialScale=e<26?.0625:t.float64()},Reshape:function(t){this.beginDimParameter=t.uint32(),this.endDimParameter=t.uint32(),this.replacementSampleLayout=new cntk_v1.TensorShape(t)},ReduceElements:function(t,e){let n=1;e>=27&&(n=t.uint32()),this.axes=[];for(let e=0;e<n;e++)this.axes.push(t.uint32());this.operation=t.string(),e>=24&&(this.keepDimensions=t.boolean())},BatchNormalization:function(t,e){let n=0;if(e>=6)this.spatial=t.boolean(),this.normalizationTimeConstant=t.float64(),this.blendTimeConstant=t.float64(),this.imageLayoutKind=t.enum(),e>=13?this.runCountUntied=19!=e?t.uint64():t.boolean()?0:"SIZE_MAX":n=t.uint64(),this.epsilon=t.float64(),this.useCntkEngine=t.boolean();else{const e=t.int32(),i=t.int32();if(i>e||e<65537||i>65540)throw new cntk.Error("BatchNormalization version not supported.");this.eval=t.boolean(),this.spatial=t.boolean(),e>=65540?this.normalizationTimeConstant=t.float64():t.float64(),e>=65538&&(this.imageLayoutKind=t.enum(),n=t.uint64()),e>=65539&&(this.epsilon=t.float64(),this.useCntkEngine=t.boolean())}e<13&&(this.runCountUntied=16*n,this.convertRunningVariancePending=!0)},Tanh:function(){},Sigmoid:function(){},Logistic:function(){},SquareError:function(){},ErrorPrediction:function(){},RowStack:function(t,e){this.spliceDim=e>=3?t.int32():1},Slice:function(t,e){let n=1;e>=22&&(n=t.int32()),this.index=[],this.axis=[],this.strideMultiplier=[];for(let i=0;i<n;i++)this.index.push([[t.uint64(),t.uint64()]]),e>=3&&this.axis.push(t.int32()),e>=27&&this.strideMultiplier.push(t.int32())},PastValue:function(t,e){if(this.timeStep=t.int32(),e>3)this.sampleLayout=new cntk_v1.TensorShape(t,!1);else{const e=t.uint64();t.uint64(),this.sampleLayout=new cntk_v1.TensorShape([e],!0)}e>=2&&(this.initialStateValue=t.int32())},FutureValue:function(t,e){if(this.timeStep=t.int32(),e>3)this.sampleLayout=new cntk_v1.TensorShape(t,!1);else{const e=t.uint64();t.uint64(),this.sampleLayout=new cntk_v1.TensorShape([e],!0)}e>=2&&(this.initialStateValue=t.int32())},TransposeDimensions:function(t,e){if(e>=3){if(this.axis1=t.int32(),this.axis2=t.int32(),e>=25&&0==this.axis1&&0==this.axis2){const e=t.uint64();this.perm=[];for(let n=0;n<e;n++)this.perm.push(t.uint64())}}else this.axis1=1,this.axis2=2},AveragePooling:function(t,e){i.PoolingBase.apply(this,[t,e])},InvStdDev:function(t){this.hasComputed=t.boolean(),this.value=new cntk_v1.Matrix(t)},Mean:function(t){this.hasComputed=t.boolean(),this.value=new cntk_v1.Matrix(t)},PerDimMeanVarNormalization:function(){},Softmax:function(){},DynamicAxis:function(){}},s=[];this.nodes={};for(let t=0;t<n;t++){const t=this.version>=7?e.string():"";if("float"!=t&&"double"!=t&&"half"!=t&&""!=t)throw new cntk.Error("Invalid precision format '"+t+"'.");const n={__type__:e.string()};n.name=e.string(),n.precision=t;const o=i[n.__type__];if(!o)throw new cntk.Error("Unknown node type '"+n.__type__+"'.");o.apply(n,[e,this.version]),s.push(n),this.nodes[n.name]=n}e.assert("ENodeList"),e.assert("BRelation");for(let t=0;t<n;t++){const t=e.string(),n=this.nodes[t],i=e.uint64(),o=[];for(let t=0;t<i;t++)o.push(e.string());if(this.version<19&&"BatchNormalization"==n.__type__){const e={__type__:"LearnableParameter",name:t+".run_sample_count",precision:n.precision,sampleLayout:new cntk_v1.TensorShape([1]),learningRateMultiplier:0};s.push(e),this.nodes[e.name]=e,o.push(e.name)}"Convolution"==n.__type__&&o.length>1&&o.splice(0,0,o.pop()),n.inputs=o}e.assert("ERelation"),e.assert("BRootNodes"),e.match("BFeatureNodes")&&(this.feature=e.strings(e.uint64()),e.assert("EFeatureNodes")),e.match("BLabelNodes")&&(this.label=e.strings(e.uint64()),e.assert("ELabelNodes")),e.match("BCriterionNodes")&&(this.criterion=e.strings(e.uint64()),e.assert("ECriterionNodes")),0==this.criterion.length&&e.match("BCriteriaNodes")&&(this.criterion=e.strings(e.uint64()),e.assert("ECriteriaNodes")),e.match("BNodesReqMultiSeqHandling")&&(e.strings(e.uint64()),e.assert("ENodesReqMultiSeqHandling")),e.match("BEvalNodes")&&(this.eval=e.strings(e.uint64()),e.assert("EEvalNodes")),e.match("BOutputNodes")&&(this.output=e.strings(e.uint64()),e.assert("EOutputNodes")),e.match("BPairNodes")&&(this.pair=e.strings(e.uint64()),e.assert("EPairNodes")),e.assert("ERootNodes"),e.assert("ECN")}},cntk_v1.Reader=class{constructor(t){this._buffer=t,this._dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),this._position=0}match(t){const e=this._position;for(let n=0;n<t.length;n++)if(this.uint16()!=t.charCodeAt(n))return this._position=e,!1;return 0==this.uint16()||(this._position=e,!1)}assert(t){if(!this.match(t))throw new cntk_v1.Error("Invalid '"+t+"' signature.")}skip(t){if(this._position+=t,this._position>this._buffer.length)throw new cntk.Error("Expected "+(this._position-this._buffer.length)+" more bytes. The file might be corrupted. Unexpected end of file.")}boolean(){return 0!=this.byte()}booleans(t){const e=[];for(let n=0;n<t;n++)e.push(this.boolean());return e}byte(){const t=this._position;return this.skip(1),this._dataView.getUint8(t)}bytes(t){const e=this._position;return this.skip(t),this._buffer.subarray(e,this._position)}uint16(){const t=this._position;return this.skip(2),this._dataView.getUint16(t,!0)}int32(){const t=this._position;return this.skip(4),this._dataView.getInt32(t,!0)}uint32(){const t=this._position;return this.skip(4),this._dataView.getUint32(t,!0)}uint64(){const t=this.uint32(),e=this.uint32();if(e>65536)throw new cntk_v1.Error("Value not in 48-bit range.");return e<<32|t}float32(){const t=this._position;return this.skip(4),this._dataView.getFloat32(t,!0)}float64(){const t=this._position;return this.skip(8),this._dataView.getFloat64(t,!0)}string(){let t="",e=this.uint16();for(;0!=e;)t+=String.fromCharCode(e),e=this.uint16();return t}strings(t){const e=[];for(let n=0;n<t;n++)e.push(this.string());return e}enum(){return this.int32()}},cntk_v1.TensorShape=class{constructor(t,e=!1){if(t&&Array.isArray(t))return void(this.dims=t);this.dims=[];const n=t.uint32();let i=0;if(n>0&&(i=t.uint32()),e&&0==i){const e=t.uint32();this.dims.push(t.uint32()),this.dims.push(n),this.dims.push(e)}else{n>0&&this.dims.push(i);for(let e=1;e<n;e++)this.dims.push(t.uint32())}}},cntk_v1.Matrix=class{constructor(t){const e=t.byte();switch(e){case 100:{t.assert("BMAT");const e=t.uint64();this.name=t.string(),this.format=t.uint32(),this.rows=t.uint64(),this.columns=t.uint64(),t.bytes(e*this.rows*this.columns),t.assert("EMAT");break}case 115:throw new cntk_v1.Error("Matrix sparse type not implemented.");default:throw new cntk_v1.Error("Matrix type '"+e.toString()+"' not implemented.")}}},cntk_v1.ImageLayoutKind={0:"CHW",1:"HWC"},cntk_v1.PoolKind={0:"None",1:"Max",2:"Average"},cntk_v1.Error=class extends Error{constructor(t){super(t),this.name="Error loading CNTK v1 model."}},cntk.Error=class extends Error{constructor(t){super(t),this.name="Error loading CNTK model."}},"undefined"!=typeof module&&"object"==typeof module.exports&&(module.exports.ModelFactory=cntk.ModelFactory);