import{w as I,g as H,x as tt,G as M}from"../common/html-43a4a009.js";import{c as et}from"../common/_commonjsHelpers-b3efd043.js";var rt=et(function(f){(function(r,n,s){if(!r)return;for(var l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},d={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},y={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},A,m=1;m<20;++m)l[111+m]="f"+m;for(m=0;m<=9;++m)l[m+96]=m.toString();function S(t,e,a){if(t.addEventListener){t.addEventListener(e,a,!1);return}t.attachEvent("on"+e,a)}function j(t){if(t.type=="keypress"){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return l[t.which]?l[t.which]:d[t.which]?d[t.which]:String.fromCharCode(t.which).toLowerCase()}function B(t,e){return t.sort().join(",")===e.sort().join(",")}function V(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}function U(t){if(t.preventDefault){t.preventDefault();return}t.returnValue=!1}function X(t){if(t.stopPropagation){t.stopPropagation();return}t.cancelBubble=!0}function x(t){return t=="shift"||t=="ctrl"||t=="alt"||t=="meta"}function Y(){if(!A){A={};for(var t in l)t>95&&t<112||l.hasOwnProperty(t)&&(A[l[t]]=t)}return A}function $(t,e,a){return a||(a=Y()[t]?"keydown":"keypress"),a=="keypress"&&e.length&&(a="keydown"),a}function z(t){return t==="+"?["+"]:(t=t.replace(/\+{2}/g,"+plus"),t.split("+"))}function R(t,e){var a,b,E,K=[];for(a=z(t),E=0;E<a.length;++E)b=a[E],_[b]&&(b=_[b]),e&&e!="keypress"&&y[b]&&(b=y[b],K.push("shift")),x(b)&&K.push(b);return e=$(b,K,e),{key:b,modifiers:K,action:e}}function D(t,e){return t===null||t===n?!1:t===e?!0:D(t.parentNode,e)}function g(t){var e=this;if(t=t||n,!(e instanceof g))return new g(t);e.target=t,e._callbacks={},e._directMap={};var a={},b,E=!1,K=!1,T=!1;function L(i){i=i||{};var u=!1,p;for(p in a){if(i[p]){u=!0;continue}a[p]=0}u||(T=!1)}function F(i,u,p,o,h,k){var c,v,P=[],w=p.type;if(!e._callbacks[i])return[];for(w=="keyup"&&x(i)&&(u=[i]),c=0;c<e._callbacks[i].length;++c)if(v=e._callbacks[i][c],!(!o&&v.seq&&a[v.seq]!=v.level)&&w==v.action&&(w=="keypress"&&!p.metaKey&&!p.ctrlKey||B(u,v.modifiers))){var W=!o&&v.combo==h,Z=o&&v.seq==o&&v.level==k;(W||Z)&&e._callbacks[i].splice(c,1),P.push(v)}return P}function O(i,u,p,o){e.stopCallback(u,u.target||u.srcElement,p,o)||i(u,p)===!1&&(U(u),X(u))}e._handleKey=function(i,u,p){var o=F(i,u,p),h,k={},c=0,v=!1;for(h=0;h<o.length;++h)o[h].seq&&(c=Math.max(c,o[h].level));for(h=0;h<o.length;++h){if(o[h].seq){if(o[h].level!=c)continue;v=!0,k[o[h].seq]=1,O(o[h].callback,p,o[h].combo,o[h].seq);continue}v||O(o[h].callback,p,o[h].combo)}var P=p.type=="keypress"&&K;p.type==T&&!x(i)&&!P&&L(k),K=v&&p.type=="keydown"};function q(i){typeof i.which!="number"&&(i.which=i.keyCode);var u=j(i);if(!!u){if(i.type=="keyup"&&E===u){E=!1;return}e.handleKey(u,V(i),i)}}function J(){clearTimeout(b),b=setTimeout(L,1e3)}function Q(i,u,p,o){a[i]=0;function h(w){return function(){T=w,++a[i],J()}}function k(w){O(p,w,i),o!=="keyup"&&(E=j(w)),setTimeout(L,10)}for(var c=0;c<u.length;++c){var v=c+1===u.length,P=v?k:h(o||R(u[c+1]).action);G(u[c],P,o,i,c)}}function G(i,u,p,o,h){e._directMap[i+":"+p]=u,i=i.replace(/\s+/g," ");var k=i.split(" "),c;if(k.length>1){Q(i,k,u,p);return}c=R(i,p),e._callbacks[c.key]=e._callbacks[c.key]||[],F(c.key,c.modifiers,{type:c.action},o,i,h),e._callbacks[c.key][o?"unshift":"push"]({callback:u,modifiers:c.modifiers,action:c.action,seq:o,level:h,combo:i})}e._bindMultiple=function(i,u,p){for(var o=0;o<i.length;++o)G(i[o],u,p)},S(t,"keypress",q),S(t,"keydown",q),S(t,"keyup",q)}g.prototype.bind=function(t,e,a){var b=this;return t=t instanceof Array?t:[t],b._bindMultiple.call(b,t,e,a),b},g.prototype.unbind=function(t,e){var a=this;return a.bind.call(a,t,function(){},e)},g.prototype.trigger=function(t,e){var a=this;return a._directMap[t+":"+e]&&a._directMap[t+":"+e]({},t),a},g.prototype.reset=function(){var t=this;return t._callbacks={},t._directMap={},t},g.prototype.stopCallback=function(t,e){var a=this;if((" "+e.className+" ").indexOf(" mousetrap ")>-1||D(e,a.target))return!1;if("composedPath"in t&&typeof t.composedPath=="function"){var b=t.composedPath()[0];b!==t.target&&(e=b)}return e.tagName=="INPUT"||e.tagName=="SELECT"||e.tagName=="TEXTAREA"||e.isContentEditable},g.prototype.handleKey=function(){var t=this;return t._handleKey.apply(t,arguments)},g.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(l[e]=t[e]);A=null},g.init=function(){var t=g(n);for(var e in t)e.charAt(0)!=="_"&&(g[e]=function(a){return function(){return t[a].apply(t,arguments)}}(e))},g.init(),r.Mousetrap=g,f.exports&&(f.exports=g),typeof s=="function"&&s.amd&&s(function(){return g})})(typeof window!="undefined"?window:null,typeof window!="undefined"?document:null)}),nt=function(f,r,n,s){var l=arguments.length,d=l<3?r:s===null?s=Object.getOwnPropertyDescriptor(r,n):s,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(f,r,n,s);else for(var _=f.length-1;_>=0;_--)(y=f[_])&&(d=(l<3?y(d):l>3?y(r,n,d):y(r,n))||d);return l>3&&d&&Object.defineProperty(r,n,d),d};class C extends I{get graph(){return this.options.graph}constructor(r){super();this.options=r;const n=this.graph.getPlugin("scroller");this.container=n?n.container:this.graph.container,r.global?this.target=document:(this.target=this.container,this.disabled||this.target.setAttribute("tabindex","-1"),this.graph.on("cell:mouseup",this.focus,this),this.graph.on("blank:mouseup",this.focus,this)),this.mousetrap=C.createMousetrap(this)}get disabled(){return this.options.enabled!==!0}enable(){this.disabled&&(this.options.enabled=!0,this.target instanceof HTMLElement&&this.target.setAttribute("tabindex","-1"))}disable(){this.disabled||(this.options.enabled=!1,this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))}on(r,n,s){this.mousetrap.bind(this.getKeys(r),n,s)}off(r,n){this.mousetrap.unbind(this.getKeys(r),n)}focus(r){if(this.isInputEvent(r.e))return;this.target.focus({preventScroll:!0})}getKeys(r){return(Array.isArray(r)?r:[r]).map(n=>this.formatkey(n))}formatkey(r){const n=r.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command"),s=this.options.format;return s?H(s,this.graph,n):n}isGraphEvent(r){const n=r.target,s=r.currentTarget;return n?n===this.target||s===this.target||n===document.body?!0:tt(this.container,n):!1}isInputEvent(r){var n;const s=r.target,l=(n=s==null?void 0:s.tagName)===null||n===void 0?void 0:n.toLowerCase();return["input","textarea"].includes(l)}isEnabledForEvent(r){const n=!this.disabled&&this.isGraphEvent(r),s=this.isInputEvent(r);if(n){const l=r.keyCode||r.which;if(s&&(l===8||l===46))return!1;if(this.options.guard)return H(this.options.guard,this.graph,r)}return n}dispose(){this.mousetrap.reset()}}nt([I.dispose()],C.prototype,"dispose",null),function(f){function r(n){const s=new rt(n.target),l=s.stopCallback;return s.stopCallback=(d,y,_)=>n.isEnabledForEvent(d)?l?l.call(s,d,y,_):!1:!0,s}f.createMousetrap=r}(C||(C={})),M.prototype.isKeyboardEnabled=function(){const f=this.getPlugin("keyboard");return f?f.isEnabled():!1},M.prototype.enableKeyboard=function(){const f=this.getPlugin("keyboard");return f&&f.enable(),this},M.prototype.disableKeyboard=function(){const f=this.getPlugin("keyboard");return f&&f.disable(),this},M.prototype.toggleKeyboard=function(f){const r=this.getPlugin("keyboard");return r&&r.toggleEnabled(f),this},M.prototype.bindKey=function(f,r,n){const s=this.getPlugin("keyboard");return s&&s.bindKey(f,r,n),this},M.prototype.unbindKey=function(f,r){const n=this.getPlugin("keyboard");return n&&n.unbindKey(f,r),this};var it=function(f,r,n,s){var l=arguments.length,d=l<3?r:s===null?s=Object.getOwnPropertyDescriptor(r,n):s,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(f,r,n,s);else for(var _=f.length-1;_>=0;_--)(y=f[_])&&(d=(l<3?y(d):l>3?y(r,n,d):y(r,n))||d);return l>3&&d&&Object.defineProperty(r,n,d),d};class N extends I{constructor(r){super();this.name="keyboard",this.options=r}init(r){this.keyboardImpl=new C(Object.assign(Object.assign({},this.options),{graph:r}))}isEnabled(){return!this.keyboardImpl.disabled}enable(){return this.keyboardImpl.enable(),this}disable(){return this.keyboardImpl.disable(),this}toggleEnabled(r){return r!=null?r!==this.isEnabled()&&(r?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}bindKey(r,n,s){return this.keyboardImpl.on(r,n,s),this}unbindKey(r,n){return this.keyboardImpl.off(r,n),this}dispose(){this.keyboardImpl.dispose()}}it([I.dispose()],N.prototype,"dispose",null);export{N as Keyboard};
