import{c as lt,a as K}from"./common/_commonjsHelpers-b3efd043.js";var pt=lt(function(i,e){var r=K&&K.__values||function(b){var d=typeof Symbol=="function"&&b[Symbol.iterator],a=0;return d?d.call(b):{next:function(){return b&&a>=b.length&&(b=void 0),{value:b&&b[a++],done:!b}}}};Object.defineProperty(e,"__esModule",{value:!0});function t(b,d){return Math.floor(d()*b)}e.tauRandInt=t;function n(b){return b()}e.tauRand=n;function o(b){var d,a,g=0;try{for(var m=r(b),w=m.next();!w.done;w=m.next()){var j=w.value;g+=Math.pow(j,2)}}catch(V){d={error:V}}finally{try{w&&!w.done&&(a=m.return)&&a.call(m)}finally{if(d)throw d.error}}return Math.sqrt(g)}e.norm=o;function u(b){for(var d=[],a=0;a<b;a++)d.push(void 0);return d}e.empty=u;function c(b){return u(b).map(function(d,a){return a})}e.range=c;function p(b,d){return u(b).map(function(){return d})}e.filled=p;function y(b){return p(b,0)}e.zeros=y;function k(b){return p(b,1)}e.ones=k;function I(b,d,a){return u(a).map(function(g,m){return b+m*((d-b)/(a-1))})}e.linear=I;function v(b){return b.reduce(function(d,a){return d+a})}e.sum=v;function F(b){return v(b)/b.length}e.mean=F;function M(b){for(var d=0,a=0;a<b.length;a++)d=b[a]>d?b[a]:d;return d}e.max=M;function E(b){for(var d=0,a=0;a<b.length;a++)for(var g=0;g<b[a].length;g++)d=b[a][g]>d?b[a][g]:d;return d}e.max2d=E;function z(b,d,a){for(var g=y(b),m=0;m<b;m++)for(var w=!0;w;){for(var j=t(d,a),V=!1,s=0;s<m;s++)if(j===g[s]){V=!0;break}V||(w=!1),g[m]=j}return g}e.rejectionSample=z;function _(b,d,a){var g=[],m=0;if(b.length!==d*a)throw new Error("Array dimensions must match input length.");for(var w=0;w<d;w++){for(var j=[],V=0;V<a;V++)j.push(b[m]),m+=1;g.push(j)}return g}e.reshape2d=_}),jt=lt(function(i,e){var r=K&&K.__importStar||function(v){if(v&&v.__esModule)return v;var F={};if(v!=null)for(var M in v)Object.hasOwnProperty.call(v,M)&&(F[M]=v[M]);return F.default=v,F};Object.defineProperty(e,"__esModule",{value:!0});var t=r(pt);function n(v,F){var M=function(z){return t.empty(v).map(function(){return t.filled(F,z)})},E=[];return E.push(M(-1)),E.push(M(Infinity)),E.push(M(0)),E}e.makeHeap=n;function o(v,F,M){for(var E=t.zeros(v),z=0;z<v;z++){for(var _=!0,b=0;_;){b=t.tauRandInt(F,M);for(var d=!1,a=0;a<z;a++)if(b===E[a]){d=!0;break}d||(_=!1)}E[z]=b}return E}e.rejectionSample=o;function u(v,F,M,E,z){F=Math.floor(F);var _=v[0][F],b=v[1][F],d=v[2][F];if(M>=b[0])return 0;for(var a=0;a<_.length;a++)if(E===_[a])return 0;return c(v,F,M,E,z)}e.heapPush=u;function c(v,F,M,E,z){var _=v[0][F],b=v[1][F],d=v[2][F];if(M>=b[0])return 0;b[0]=M,_[0]=E,d[0]=z;for(var a=0,g=0;;){var m=2*a+1,w=m+1,j=v[0][0].length;if(m>=j)break;if(w>=j)if(b[m]>M)g=m;else break;else if(b[m]>=b[w])if(M<b[m])g=m;else break;else if(M<b[w])g=w;else break;b[a]=b[g],_[a]=_[g],d[a]=d[g],a=g}return b[a]=M,_[a]=E,d[a]=z,1}e.uncheckedHeapPush=c;function p(v,F,M,E,z){for(var _=n(F,E),b=0;b<F;b++)for(var d=0;d<M;d++)if(!(v[0][b][d]<0)){var a=v[0][b][d],g=v[2][b][d],m=t.tauRand(z);u(_,b,m,a,g),u(_,a,m,b,g),v[2][b][d]=0}return _}e.buildCandidates=p;function y(v){for(var F=v[0],M=v[1],E=0;E<F.length;E++)for(var z=F[E],_=M[E],b=0;b<z.length-1;b++){var d=z.length-b-1,a=_.length-b-1,g=z[0];z[0]=z[d],z[d]=g;var m=_[0];_[0]=_[a],_[a]=m,k(_,z,a,0)}return{indices:F,weights:M}}e.deheapSort=y;function k(v,F,M,E){for(;E*2+1<M;){var z=E*2+1,_=z+1,b=E;if(v[b]<v[z]&&(b=z),_<M&&v[b]<v[_]&&(b=_),b===E)break;var d=v[E];v[E]=v[b],v[b]=d;var a=F[E];F[E]=F[b],F[b]=a,E=b}}function I(v,F){for(var M=v[0][F],E=v[1][F],z=v[2][F],_=Infinity,b=-1,d=0;d>M.length;d++)z[d]===1&&E[d]<_&&(_=E[d],b=d);return b>=0?(z[b]=0,Math.floor(M[b])):-1}e.smallestFlagged=I}),kt=lt(function(i,e){var r=K&&K.__read||function(a,g){var m=typeof Symbol=="function"&&a[Symbol.iterator];if(!m)return a;var w=m.call(a),j,V=[],s;try{for(;(g===void 0||g-- >0)&&!(j=w.next()).done;)V.push(j.value)}catch(l){s={error:l}}finally{try{j&&!j.done&&(m=w.return)&&m.call(w)}finally{if(s)throw s.error}}return V},t=K&&K.__values||function(a){var g=typeof Symbol=="function"&&a[Symbol.iterator],m=0;return g?g.call(a):{next:function(){return a&&m>=a.length&&(a=void 0),{value:a&&a[m++],done:!a}}}},n=K&&K.__importStar||function(a){if(a&&a.__esModule)return a;var g={};if(a!=null)for(var m in a)Object.hasOwnProperty.call(a,m)&&(g[m]=a[m]);return g.default=a,g};Object.defineProperty(e,"__esModule",{value:!0});var o,u=n(pt),c=function(){function a(g,m,w,j){if(this.entries=new Map,this.nRows=0,this.nCols=0,g.length!==m.length||g.length!==w.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=j[0],this.nCols=j[1];for(var V=0;V<w.length;V++){var s=g[V],l=m[V];this.checkDims(s,l);var f=this.makeKey(s,l);this.entries.set(f,{value:w[V],row:s,col:l})}}return a.prototype.makeKey=function(g,m){return g+":"+m},a.prototype.checkDims=function(g,m){var w=g<this.nRows&&m<this.nCols;if(!w)throw new Error("row and/or col specified outside of matrix dimensions")},a.prototype.set=function(g,m,w){this.checkDims(g,m);var j=this.makeKey(g,m);this.entries.has(j)?this.entries.get(j).value=w:this.entries.set(j,{value:w,row:g,col:m})},a.prototype.get=function(g,m,w){w===void 0&&(w=0),this.checkDims(g,m);var j=this.makeKey(g,m);return this.entries.has(j)?this.entries.get(j).value:w},a.prototype.getAll=function(g){g===void 0&&(g=!0);var m=[];return this.entries.forEach(function(w){m.push(w)}),g&&m.sort(function(w,j){return w.row===j.row?w.col-j.col:w.row-j.row}),m},a.prototype.getDims=function(){return[this.nRows,this.nCols]},a.prototype.getRows=function(){return Array.from(this.entries,function(g){var m=r(g,2),w=m[0],j=m[1];return j.row})},a.prototype.getCols=function(){return Array.from(this.entries,function(g){var m=r(g,2),w=m[0],j=m[1];return j.col})},a.prototype.getValues=function(){return Array.from(this.entries,function(g){var m=r(g,2),w=m[0],j=m[1];return j.value})},a.prototype.forEach=function(g){this.entries.forEach(function(m){return g(m.value,m.row,m.col)})},a.prototype.map=function(g){var m=[];this.entries.forEach(function(j){m.push(g(j.value,j.row,j.col))});var w=[this.nRows,this.nCols];return new a(this.getRows(),this.getCols(),m,w)},a.prototype.toArray=function(){var g=this,m=u.empty(this.nRows),w=m.map(function(){return u.zeros(g.nCols)});return this.entries.forEach(function(j){w[j.row][j.col]=j.value}),w},a}();e.SparseMatrix=c;function p(a){var g=[],m=[],w=[];a.forEach(function(V,s,l){g.push(s),m.push(l),w.push(V)});var j=[a.nCols,a.nRows];return new c(m,g,w,j)}e.transpose=p;function y(a){for(var g=r(a,1),m=g[0],w=new c([],[],[],a),j=0;j<m;j++)w.set(j,j,1);return w}e.identity=y;function k(a,g){return b(a,g,function(m,w){return m*w})}e.pairwiseMultiply=k;function I(a,g){return b(a,g,function(m,w){return m+w})}e.add=I;function v(a,g){return b(a,g,function(m,w){return m-w})}e.subtract=v;function F(a,g){return b(a,g,function(m,w){return m>w?m:w})}e.maximum=F;function M(a,g){return a.map(function(m){return m*g})}e.multiplyScalar=M;function E(a){for(var g=new Set,m=a.getValues(),w=a.getRows(),j=a.getCols(),V=0;V<m.length;V++)m[V]===0&&g.add(V);var s=function(N,S){return!g.has(S)},l=m.filter(s),f=w.filter(s),h=j.filter(s);return new c(f,h,l,a.getDims())}e.eliminateZeros=E;function z(a,g){g===void 0&&(g="l2");var m,w,j=_[g],V=new Map;a.forEach(function(S,R,T){var O=V.get(R)||[];O.push(T),V.set(R,O)});var s=new c([],[],[],a.getDims()),l=function(S){for(var R=V.get(S).sort(),T=R.map(function(L){return a.get(S,L)}),O=j(T),P=0;P<O.length;P++)s.set(S,R[P],O[P])};try{for(var f=t(V.keys()),h=f.next();!h.done;h=f.next()){var N=h.value;l(N)}}catch(S){m={error:S}}finally{try{h&&!h.done&&(w=f.return)&&w.call(f)}finally{if(m)throw m.error}}return s}e.normalize=z;var _=(o={},o.max=function(a){for(var g=-Infinity,m=0;m<a.length;m++)g=a[m]>g?a[m]:g;return a.map(function(w){return w/g})},o.l1=function(a){for(var g=0,m=0;m<a.length;m++)g+=a[m];return a.map(function(w){return w/g})},o.l2=function(a){for(var g=0,m=0;m<a.length;m++)g+=Math.pow(a[m],2);return a.map(function(w){return Math.sqrt(Math.pow(w,2)/g)})},o);function b(a,g,m){for(var w=new Set,j=[],V=[],s=[],l=function($,D){j.push($),V.push(D);var W=m(a.get($,D),g.get($,D));s.push(W)},f=a.getValues(),h=a.getRows(),N=a.getCols(),S=0;S<f.length;S++){var R=h[S],T=N[S],O=R+":"+T;w.add(O),l(R,T)}for(var P=g.getValues(),L=g.getRows(),C=g.getCols(),S=0;S<P.length;S++){var R=L[S],T=C[S],O=R+":"+T;w.has(O)||l(R,T)}var U=[a.nRows,a.nCols];return new c(j,V,s,U)}function d(a){var g=[];a.forEach(function(S,R,T){g.push({value:S,row:R,col:T})}),g.sort(function(S,R){return S.row===R.row?S.col-R.col:S.row-R.row});for(var m=[],w=[],j=[],V=-1,s=0;s<g.length;s++){var l=g[s],f=l.row,h=l.col,N=l.value;f!==V&&(V=f,j.push(s)),m.push(h),w.push(N)}return{indices:m,values:w,indptr:j}}e.getCSR=d}),Rt=lt(function(i,e){var r=K&&K.__read||function(d,a){var g=typeof Symbol=="function"&&d[Symbol.iterator];if(!g)return d;var m=g.call(d),w,j=[],V;try{for(;(a===void 0||a-- >0)&&!(w=m.next()).done;)j.push(w.value)}catch(s){V={error:s}}finally{try{w&&!w.done&&(g=m.return)&&g.call(m)}finally{if(V)throw V.error}}return j},t=K&&K.__spread||function(){for(var d=[],a=0;a<arguments.length;a++)d=d.concat(r(arguments[a]));return d},n=K&&K.__values||function(d){var a=typeof Symbol=="function"&&d[Symbol.iterator],g=0;return a?a.call(d):{next:function(){return d&&g>=d.length&&(d=void 0),{value:d&&d[g++],done:!d}}}},o=K&&K.__importStar||function(d){if(d&&d.__esModule)return d;var a={};if(d!=null)for(var g in d)Object.hasOwnProperty.call(d,g)&&(a[g]=d[g]);return a.default=d,a};Object.defineProperty(e,"__esModule",{value:!0});var u=o(pt),c=function(){function d(a,g,m,w){this.hyperplanes=a,this.offsets=g,this.children=m,this.indices=w}return d}();e.FlatTree=c;function p(d,a,g,m){var w=Math.max(10,a),j=u.range(g).map(function(s,l){return y(d,w,l,m)}),V=j.map(function(s){return v(s,w)});return V}e.makeForest=p;function y(d,a,g,m){a===void 0&&(a=30);var w=u.range(d.length),j=k(d,w,a,g,m);return j}function k(d,a,g,m,w){if(g===void 0&&(g=30),a.length>g){var j=I(d,a,w),V=j.indicesLeft,s=j.indicesRight,l=j.hyperplane,f=j.offset,h=k(d,V,g,m+1,w),N=k(d,s,g,m+1,w),S={leftChild:h,rightChild:N,isLeaf:!1,hyperplane:l,offset:f};return S}else{var S={indices:a,isLeaf:!0};return S}}function I(d,a,g){var m=d[0].length,w=u.tauRandInt(a.length,g),j=u.tauRandInt(a.length,g);j+=w===j?1:0,j=j%a.length;for(var V=a[w],s=a[j],l=0,f=u.zeros(m),h=0;h<f.length;h++)f[h]=d[V][h]-d[s][h],l-=f[h]*(d[V][h]+d[s][h])/2;for(var N=0,S=0,R=u.zeros(a.length),h=0;h<a.length;h++){for(var T=l,O=0;O<m;O++)T+=f[O]*d[a[h]][O];T===0?(R[h]=u.tauRandInt(2,g),R[h]===0?N+=1:S+=1):T>0?(R[h]=0,N+=1):(R[h]=1,S+=1)}var P=u.zeros(N),L=u.zeros(S);N=0,S=0;for(var h=0;h<R.length;h++)R[h]===0?(P[N]=a[h],N+=1):(L[S]=a[h],S+=1);return{indicesLeft:P,indicesRight:L,hyperplane:f,offset:l}}function v(d,a){var g=M(d),m=E(d),w=u.range(g).map(function(){return u.zeros(d.hyperplane?d.hyperplane.length:0)}),j=u.zeros(g),V=u.range(g).map(function(){return[-1,-1]}),s=u.range(m).map(function(){return u.range(a).map(function(){return-1})});return F(d,w,j,V,s,0,0),new c(w,j,V,s)}function F(d,a,g,m,w,j,V){var s;if(d.isLeaf)return m[j][0]=-V,(s=w[V]).splice.apply(s,t([0,d.indices.length],d.indices)),V+=1,{nodeNum:j,leafNum:V};a[j]=d.hyperplane,g[j]=d.offset,m[j][0]=j+1;var l=j,f=F(d.leftChild,a,g,m,w,j+1,V);return j=f.nodeNum,V=f.leafNum,m[l][1]=j+1,f=F(d.rightChild,a,g,m,w,j+1,V),{nodeNum:f.nodeNum,leafNum:f.leafNum}}function M(d){return d.isLeaf?1:1+M(d.leftChild)+M(d.rightChild)}function E(d){return d.isLeaf?1:E(d.leftChild)+E(d.rightChild)}function z(d){var a,g;if(d.length>0){var m=[];try{for(var w=n(d),j=w.next();!j.done;j=w.next()){var V=j.value;m.push.apply(m,t(V.indices))}}catch(s){a={error:s}}finally{try{j&&!j.done&&(g=w.return)&&g.call(w)}finally{if(a)throw a.error}}return m}else return[[-1]]}e.makeLeafArray=z;function _(d,a,g,m){for(var w=a,j=0;j<g.length;j++)w+=d[j]*g[j];if(w===0){var V=u.tauRandInt(2,m);return V}else return w>0?0:1}function b(d,a,g){for(var m=0;a.children[m][0]>0;){var w=_(a.hyperplanes[m],a.offsets[m],d,g);w===0?m=a.children[m][0]:m=a.children[m][1]}var j=-1*a.children[m][0];return a.indices[j]}e.searchFlatTree=b}),Ot=lt(function(i,e){var r=K&&K.__values||function(v){var F=typeof Symbol=="function"&&v[Symbol.iterator],M=0;return F?F.call(v):{next:function(){return v&&M>=v.length&&(v=void 0),{value:v&&v[M++],done:!v}}}},t=K&&K.__importStar||function(v){if(v&&v.__esModule)return v;var F={};if(v!=null)for(var M in v)Object.hasOwnProperty.call(v,M)&&(F[M]=v[M]);return F.default=v,F};Object.defineProperty(e,"__esModule",{value:!0});var n=t(jt),o=t(kt),u=t(Rt),c=t(pt);function p(v,F){return function(E,z,_,b,d,a,g,m){b===void 0&&(b=10),d===void 0&&(d=50),a===void 0&&(a=.001),g===void 0&&(g=.5),m===void 0&&(m=!0);for(var w=E.length,j=n.makeHeap(E.length,_),V=0;V<E.length;V++)for(var s=n.rejectionSample(_,E.length,F),l=0;l<s.length;l++){var f=v(E[V],E[s[l]]);n.heapPush(j,V,f,s[l],1),n.heapPush(j,s[l],f,V,1)}if(m)for(var h=0;h<z.length;h++)for(var V=0;V<z[h].length&&!(z[h][V]<0);V++)for(var l=V+1;l<z[h].length&&!(z[h][l]<0);l++){var f=v(E[z[h][V]],E[z[h][l]]);n.heapPush(j,z[h][V],f,z[h][l],1),n.heapPush(j,z[h][l],f,z[h][V],1)}for(var h=0;h<b;h++){for(var N=n.buildCandidates(j,w,_,d,F),S=0,V=0;V<w;V++)for(var l=0;l<d;l++){var R=Math.floor(N[0][V][l]);if(!(R<0||c.tauRand(F)<g))for(var T=0;T<d;T++){var O=Math.floor(N[0][V][T]),P=N[2][V][l],L=N[2][V][T];if(!(O<0||!P&&!L)){var f=v(E[R],E[O]);S+=n.heapPush(j,R,f,O,1),S+=n.heapPush(j,O,f,R,1)}}}if(S<=a*_*E.length)break}var C=n.deheapSort(j);return C}}e.makeNNDescent=p;function y(v){function F(E,z,_,b,d){for(var a=0;a<_.length;a++)for(var g=c.rejectionSample(E,z.length,d),m=0;m<g.length;m++)if(!(g[m]<0)){var w=v(z[g[m]],_[a]);n.heapPush(b,a,w,g[m],1)}}function M(E,z,_,b,d){for(var a=0;a<_.length;a++)for(var g=u.searchFlatTree(_[a],E,d),m=0;m<g.length;m++){if(g[m]<0)return;var w=v(z[g[m]],_[a]);n.heapPush(b,a,w,g[m],1)}}return{initFromRandom:F,initFromTree:M}}e.makeInitializations=y;function k(v){return function(M,E,z,_){for(var b,d,a=o.getCSR(E),g=a.indices,m=a.indptr,w=0;w<_.length;w++)for(var j=new Set(z[0][w]);;){var V=n.smallestFlagged(z,w);if(V===-1)break;var s=g.slice(m[V],m[V+1]);try{for(var l=r(s),f=l.next();!f.done;f=l.next()){var h=f.value;if(!(h===V||h===-1||j.has(h))){var N=v(M[h],_[w]);n.uncheckedHeapPush(z,w,N,h,1),j.add(h)}}}catch(S){b={error:S}}finally{try{f&&!f.done&&(d=l.return)&&d.call(l)}finally{if(b)throw b.error}}}return z}}e.makeInitializedNNSearch=k;function I(v,F,M,E,z,_,b){var d,a,g=n.makeHeap(M.length,E);if(z(E,F,M,g,b),v)try{for(var m=r(v),w=m.next();!w.done;w=m.next()){var j=w.value;_(j,F,M,g,b)}}catch(V){d={error:V}}finally{try{w&&!w.done&&(a=m.return)&&a.call(m)}finally{if(d)throw d.error}}return g}e.initializeSearch=I});const Lt=Object.prototype.toString;function Et(i){return Lt.call(i).endsWith("Array]")}function Nt(i,e,r){let t=0;const n=r(e);for(let o=0;o<i.x.length;o++)t+=Math.abs(i.y[o]-n(i.x[o]));return t}const $t=Object.prototype.toString;function zt(i){return $t.call(i).endsWith("Array]")}const Ct=Object.prototype.toString;function qt(i){return Ct.call(i).endsWith("Array]")}function Dt(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qt(i))throw new TypeError("input must be an array");if(i.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,n=e.toIndex,o=n===void 0?i.length:n;if(t<0||t>=i.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>i.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var u=i[t],c=t+1;c<o;c++)i[c]>u&&(u=i[c]);return u}const Ut=Object.prototype.toString;function Bt(i){return Ut.call(i).endsWith("Array]")}function Wt(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bt(i))throw new TypeError("input must be an array");if(i.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,n=e.toIndex,o=n===void 0?i.length:n;if(t<0||t>=i.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>i.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var u=i[t],c=t+1;c<o;c++)i[c]<u&&(u=i[c]);return u}function _t(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(zt(i)){if(i.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(e.output!==void 0){if(!zt(e.output))throw new TypeError("output option must be an array if specified");r=e.output}else r=new Array(i.length);var t=Wt(i),n=Dt(i);if(t===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=e.min,u=o===void 0?e.autoMinMax?t:0:o,c=e.max,p=c===void 0?e.autoMinMax?n:1:c;if(u>=p)throw new RangeError("min option must be smaller than max option");for(var y=(p-u)/(n-t),k=0;k<i.length;k++)r[k]=(i[k]-t)*y+u;return r}const dt=" ".repeat(2),Pt=" ".repeat(4);function Kt(){return It(this)}function It(i,e={}){const{maxRows:r=15,maxColumns:t=10,maxNumSize:n=8}=e;return`${i.constructor.name} {
${dt}[
${Pt}${Gt(i,r,t,n)}
${dt}]
${dt}rows: ${i.rows}
${dt}columns: ${i.columns}
}`}function Gt(i,e,r,t){const{rows:n,columns:o}=i,u=Math.min(n,e),c=Math.min(o,r),p=[];for(let y=0;y<u;y++){let k=[];for(let I=0;I<c;I++)k.push(Qt(i.get(y,I),t));p.push(`${k.join(" ")}`)}return c!==o&&(p[p.length-1]+=` ... ${o-r} more columns`),u!==n&&p.push(`... ${n-e} more rows`),p.join(`
${Pt}`)}function Qt(i,e){const r=String(i);if(r.length<=e)return r.padEnd(e," ");const t=i.toPrecision(e-2);if(t.length<=e)return t;const n=i.toExponential(e-2),o=n.indexOf("e"),u=n.slice(o);return n.slice(0,e-u.length)+u}function Yt(i,e){i.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},i.prototype.addS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+t);return this},i.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+t.get(n,o));return this},i.add=function(t,n){return new e(t).add(n)},i.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},i.prototype.subS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-t);return this},i.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-t.get(n,o));return this},i.sub=function(t,n){return new e(t).sub(n)},i.prototype.subtract=i.prototype.sub,i.prototype.subtractS=i.prototype.subS,i.prototype.subtractM=i.prototype.subM,i.subtract=i.sub,i.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},i.prototype.mulS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*t);return this},i.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*t.get(n,o));return this},i.mul=function(t,n){return new e(t).mul(n)},i.prototype.multiply=i.prototype.mul,i.prototype.multiplyS=i.prototype.mulS,i.prototype.multiplyM=i.prototype.mulM,i.multiply=i.mul,i.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},i.prototype.divS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/t);return this},i.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/t.get(n,o));return this},i.div=function(t,n){return new e(t).div(n)},i.prototype.divide=i.prototype.div,i.prototype.divideS=i.prototype.divS,i.prototype.divideM=i.prototype.divM,i.divide=i.div,i.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},i.prototype.modS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%t);return this},i.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%t.get(n,o));return this},i.mod=function(t,n){return new e(t).mod(n)},i.prototype.modulus=i.prototype.mod,i.prototype.modulusS=i.prototype.modS,i.prototype.modulusM=i.prototype.modM,i.modulus=i.mod,i.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},i.prototype.andS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&t);return this},i.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&t.get(n,o));return this},i.and=function(t,n){return new e(t).and(n)},i.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},i.prototype.orS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|t);return this},i.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|t.get(n,o));return this},i.or=function(t,n){return new e(t).or(n)},i.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},i.prototype.xorS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^t);return this},i.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^t.get(n,o));return this},i.xor=function(t,n){return new e(t).xor(n)},i.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},i.prototype.leftShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<t);return this},i.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<t.get(n,o));return this},i.leftShift=function(t,n){return new e(t).leftShift(n)},i.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},i.prototype.signPropagatingRightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>t);return this},i.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>t.get(n,o));return this},i.signPropagatingRightShift=function(t,n){return new e(t).signPropagatingRightShift(n)},i.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},i.prototype.rightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>t);return this},i.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>t.get(n,o));return this},i.rightShift=function(t,n){return new e(t).rightShift(n)},i.prototype.zeroFillRightShift=i.prototype.rightShift,i.prototype.zeroFillRightShiftS=i.prototype.rightShiftS,i.prototype.zeroFillRightShiftM=i.prototype.rightShiftM,i.zeroFillRightShift=i.rightShift,i.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,~this.get(t,n));return this},i.not=function(t){return new e(t).not()},i.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.abs(this.get(t,n)));return this},i.abs=function(t){return new e(t).abs()},i.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acos(this.get(t,n)));return this},i.acos=function(t){return new e(t).acos()},i.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acosh(this.get(t,n)));return this},i.acosh=function(t){return new e(t).acosh()},i.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asin(this.get(t,n)));return this},i.asin=function(t){return new e(t).asin()},i.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asinh(this.get(t,n)));return this},i.asinh=function(t){return new e(t).asinh()},i.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atan(this.get(t,n)));return this},i.atan=function(t){return new e(t).atan()},i.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atanh(this.get(t,n)));return this},i.atanh=function(t){return new e(t).atanh()},i.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cbrt(this.get(t,n)));return this},i.cbrt=function(t){return new e(t).cbrt()},i.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.ceil(this.get(t,n)));return this},i.ceil=function(t){return new e(t).ceil()},i.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.clz32(this.get(t,n)));return this},i.clz32=function(t){return new e(t).clz32()},i.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cos(this.get(t,n)));return this},i.cos=function(t){return new e(t).cos()},i.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cosh(this.get(t,n)));return this},i.cosh=function(t){return new e(t).cosh()},i.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.exp(this.get(t,n)));return this},i.exp=function(t){return new e(t).exp()},i.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.expm1(this.get(t,n)));return this},i.expm1=function(t){return new e(t).expm1()},i.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.floor(this.get(t,n)));return this},i.floor=function(t){return new e(t).floor()},i.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.fround(this.get(t,n)));return this},i.fround=function(t){return new e(t).fround()},i.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log(this.get(t,n)));return this},i.log=function(t){return new e(t).log()},i.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log1p(this.get(t,n)));return this},i.log1p=function(t){return new e(t).log1p()},i.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log10(this.get(t,n)));return this},i.log10=function(t){return new e(t).log10()},i.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log2(this.get(t,n)));return this},i.log2=function(t){return new e(t).log2()},i.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.round(this.get(t,n)));return this},i.round=function(t){return new e(t).round()},i.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sign(this.get(t,n)));return this},i.sign=function(t){return new e(t).sign()},i.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sin(this.get(t,n)));return this},i.sin=function(t){return new e(t).sin()},i.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sinh(this.get(t,n)));return this},i.sinh=function(t){return new e(t).sinh()},i.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sqrt(this.get(t,n)));return this},i.sqrt=function(t){return new e(t).sqrt()},i.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tan(this.get(t,n)));return this},i.tan=function(t){return new e(t).tan()},i.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tanh(this.get(t,n)));return this},i.tanh=function(t){return new e(t).tanh()},i.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.trunc(this.get(t,n)));return this},i.trunc=function(t){return new e(t).trunc()},i.pow=function(t,n){return new e(t).pow(n)},i.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},i.prototype.powS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.pow(this.get(n,o),t));return this},i.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.pow(this.get(n,o),t.get(n,o)));return this}}function et(i,e,r){let t=r?i.rows:i.rows-1;if(e<0||e>t)throw new RangeError("Row index out of range")}function rt(i,e,r){let t=r?i.columns:i.columns-1;if(e<0||e>t)throw new RangeError("Column index out of range")}function ut(i,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==i.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function at(i,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==i.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function Xt(i,e,r){return{row:Jt(i,e),column:Zt(i,r)}}function Jt(i,e){if(typeof e!="object")throw new TypeError("unexpected type for row indices");if(e.some(t=>t<0||t>=i.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function Zt(i,e){if(typeof e!="object")throw new TypeError("unexpected type for column indices");if(e.some(t=>t<0||t>=i.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function Ft(i,e,r,t,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(St("startRow",e),St("endRow",r),St("startColumn",t),St("endColumn",n),e>r||t>n||e<0||e>=i.rows||r<0||r>=i.rows||t<0||t>=i.columns||n<0||n>=i.columns)throw new RangeError("Submatrix indices are out of range")}function yt(i,e=0){let r=[];for(let t=0;t<i;t++)r.push(e);return r}function St(i,e){if(typeof e!="number")throw new TypeError(`${i} must be a number`)}function ft(i){if(i.isEmpty())throw new Error("Empty matrix has no elements to index")}function Ht(i){let e=yt(i.rows);for(let r=0;r<i.rows;++r)for(let t=0;t<i.columns;++t)e[r]+=i.get(r,t);return e}function xt(i){let e=yt(i.columns);for(let r=0;r<i.rows;++r)for(let t=0;t<i.columns;++t)e[t]+=i.get(r,t);return e}function At(i){let e=0;for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)e+=i.get(r,t);return e}function te(i){let e=yt(i.rows,1);for(let r=0;r<i.rows;++r)for(let t=0;t<i.columns;++t)e[r]*=i.get(r,t);return e}function ee(i){let e=yt(i.columns,1);for(let r=0;r<i.rows;++r)for(let t=0;t<i.columns;++t)e[t]*=i.get(r,t);return e}function re(i){let e=1;for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)e*=i.get(r,t);return e}function ne(i,e,r){const t=i.rows,n=i.columns,o=[];for(let u=0;u<t;u++){let c=0,p=0,y=0;for(let k=0;k<n;k++)y=i.get(u,k)-r[u],c+=y,p+=y*y;e?o.push((p-c*c/n)/(n-1)):o.push((p-c*c/n)/n)}return o}function oe(i,e,r){const t=i.rows,n=i.columns,o=[];for(let u=0;u<n;u++){let c=0,p=0,y=0;for(let k=0;k<t;k++)y=i.get(k,u)-r[u],c+=y,p+=y*y;e?o.push((p-c*c/t)/(t-1)):o.push((p-c*c/t)/t)}return o}function ie(i,e,r){const t=i.rows,n=i.columns,o=t*n;let u=0,c=0,p=0;for(let y=0;y<t;y++)for(let k=0;k<n;k++)p=i.get(y,k)-r,u+=p,c+=p*p;return e?(c-u*u/o)/(o-1):(c-u*u/o)/o}function se(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)-e[r])}function le(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)-e[t])}function he(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)-e)}function ue(i){const e=[];for(let r=0;r<i.rows;r++){let t=0;for(let n=0;n<i.columns;n++)t+=Math.pow(i.get(r,n),2)/(i.columns-1);e.push(Math.sqrt(t))}return e}function ae(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)/e[r])}function fe(i){const e=[];for(let r=0;r<i.columns;r++){let t=0;for(let n=0;n<i.rows;n++)t+=Math.pow(i.get(n,r),2)/(i.rows-1);e.push(Math.sqrt(t))}return e}function ce(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)/e[t])}function ge(i){const e=i.size-1;let r=0;for(let t=0;t<i.columns;t++)for(let n=0;n<i.rows;n++)r+=Math.pow(i.get(n,t),2)/e;return Math.sqrt(r)}function me(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)/e)}class B{static from1DArray(e,r,t){if(e*r!==t.length)throw new RangeError("data length does not match given dimensions");let o=new q(e,r);for(let u=0;u<e;u++)for(let c=0;c<r;c++)o.set(u,c,t[u*r+c]);return o}static rowVector(e){let r=new q(1,e.length);for(let t=0;t<e.length;t++)r.set(0,t,e[t]);return r}static columnVector(e){let r=new q(e.length,1);for(let t=0;t<e.length;t++)r.set(t,0,e[t]);return r}static zeros(e,r){return new q(e,r)}static ones(e,r){return new q(e,r).fill(1)}static rand(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:n=Math.random}=t;let o=new q(e,r);for(let u=0;u<e;u++)for(let c=0;c<r;c++)o.set(u,c,n());return o}static randInt(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:o=1e3,random:u=Math.random}=t;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(n>=o)throw new RangeError("min must be smaller than max");let c=o-n,p=new q(e,r);for(let y=0;y<e;y++)for(let k=0;k<r;k++){let I=n+Math.round(u()*c);p.set(y,k,I)}return p}static eye(e,r,t){r===void 0&&(r=e),t===void 0&&(t=1);let n=Math.min(e,r),o=this.zeros(e,r);for(let u=0;u<n;u++)o.set(u,u,t);return o}static diag(e,r,t){let n=e.length;r===void 0&&(r=n),t===void 0&&(t=r);let o=Math.min(n,r,t),u=this.zeros(r,t);for(let c=0;c<o;c++)u.set(c,c,e[c]);return u}static min(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,n=e.columns,o=new q(t,n);for(let u=0;u<t;u++)for(let c=0;c<n;c++)o.set(u,c,Math.min(e.get(u,c),r.get(u,c)));return o}static max(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,n=e.columns,o=new this(t,n);for(let u=0;u<t;u++)for(let c=0;c<n;c++)o.set(u,c,Math.max(e.get(u,c),r.get(u,c)));return o}static checkMatrix(e){return B.isMatrix(e)?e:new q(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.call(this,r,t);return this}to1DArray(){let e=[];for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}to2DArray(){let e=[];for(let r=0;r<this.rows;r++){e.push([]);for(let t=0;t<this.columns;t++)e[r].push(this.get(r,t))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let r=0;r<=e;r++)if(this.get(e,r)!==this.get(r,e))return!1;return!0}return!1}isEchelonForm(){let e=0,r=0,t=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(n=!1,o=!0);e++}return n}isReducedEchelonForm(){let e=0,r=0,t=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(n=!1,o=!0);for(let u=r+1;u<this.rows;u++)this.get(e,u)!==0&&(n=!1);e++}return n}echelonForm(){let e=this.clone(),r=0,t=0;for(;r<e.rows&&t<e.columns;){let n=r;for(let o=r;o<e.rows;o++)e.get(o,t)>e.get(n,t)&&(n=o);if(e.get(n,t)===0)t++;else{e.swapRows(r,n);let o=e.get(r,t);for(let u=t;u<e.columns;u++)e.set(r,u,e.get(r,u)/o);for(let u=r+1;u<e.rows;u++){let c=e.get(u,t)/e.get(r,t);e.set(u,t,0);for(let p=t+1;p<e.columns;p++)e.set(u,p,e.get(u,p)-e.get(r,p)*c)}r++,t++}}return e}reducedEchelonForm(){let e=this.echelonForm(),r=e.columns,t=e.rows,n=t-1;for(;n>=0;)if(e.maxRow(n)===0)n--;else{let o=0,u=!1;for(;o<t&&u===!1;)e.get(n,o)===1?u=!0:o++;for(let c=0;c<n;c++){let p=e.get(c,o);for(let y=o;y<r;y++){let k=e.get(c,y)-p*e.get(n,y);e.set(c,y,k)}}n--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:t=1}=e;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let n=new q(this.rows*r,this.columns*t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)n.setSubMatrix(this,this.rows*o,this.columns*u);return n}fill(e){for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,e);return this}neg(){return this.mulS(-1)}getRow(e){et(this,e);let r=[];for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}getRowVector(e){return q.rowVector(this.getRow(e))}setRow(e,r){et(this,e),r=ut(this,r);for(let t=0;t<this.columns;t++)this.set(e,t,r[t]);return this}swapRows(e,r){et(this,e),et(this,r);for(let t=0;t<this.columns;t++){let n=this.get(e,t);this.set(e,t,this.get(r,t)),this.set(r,t,n)}return this}getColumn(e){rt(this,e);let r=[];for(let t=0;t<this.rows;t++)r.push(this.get(t,e));return r}getColumnVector(e){return q.columnVector(this.getColumn(e))}setColumn(e,r){rt(this,e),r=at(this,r);for(let t=0;t<this.rows;t++)this.set(t,e,r[t]);return this}swapColumns(e,r){rt(this,e),rt(this,r);for(let t=0;t<this.rows;t++){let n=this.get(t,e);this.set(t,e,this.get(t,r)),this.set(t,r,n)}return this}addRowVector(e){e=ut(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[t]);return this}subRowVector(e){e=ut(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[t]);return this}mulRowVector(e){e=ut(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[t]);return this}divRowVector(e){e=ut(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[t]);return this}addColumnVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[r]);return this}subColumnVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[r]);return this}mulColumnVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[r]);return this}divColumnVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[r]);return this}mulRow(e,r){et(this,e);for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r);return this}mulColumn(e,r){rt(this,e);for(let t=0;t<this.rows;t++)this.set(t,e,this.get(t,e)*r);return this}max(){if(this.isEmpty())return NaN;let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxIndex(){ft(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n),r[0]=t,r[1]=n);return r}min(){if(this.isEmpty())return NaN;let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minIndex(){ft(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n),r[0]=t,r[1]=n);return r}maxRow(e){if(et(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxRowIndex(e){et(this,e),ft(this);let r=this.get(e,0),t=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)>r&&(r=this.get(e,n),t[1]=n);return t}minRow(e){if(et(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)<r&&(r=this.get(e,t));return r}minRowIndex(e){et(this,e),ft(this);let r=this.get(e,0),t=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)<r&&(r=this.get(e,n),t[1]=n);return t}maxColumn(e){if(rt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxColumnIndex(e){rt(this,e),ft(this);let r=this.get(0,e),t=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)>r&&(r=this.get(n,e),t[0]=n);return t}minColumn(e){if(rt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)<r&&(r=this.get(t,e));return r}minColumnIndex(e){rt(this,e),ft(this);let r=this.get(0,e),t=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)<r&&(r=this.get(n,e),t[0]=n);return t}diag(){let e=Math.min(this.rows,this.columns),r=[];for(let t=0;t<e;t++)r.push(this.get(t,t));return r}norm(e="frobenius"){let r=0;if(e==="max")return this.max();if(e==="frobenius"){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)r=r+this.get(t,n)*this.get(t,n);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e+=this.get(r,t),this.set(r,t,e);return this}dot(e){B.isMatrix(e)&&(e=e.to1DArray());let r=this.to1DArray();if(r.length!==e.length)throw new RangeError("vectors do not have the same size");let t=0;for(let n=0;n<r.length;n++)t+=r[n]*e[n];return t}mmul(e){e=q.checkMatrix(e);let r=this.rows,t=this.columns,n=e.columns,o=new q(r,n),u=new Float64Array(t);for(let c=0;c<n;c++){for(let p=0;p<t;p++)u[p]=e.get(p,c);for(let p=0;p<r;p++){let y=0;for(let k=0;k<t;k++)y+=this.get(p,k)*u[k];o.set(p,c,y)}}return o}strassen2x2(e){e=q.checkMatrix(e);let r=new q(2,2);const t=this.get(0,0),n=e.get(0,0),o=this.get(0,1),u=e.get(0,1),c=this.get(1,0),p=e.get(1,0),y=this.get(1,1),k=e.get(1,1),I=(t+y)*(n+k),v=(c+y)*n,F=t*(u-k),M=y*(p-n),E=(t+o)*k,z=(c-t)*(n+u),_=(o-y)*(p+k),b=I+M-E+_,d=F+E,a=v+M,g=I-v+F+z;return r.set(0,0,b),r.set(0,1,d),r.set(1,0,a),r.set(1,1,g),r}strassen3x3(e){e=q.checkMatrix(e);let r=new q(3,3);const t=this.get(0,0),n=this.get(0,1),o=this.get(0,2),u=this.get(1,0),c=this.get(1,1),p=this.get(1,2),y=this.get(2,0),k=this.get(2,1),I=this.get(2,2),v=e.get(0,0),F=e.get(0,1),M=e.get(0,2),E=e.get(1,0),z=e.get(1,1),_=e.get(1,2),b=e.get(2,0),d=e.get(2,1),a=e.get(2,2),g=(t+n+o-u-c-k-I)*z,m=(t-u)*(-F+z),w=c*(-v+F+E-z-_-b+a),j=(-t+u+c)*(v-F+z),V=(u+c)*(-v+F),s=t*v,l=(-t+y+k)*(v-M+_),f=(-t+y)*(M-_),h=(y+k)*(-v+M),N=(t+n+o-c-p-y-k)*_,S=k*(-v+M+E-z-_-b+d),R=(-o+k+I)*(z+b-d),T=(o-I)*(z-d),O=o*b,P=(k+I)*(-b+d),L=(-o+c+p)*(_+b-a),C=(o-p)*(_-a),U=(c+p)*(-b+a),$=n*E,D=p*d,W=u*M,G=y*F,Q=I*a,J=s+O+$,Y=g+j+V+s+R+O+P,H=s+l+h+N+O+L+U,X=m+w+j+s+O+L+C,x=m+j+V+s+D,nt=O+L+C+U+W,A=s+l+f+S+R+T+O,it=R+T+O+P+G,ot=s+l+f+h+Q;return r.set(0,0,J),r.set(0,1,Y),r.set(0,2,H),r.set(1,0,X),r.set(1,1,x),r.set(1,2,nt),r.set(2,0,A),r.set(2,1,it),r.set(2,2,ot),r}mmulStrassen(e){e=q.checkMatrix(e);let r=this.clone(),t=r.rows,n=r.columns,o=e.rows,u=e.columns;n!==o&&console.warn(`Multiplying ${t} x ${n} and ${o} x ${u} matrix: dimensions do not match.`);function c(I,v,F){let M=I.rows,E=I.columns;if(M===v&&E===F)return I;{let z=B.zeros(v,F);return z=z.setSubMatrix(I,0,0),z}}let p=Math.max(t,o),y=Math.max(n,u);r=c(r,p,y),e=c(e,p,y);function k(I,v,F,M){if(F<=512||M<=512)return I.mmul(v);F%2==1&&M%2==1?(I=c(I,F+1,M+1),v=c(v,F+1,M+1)):F%2==1?(I=c(I,F+1,M),v=c(v,F+1,M)):M%2==1&&(I=c(I,F,M+1),v=c(v,F,M+1));let E=parseInt(I.rows/2,10),z=parseInt(I.columns/2,10),_=I.subMatrix(0,E-1,0,z-1),b=v.subMatrix(0,E-1,0,z-1),d=I.subMatrix(0,E-1,z,I.columns-1),a=v.subMatrix(0,E-1,z,v.columns-1),g=I.subMatrix(E,I.rows-1,0,z-1),m=v.subMatrix(E,v.rows-1,0,z-1),w=I.subMatrix(E,I.rows-1,z,I.columns-1),j=v.subMatrix(E,v.rows-1,z,v.columns-1),V=k(B.add(_,w),B.add(b,j),E,z),s=k(B.add(g,w),b,E,z),l=k(_,B.sub(a,j),E,z),f=k(w,B.sub(m,b),E,z),h=k(B.add(_,d),j,E,z),N=k(B.sub(g,_),B.add(b,a),E,z),S=k(B.sub(d,w),B.add(m,j),E,z),R=B.add(V,f);R.sub(h),R.add(S);let T=B.add(l,h),O=B.add(s,f),P=B.sub(V,s);P.add(l),P.add(N);let L=B.zeros(2*R.rows,2*R.columns);return L=L.setSubMatrix(R,0,0),L=L.setSubMatrix(T,R.rows,0),L=L.setSubMatrix(O,0,R.columns),L=L.setSubMatrix(P,R.rows,R.columns),L.subMatrix(0,F-1,0,M-1)}return k(r,e,p,y)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let n=new q(this.rows,this.columns);for(let o=0;o<this.rows;o++){const u=this.getRow(o);u.length>0&&_t(u,{min:r,max:t,output:u}),n.setRow(o,u)}return n}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let n=new q(this.rows,this.columns);for(let o=0;o<this.columns;o++){const u=this.getColumn(o);u.length&&_t(u,{min:r,max:t,output:u}),n.setColumn(o,u)}return n}flipRows(){const e=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let t=0;t<e;t++){let n=this.get(r,t),o=this.get(r,this.columns-1-t);this.set(r,t,o),this.set(r,this.columns-1-t,n)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let t=0;t<e;t++){let n=this.get(t,r),o=this.get(this.rows-1-t,r);this.set(t,r,o),this.set(this.rows-1-t,r,n)}return this}kroneckerProduct(e){e=q.checkMatrix(e);let r=this.rows,t=this.columns,n=e.rows,o=e.columns,u=new q(r*n,t*o);for(let c=0;c<r;c++)for(let p=0;p<t;p++)for(let y=0;y<n;y++)for(let k=0;k<o;k++)u.set(n*c+y,o*p+k,this.get(c,p)*e.get(y,k));return u}kroneckerSum(e){if(e=q.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,t=e.rows,n=this.kroneckerProduct(q.eye(t,t)),o=q.eye(r,r).kroneckerProduct(e);return n.add(o)}transpose(){let e=new q(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(t,r,this.get(r,t));return e}sortRows(e=Vt){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(e));return this}sortColumns(e=Vt){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(e));return this}subMatrix(e,r,t,n){Ft(this,e,r,t,n);let o=new q(r-e+1,n-t+1);for(let u=e;u<=r;u++)for(let c=t;c<=n;c++)o.set(u-e,c-t,this.get(u,c));return o}subMatrixRow(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.columns-1),r>t||r<0||r>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let n=new q(e.length,t-r+1);for(let o=0;o<e.length;o++)for(let u=r;u<=t;u++){if(e[o]<0||e[o]>=this.rows)throw new RangeError(`Row index out of range: ${e[o]}`);n.set(o,u-r,this.get(e[o],u))}return n}subMatrixColumn(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.rows-1),r>t||r<0||r>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let n=new q(t-r+1,e.length);for(let o=0;o<e.length;o++)for(let u=r;u<=t;u++){if(e[o]<0||e[o]>=this.columns)throw new RangeError(`Column index out of range: ${e[o]}`);n.set(u-r,o,this.get(u,e[o]))}return n}setSubMatrix(e,r,t){if(e=q.checkMatrix(e),e.isEmpty())return this;let n=r+e.rows-1,o=t+e.columns-1;Ft(this,r,n,t,o);for(let u=0;u<e.rows;u++)for(let c=0;c<e.columns;c++)this.set(r+u,t+c,e.get(u,c));return this}selection(e,r){let t=Xt(this,e,r),n=new q(e.length,r.length);for(let o=0;o<t.row.length;o++){let u=t.row[o];for(let c=0;c<t.column.length;c++){let p=t.column[c];n.set(o,c,this.get(u,p))}}return n}trace(){let e=Math.min(this.rows,this.columns),r=0;for(let t=0;t<e;t++)r+=this.get(t,t);return r}clone(){let e=new q(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(r,t,this.get(r,t));return e}sum(e){switch(e){case"row":return Ht(this);case"column":return xt(this);case void 0:return At(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return te(this);case"column":return ee(this);case void 0:return re(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const r=this.sum(e);switch(e){case"row":{for(let t=0;t<this.rows;t++)r[t]/=this.columns;return r}case"column":{for(let t=0;t<this.columns;t++)r[t]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:n=this.mean(e)}=r;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Array.isArray(n))throw new TypeError("mean must be an array");return ne(this,t,n)}case"column":{if(!Array.isArray(n))throw new TypeError("mean must be an array");return oe(this,t,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return ie(this,t,n)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,r){typeof e=="object"&&(r=e,e=void 0);const t=this.variance(e,r);if(e===void 0)return Math.sqrt(t);for(let n=0;n<t.length;n++)t[n]=Math.sqrt(t[n]);return t}center(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:t=this.mean(e)}=r;switch(e){case"row":{if(!Array.isArray(t))throw new TypeError("center must be an array");return se(this,t),this}case"column":{if(!Array.isArray(t))throw new TypeError("center must be an array");return le(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return he(this,t),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let t=r.scale;switch(e){case"row":{if(t===void 0)t=ue(this);else if(!Array.isArray(t))throw new TypeError("scale must be an array");return ae(this,t),this}case"column":{if(t===void 0)t=fe(this);else if(!Array.isArray(t))throw new TypeError("scale must be an array");return ce(this,t),this}case void 0:{if(t===void 0)t=ge(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return me(this,t),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return It(this,e)}}B.prototype.klass="Matrix",typeof Symbol!="undefined"&&(B.prototype[Symbol.for("nodejs.util.inspect.custom")]=Kt);function Vt(i,e){return i-e}B.random=B.rand,B.randomInt=B.randInt,B.diagonal=B.diag,B.prototype.diagonal=B.prototype.diag,B.identity=B.eye,B.prototype.negate=B.prototype.neg,B.prototype.tensorProduct=B.prototype.kroneckerProduct;class q extends B{constructor(e,r){super();if(q.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let t=0;t<e;t++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(Array.isArray(e)){const t=e;if(e=t.length,r=e?t[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(t[n].length!==r)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(t[n]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=r}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}removeRow(e){return et(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),et(this,e,!0),r=Float64Array.from(ut(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){rt(this,e);for(let r=0;r<this.rows;r++){const t=new Float64Array(this.columns-1);for(let n=0;n<e;n++)t[n]=this.data[r][n];for(let n=e+1;n<this.columns;n++)t[n-1]=this.data[r][n];this.data[r]=t}return this.columns-=1,this}addColumn(e,r){typeof r=="undefined"&&(r=e,e=this.columns),rt(this,e,!0),r=at(this,r);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns+1);let o=0;for(;o<e;o++)n[o]=this.data[t][o];for(n[o++]=r[t];o<this.columns+1;o++)n[o]=this.data[t][o-1];this.data[t]=n}return this.columns+=1,this}}Yt(B,q);class ct extends B{constructor(e){super();this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}}class pe{constructor(e){e=ct.checkMatrix(e);let r=e.clone(),t=r.rows,n=r.columns,o=new Float64Array(t),u=1,c,p,y,k,I,v,F,M,E;for(c=0;c<t;c++)o[c]=c;for(M=new Float64Array(t),p=0;p<n;p++){for(c=0;c<t;c++)M[c]=r.get(c,p);for(c=0;c<t;c++){for(E=Math.min(c,p),I=0,y=0;y<E;y++)I+=r.get(c,y)*M[y];M[c]-=I,r.set(c,p,M[c])}for(k=p,c=p+1;c<t;c++)Math.abs(M[c])>Math.abs(M[k])&&(k=c);if(k!==p){for(y=0;y<n;y++)v=r.get(k,y),r.set(k,y,r.get(p,y)),r.set(p,y,v);F=o[k],o[k]=o[p],o[p]=F,u=-u}if(p<t&&r.get(p,p)!==0)for(c=p+1;c<t;c++)r.set(c,p,r.get(c,p)/r.get(p,p))}this.LU=r,this.pivotVector=o,this.pivotSign=u}isSingular(){let e=this.LU,r=e.columns;for(let t=0;t<r;t++)if(e.get(t,t)===0)return!0;return!1}solve(e){e=q.checkMatrix(e);let r=this.LU;if(r.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=e.columns,o=e.subMatrixRow(this.pivotVector,0,n-1),u=r.columns,c,p,y;for(y=0;y<u;y++)for(c=y+1;c<u;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y));for(y=u-1;y>=0;y--){for(p=0;p<n;p++)o.set(y,p,o.get(y,p)/r.get(y,y));for(c=0;c<y;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y))}return o}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,t=e.columns;for(let n=0;n<t;n++)r*=e.get(n,n);return r}get lowerTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,n=new q(r,t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)o>u?n.set(o,u,e.get(o,u)):o===u?n.set(o,u,1):n.set(o,u,0);return n}get upperTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,n=new q(r,t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)o<=u?n.set(o,u,e.get(o,u)):n.set(o,u,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ht(i,e){let r=0;return Math.abs(i)>Math.abs(e)?(r=e/i,Math.abs(i)*Math.sqrt(1+r*r)):e!==0?(r=i/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class we{constructor(e){e=ct.checkMatrix(e);let r=e.clone(),t=e.rows,n=e.columns,o=new Float64Array(n),u,c,p,y;for(p=0;p<n;p++){let k=0;for(u=p;u<t;u++)k=ht(k,r.get(u,p));if(k!==0){for(r.get(p,p)<0&&(k=-k),u=p;u<t;u++)r.set(u,p,r.get(u,p)/k);for(r.set(p,p,r.get(p,p)+1),c=p+1;c<n;c++){for(y=0,u=p;u<t;u++)y+=r.get(u,p)*r.get(u,c);for(y=-y/r.get(p,p),u=p;u<t;u++)r.set(u,c,r.get(u,c)+y*r.get(u,p))}}o[p]=-k}this.QR=r,this.Rdiag=o}solve(e){e=q.checkMatrix(e);let r=this.QR,t=r.rows;if(e.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=e.columns,o=e.clone(),u=r.columns,c,p,y,k;for(y=0;y<u;y++)for(p=0;p<n;p++){for(k=0,c=y;c<t;c++)k+=r.get(c,y)*o.get(c,p);for(k=-k/r.get(y,y),c=y;c<t;c++)o.set(c,p,o.get(c,p)+k*r.get(c,y))}for(y=u-1;y>=0;y--){for(p=0;p<n;p++)o.set(y,p,o.get(y,p)/this.Rdiag[y]);for(c=0;c<y;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y))}return o.subMatrix(0,u-1,0,n-1)}isFullRank(){let e=this.QR.columns;for(let r=0;r<e;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,r=e.columns,t=new q(r,r),n,o;for(n=0;n<r;n++)for(o=0;o<r;o++)n<o?t.set(n,o,e.get(n,o)):n===o?t.set(n,o,this.Rdiag[n]):t.set(n,o,0);return t}get orthogonalMatrix(){let e=this.QR,r=e.rows,t=e.columns,n=new q(r,t),o,u,c,p;for(c=t-1;c>=0;c--){for(o=0;o<r;o++)n.set(o,c,0);for(n.set(c,c,1),u=c;u<t;u++)if(e.get(c,c)!==0){for(p=0,o=c;o<r;o++)p+=e.get(o,c)*n.get(o,u);for(p=-p/e.get(c,c),o=c;o<r;o++)n.set(o,u,n.get(o,u)+p*e.get(o,c))}}return n}}class Tt{constructor(e,r={}){if(e=ct.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let t=e.rows,n=e.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:u=!0,autoTranspose:c=!1}=r;let p=Boolean(o),y=Boolean(u),k=!1,I;if(t<n)if(!c)I=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{I=e.transpose(),t=I.rows,n=I.columns,k=!0;let s=p;p=y,y=s}else I=e.clone();let v=Math.min(t,n),F=Math.min(t+1,n),M=new Float64Array(F),E=new q(t,v),z=new q(n,n),_=new Float64Array(n),b=new Float64Array(t),d=new Float64Array(F);for(let s=0;s<F;s++)d[s]=s;let a=Math.min(t-1,n),g=Math.max(0,Math.min(n-2,t)),m=Math.max(a,g);for(let s=0;s<m;s++){if(s<a){M[s]=0;for(let l=s;l<t;l++)M[s]=ht(M[s],I.get(l,s));if(M[s]!==0){I.get(s,s)<0&&(M[s]=-M[s]);for(let l=s;l<t;l++)I.set(l,s,I.get(l,s)/M[s]);I.set(s,s,I.get(s,s)+1)}M[s]=-M[s]}for(let l=s+1;l<n;l++){if(s<a&&M[s]!==0){let f=0;for(let h=s;h<t;h++)f+=I.get(h,s)*I.get(h,l);f=-f/I.get(s,s);for(let h=s;h<t;h++)I.set(h,l,I.get(h,l)+f*I.get(h,s))}_[l]=I.get(s,l)}if(p&&s<a)for(let l=s;l<t;l++)E.set(l,s,I.get(l,s));if(s<g){_[s]=0;for(let l=s+1;l<n;l++)_[s]=ht(_[s],_[l]);if(_[s]!==0){_[s+1]<0&&(_[s]=0-_[s]);for(let l=s+1;l<n;l++)_[l]/=_[s];_[s+1]+=1}if(_[s]=-_[s],s+1<t&&_[s]!==0){for(let l=s+1;l<t;l++)b[l]=0;for(let l=s+1;l<t;l++)for(let f=s+1;f<n;f++)b[l]+=_[f]*I.get(l,f);for(let l=s+1;l<n;l++){let f=-_[l]/_[s+1];for(let h=s+1;h<t;h++)I.set(h,l,I.get(h,l)+f*b[h])}}if(y)for(let l=s+1;l<n;l++)z.set(l,s,_[l])}}let w=Math.min(n,t+1);if(a<n&&(M[a]=I.get(a,a)),t<w&&(M[w-1]=0),g+1<w&&(_[g]=I.get(g,w-1)),_[w-1]=0,p){for(let s=a;s<v;s++){for(let l=0;l<t;l++)E.set(l,s,0);E.set(s,s,1)}for(let s=a-1;s>=0;s--)if(M[s]!==0){for(let l=s+1;l<v;l++){let f=0;for(let h=s;h<t;h++)f+=E.get(h,s)*E.get(h,l);f=-f/E.get(s,s);for(let h=s;h<t;h++)E.set(h,l,E.get(h,l)+f*E.get(h,s))}for(let l=s;l<t;l++)E.set(l,s,-E.get(l,s));E.set(s,s,1+E.get(s,s));for(let l=0;l<s-1;l++)E.set(l,s,0)}else{for(let l=0;l<t;l++)E.set(l,s,0);E.set(s,s,1)}}if(y)for(let s=n-1;s>=0;s--){if(s<g&&_[s]!==0)for(let l=s+1;l<n;l++){let f=0;for(let h=s+1;h<n;h++)f+=z.get(h,s)*z.get(h,l);f=-f/z.get(s+1,s);for(let h=s+1;h<n;h++)z.set(h,l,z.get(h,l)+f*z.get(h,s))}for(let l=0;l<n;l++)z.set(l,s,0);z.set(s,s,1)}let j=w-1,V=Number.EPSILON;for(;w>0;){let s,l;for(s=w-2;s>=-1&&s!==-1;s--){const f=Number.MIN_VALUE+V*Math.abs(M[s]+Math.abs(M[s+1]));if(Math.abs(_[s])<=f||Number.isNaN(_[s])){_[s]=0;break}}if(s===w-2)l=4;else{let f;for(f=w-1;f>=s&&f!==s;f--){let h=(f!==w?Math.abs(_[f]):0)+(f!==s+1?Math.abs(_[f-1]):0);if(Math.abs(M[f])<=V*h){M[f]=0;break}}f===s?l=3:f===w-1?l=1:(l=2,s=f)}switch(s++,l){case 1:{let f=_[w-2];_[w-2]=0;for(let h=w-2;h>=s;h--){let N=ht(M[h],f),S=M[h]/N,R=f/N;if(M[h]=N,h!==s&&(f=-R*_[h-1],_[h-1]=S*_[h-1]),y)for(let T=0;T<n;T++)N=S*z.get(T,h)+R*z.get(T,w-1),z.set(T,w-1,-R*z.get(T,h)+S*z.get(T,w-1)),z.set(T,h,N)}break}case 2:{let f=_[s-1];_[s-1]=0;for(let h=s;h<w;h++){let N=ht(M[h],f),S=M[h]/N,R=f/N;if(M[h]=N,f=-R*_[h],_[h]=S*_[h],p)for(let T=0;T<t;T++)N=S*E.get(T,h)+R*E.get(T,s-1),E.set(T,s-1,-R*E.get(T,h)+S*E.get(T,s-1)),E.set(T,h,N)}break}case 3:{const f=Math.max(Math.abs(M[w-1]),Math.abs(M[w-2]),Math.abs(_[w-2]),Math.abs(M[s]),Math.abs(_[s])),h=M[w-1]/f,N=M[w-2]/f,S=_[w-2]/f,R=M[s]/f,T=_[s]/f,O=((N+h)*(N-h)+S*S)/2,P=h*S*(h*S);let L=0;(O!==0||P!==0)&&(O<0?L=0-Math.sqrt(O*O+P):L=Math.sqrt(O*O+P),L=P/(O+L));let C=(R+h)*(R-h)+L,U=R*T;for(let $=s;$<w-1;$++){let D=ht(C,U);D===0&&(D=Number.MIN_VALUE);let W=C/D,G=U/D;if($!==s&&(_[$-1]=D),C=W*M[$]+G*_[$],_[$]=W*_[$]-G*M[$],U=G*M[$+1],M[$+1]=W*M[$+1],y)for(let Q=0;Q<n;Q++)D=W*z.get(Q,$)+G*z.get(Q,$+1),z.set(Q,$+1,-G*z.get(Q,$)+W*z.get(Q,$+1)),z.set(Q,$,D);if(D=ht(C,U),D===0&&(D=Number.MIN_VALUE),W=C/D,G=U/D,M[$]=D,C=W*_[$]+G*M[$+1],M[$+1]=-G*_[$]+W*M[$+1],U=G*_[$+1],_[$+1]=W*_[$+1],p&&$<t-1)for(let Q=0;Q<t;Q++)D=W*E.get(Q,$)+G*E.get(Q,$+1),E.set(Q,$+1,-G*E.get(Q,$)+W*E.get(Q,$+1)),E.set(Q,$,D)}_[w-2]=C;break}case 4:{if(M[s]<=0&&(M[s]=M[s]<0?-M[s]:0,y))for(let f=0;f<=j;f++)z.set(f,s,-z.get(f,s));for(;s<j&&!(M[s]>=M[s+1]);){let f=M[s];if(M[s]=M[s+1],M[s+1]=f,y&&s<n-1)for(let h=0;h<n;h++)f=z.get(h,s+1),z.set(h,s+1,z.get(h,s)),z.set(h,s,f);if(p&&s<t-1)for(let h=0;h<t;h++)f=E.get(h,s+1),E.set(h,s+1,E.get(h,s)),E.set(h,s,f);s++}w--;break}}}if(k){let s=z;z=E,E=s}this.m=t,this.n=n,this.s=M,this.U=E,this.V=z}solve(e){let r=e,t=this.threshold,n=this.s.length,o=q.zeros(n,n);for(let v=0;v<n;v++)Math.abs(this.s[v])<=t?o.set(v,v,0):o.set(v,v,1/this.s[v]);let u=this.U,c=this.rightSingularVectors,p=c.mmul(o),y=c.rows,k=u.rows,I=q.zeros(y,k);for(let v=0;v<y;v++)for(let F=0;F<k;F++){let M=0;for(let E=0;E<n;E++)M+=p.get(v,E)*u.get(F,E);I.set(v,F,M)}return I.mmul(r)}solveForDiagonal(e){return this.solve(q.diag(e))}inverse(){let e=this.V,r=this.threshold,t=e.rows,n=e.columns,o=new q(t,this.s.length);for(let k=0;k<t;k++)for(let I=0;I<n;I++)Math.abs(this.s[I])>r&&o.set(k,I,e.get(k,I)/this.s[I]);let u=this.U,c=u.rows,p=u.columns,y=new q(t,c);for(let k=0;k<t;k++)for(let I=0;I<c;I++){let v=0;for(let F=0;F<p;F++)v+=o.get(k,F)*u.get(I,F);y.set(k,I,v)}return y}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,t=this.s;for(let n=0,o=t.length;n<o;n++)t[n]>e&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return q.diag(this.s)}}function ve(i,e=!1){return i=ct.checkMatrix(i),e?new Tt(i).inverse():de(i,q.eye(i.rows))}function de(i,e,r=!1){return i=ct.checkMatrix(i),e=ct.checkMatrix(e),r?new Tt(i).solve(e):i.isSquare()?new pe(i).solve(e):new we(i).solve(e)}function ye(i,e,r,t,n){const o=r.length,u=i.x.length;let c=new Array(o);for(let p=0;p<o;p++){c[p]=new Array(u);let y=r.slice();y[p]+=t;let k=n(y);for(let I=0;I<u;I++)c[p][I]=e[I]-k(i.x[I])}return new q(c)}function Se(i,e){const r=i.x.length;let t=new Array(r);for(let n=0;n<r;n++)t[n]=[i.y[n]-e[n]];return new q(t)}function Me(i,e,r,t,n){let o=r*t*t,u=q.eye(e.length,e.length,o);const c=n(e);let p=new Float64Array(i.x.length);for(let v=0;v<i.x.length;v++)p[v]=c(i.x[v]);let y=ye(i,p,e,t,n),k=Se(i,p),I=ve(u.add(y.mmul(y.transpose())));return e=new q([e]),e=e.sub(I.mmul(y).mmul(k).mul(t).transpose()),e.to1DArray()}function Ee(i,e,r={}){let{maxIterations:t=100,gradientDifference:n=.1,damping:o=0,errorTolerance:u=.01,minValues:c,maxValues:p,initialValues:y}=r;if(o<=0)throw new Error("The damping option must be a positive number");if(!i.x||!i.y)throw new Error("The data parameter must have x and y elements");if(!Et(i.x)||i.x.length<2||!Et(i.y)||i.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(i.x.length!==i.y.length)throw new Error("The data parameter elements must have the same size");let k=y||new Array(e.length).fill(1),I=k.length;if(p=p||new Array(I).fill(Number.MAX_SAFE_INTEGER),c=c||new Array(I).fill(Number.MIN_SAFE_INTEGER),p.length!==c.length)throw new Error("minValues and maxValues must be the same size");if(!Et(k))throw new Error("initialValues must be an array");let v=Nt(i,k,e),F=v<=u,M;for(M=0;M<t&&!F;M++){k=Me(i,k,o,n,e);for(let E=0;E<I;E++)k[E]=Math.min(Math.max(c[E],k[E]),p[E]);if(v=Nt(i,k,e),isNaN(v))break;F=v<=u}return{parameterValues:k,parameterError:v,iterations:M}}var be=lt(function(i,e){var r=K&&K.__awaiter||function(s,l,f,h){return new(f||(f=Promise))(function(N,S){function R(P){try{O(h.next(P))}catch(L){S(L)}}function T(P){try{O(h.throw(P))}catch(L){S(L)}}function O(P){P.done?N(P.value):new f(function(L){L(P.value)}).then(R,T)}O((h=h.apply(s,l||[])).next())})},t=K&&K.__generator||function(s,l){var f={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},h,N,S,R;return R={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function T(P){return function(L){return O([P,L])}}function O(P){if(h)throw new TypeError("Generator is already executing.");for(;f;)try{if(h=1,N&&(S=P[0]&2?N.return:P[0]?N.throw||((S=N.return)&&S.call(N),0):N.next)&&!(S=S.call(N,P[1])).done)return S;switch(N=0,S&&(P=[P[0]&2,S.value]),P[0]){case 0:case 1:S=P;break;case 4:return f.label++,{value:P[1],done:!1};case 5:f.label++,N=P[1],P=[0];continue;case 7:P=f.ops.pop(),f.trys.pop();continue;default:if(S=f.trys,!(S=S.length>0&&S[S.length-1])&&(P[0]===6||P[0]===2)){f=0;continue}if(P[0]===3&&(!S||P[1]>S[0]&&P[1]<S[3])){f.label=P[1];break}if(P[0]===6&&f.label<S[1]){f.label=S[1],S=P;break}if(S&&f.label<S[2]){f.label=S[2],f.ops.push(P);break}S[2]&&f.ops.pop(),f.trys.pop();continue}P=l.call(s,f)}catch(L){P=[6,L],N=0}finally{h=S=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}},n=K&&K.__read||function(s,l){var f=typeof Symbol=="function"&&s[Symbol.iterator];if(!f)return s;var h=f.call(s),N,S=[],R;try{for(;(l===void 0||l-- >0)&&!(N=h.next()).done;)S.push(N.value)}catch(T){R={error:T}}finally{try{N&&!N.done&&(f=h.return)&&f.call(h)}finally{if(R)throw R.error}}return S},o=K&&K.__spread||function(){for(var s=[],l=0;l<arguments.length;l++)s=s.concat(n(arguments[l]));return s},u=K&&K.__importStar||function(s){if(s&&s.__esModule)return s;var l={};if(s!=null)for(var f in s)Object.hasOwnProperty.call(s,f)&&(l[f]=s[f]);return l.default=s,l},c=K&&K.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0});var p=u(jt),y=u(kt),k=u(Ot),I=u(Rt),v=u(pt),F=c(Ee),M=1e-5,E=.001,z=function(){function s(l){l===void 0&&(l={});var f=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=_,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new d;var h=function(N){l[N]!==void 0&&(f[N]=l[N])};h("distanceFn"),h("learningRate"),h("localConnectivity"),h("minDist"),h("nComponents"),h("nEpochs"),h("nNeighbors"),h("negativeSampleRate"),h("random"),h("repulsionStrength"),h("setOpMixRatio"),h("spread"),h("transformQueueSize")}return s.prototype.fit=function(l){return this.initializeFit(l),this.optimizeLayout(),this.embedding},s.prototype.fitAsync=function(l,f){return f===void 0&&(f=function(){return!0}),r(this,void 0,void 0,function(){return t(this,function(h){switch(h.label){case 0:return this.initializeFit(l),[4,this.optimizeLayoutAsync(f)];case 1:return h.sent(),[2,this.embedding]}})})},s.prototype.setSupervisedProjection=function(l,f){f===void 0&&(f={}),this.Y=l,this.targetMetric=f.targetMetric||this.targetMetric,this.targetWeight=f.targetWeight||this.targetWeight,this.targetNNeighbors=f.targetNNeighbors||this.targetNNeighbors},s.prototype.setPrecomputedKNN=function(l,f){this.knnIndices=l,this.knnDistances=f},s.prototype.initializeFit=function(l){if(l.length<=this.nNeighbors)throw new Error("Not enough data points ("+l.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===l&&this.isInitialized)return this.getNEpochs();if(this.X=l,!this.knnIndices&&!this.knnDistances){var f=this.nearestNeighbors(l);this.knnIndices=f.knnIndices,this.knnDistances=f.knnDistances}this.graph=this.fuzzySimplicialSet(l,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(l),this.processGraphForSupervisedProjection();var h=this.initializeSimplicialSetEmbedding(),N=h.head,S=h.tail,R=h.epochsPerSample;return this.optimizationState.head=N,this.optimizationState.tail=S,this.optimizationState.epochsPerSample=R,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},s.prototype.makeSearchFns=function(){var l=k.makeInitializations(this.distanceFn),f=l.initFromTree,h=l.initFromRandom;this.initFromTree=f,this.initFromRandom=h,this.search=k.makeInitializedNNSearch(this.distanceFn)},s.prototype.makeSearchGraph=function(l){for(var f=this.knnIndices,h=this.knnDistances,N=[l.length,l.length],S=new y.SparseMatrix([],[],[],N),R=0;R<f.length;R++)for(var T=f[R],O=h[R],P=0;P<T.length;P++){var L=T[P],C=O[P];C>0&&S.set(R,L,C)}var U=y.transpose(S);return y.maximum(S,U)},s.prototype.transform=function(l){var f=this,h=this.X;if(h===void 0||h.length===0)throw new Error("No data has been fit.");var N=Math.floor(this.nNeighbors*this.transformQueueSize);N=Math.min(h.length,N);var S=k.initializeSearch(this.rpForest,h,l,N,this.initFromRandom,this.initFromTree,this.random),R=this.search(h,this.searchGraph,S,l),T=p.deheapSort(R),O=T.indices,P=T.weights;O=O.map(function(tt){return tt.slice(0,f.nNeighbors)}),P=P.map(function(tt){return tt.slice(0,f.nNeighbors)});var L=Math.max(0,this.localConnectivity-1),C=this.smoothKNNDistance(P,this.nNeighbors,L),U=C.sigmas,$=C.rhos,D=this.computeMembershipStrengths(O,P,U,$),W=D.rows,G=D.cols,Q=D.vals,J=[l.length,h.length],Y=new y.SparseMatrix(W,G,Q,J),H=y.normalize(Y,"l1"),X=y.getCSR(H),x=l.length,nt=v.reshape2d(X.indices,x,this.nNeighbors),A=v.reshape2d(X.values,x,this.nNeighbors),it=V(nt,A,this.embedding),ot=this.nEpochs?this.nEpochs/3:Y.nRows<=1e4?100:30,gt=Y.getValues().reduce(function(tt,mt){return mt>tt?mt:tt},0);Y=Y.map(function(tt){return tt<gt/ot?0:tt}),Y=y.eliminateZeros(Y);var Z=this.makeEpochsPerSample(Y.getValues(),ot),st=Y.getRows(),wt=Y.getCols();return this.assignOptimizationStateParameters({headEmbedding:it,tailEmbedding:this.embedding,head:st,tail:wt,currentEpoch:0,nEpochs:ot,nVertices:Y.getDims()[1],epochsPerSample:Z}),this.prepareForOptimizationLoop(),this.optimizeLayout()},s.prototype.processGraphForSupervisedProjection=function(){var l=this,f=l.Y,h=l.X;if(f){if(f.length!==h.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var N=this.targetWeight<1,S=N?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,f,S)}}},s.prototype.step=function(){var l=this.optimizationState.currentEpoch;return l<this.getNEpochs()&&this.optimizeLayoutStep(l),this.optimizationState.currentEpoch},s.prototype.getEmbedding=function(){return this.embedding},s.prototype.nearestNeighbors=function(l){var f=this,h=f.distanceFn,N=f.nNeighbors,S=function(D){return Math.log(D)/Math.log(2)},R=k.makeNNDescent(h,this.random),T=function(D){return D===.5?0:Math.round(D)},O=5+Math.floor(T(Math.pow(l.length,.5)/20)),P=Math.max(5,Math.floor(Math.round(S(l.length))));this.rpForest=I.makeForest(l,N,O,this.random);var L=I.makeLeafArray(this.rpForest),C=R(l,L,N,P),U=C.indices,$=C.weights;return{knnIndices:U,knnDistances:$}},s.prototype.fuzzySimplicialSet=function(l,f,h){h===void 0&&(h=1);var N=this,S=N.knnIndices,R=S===void 0?[]:S,T=N.knnDistances,O=T===void 0?[]:T,P=N.localConnectivity,L=this.smoothKNNDistance(O,f,P),C=L.sigmas,U=L.rhos,$=this.computeMembershipStrengths(R,O,C,U),D=$.rows,W=$.cols,G=$.vals,Q=[l.length,l.length],J=new y.SparseMatrix(D,W,G,Q),Y=y.transpose(J),H=y.pairwiseMultiply(J,Y),X=y.subtract(y.add(J,Y),H),x=y.multiplyScalar(X,h),nt=y.multiplyScalar(H,1-h),A=y.add(x,nt);return A},s.prototype.categoricalSimplicialSetIntersection=function(l,f,h,N){N===void 0&&(N=1);var S=w(l,f,N,h);return S=y.eliminateZeros(S),j(S)},s.prototype.smoothKNNDistance=function(l,f,h,N,S){h===void 0&&(h=1),N===void 0&&(N=64),S===void 0&&(S=1);for(var R=Math.log(f)/Math.log(2)*S,T=v.zeros(l.length),O=v.zeros(l.length),P=0;P<l.length;P++){var L=0,C=Infinity,U=1,$=l[P],D=$.filter(function(nt){return nt>0});if(D.length>=h){var W=Math.floor(h),G=h-W;W>0?(T[P]=D[W-1],G>M&&(T[P]+=G*(D[W]-D[W-1]))):T[P]=G*D[0]}else D.length>0&&(T[P]=v.max(D));for(var Q=0;Q<N;Q++){for(var J=0,Y=1;Y<l[P].length;Y++){var H=l[P][Y]-T[P];H>0?J+=Math.exp(-(H/U)):J+=1}if(Math.abs(J-R)<M)break;J>R?(C=U,U=(L+C)/2):(L=U,C===Infinity?U*=2:U=(L+C)/2)}if(O[P]=U,T[P]>0){var X=v.mean($);O[P]<E*X&&(O[P]=E*X)}else{var x=v.mean(l.map(v.mean));O[P]<E*x&&(O[P]=E*x)}}return{sigmas:O,rhos:T}},s.prototype.computeMembershipStrengths=function(l,f,h,N){for(var S=l.length,R=l[0].length,T=v.zeros(S*R),O=v.zeros(S*R),P=v.zeros(S*R),L=0;L<S;L++)for(var C=0;C<R;C++){var U=0;l[L][C]!==-1&&(l[L][C]===L?U=0:f[L][C]-N[L]<=0?U=1:U=Math.exp(-((f[L][C]-N[L])/h[L])),T[L*R+C]=L,O[L*R+C]=l[L][C],P[L*R+C]=U)}return{rows:T,cols:O,vals:P}},s.prototype.initializeSimplicialSetEmbedding=function(){for(var l=this,f=this.getNEpochs(),h=this.nComponents,N=this.graph.getValues(),S=0,R=0;R<N.length;R++){var T=N[R];S<N[R]&&(S=T)}var O=this.graph.map(function(W){return W<S/f?0:W});this.embedding=v.zeros(O.nRows).map(function(){return v.zeros(h).map(function(){return v.tauRand(l.random)*20+-10})});for(var P=[],L=[],C=[],U=O.getAll(),R=0;R<U.length;R++){var $=U[R];$.value&&(P.push($.value),C.push($.row),L.push($.col))}var D=this.makeEpochsPerSample(P,f);return{head:L,tail:C,epochsPerSample:D}},s.prototype.makeEpochsPerSample=function(l,f){var h=v.filled(l.length,-1),N=v.max(l),S=l.map(function(R){return R/N*f});return S.forEach(function(R,T){R>0&&(h[T]=f/S[T])}),h},s.prototype.assignOptimizationStateParameters=function(l){Object.assign(this.optimizationState,l)},s.prototype.prepareForOptimizationLoop=function(){var l=this,f=l.repulsionStrength,h=l.learningRate,N=l.negativeSampleRate,S=this.optimizationState,R=S.epochsPerSample,T=S.headEmbedding,O=S.tailEmbedding,P=T[0].length,L=T.length===O.length,C=R.map(function(D){return D/N}),U=o(C),$=o(R);this.assignOptimizationStateParameters({epochOfNextSample:$,epochOfNextNegativeSample:U,epochsPerNegativeSample:C,moveOther:L,initialAlpha:h,alpha:h,gamma:f,dim:P})},s.prototype.initializeOptimization=function(){var l=this.embedding,f=this.embedding,h=this.optimizationState,N=h.head,S=h.tail,R=h.epochsPerSample,T=this.getNEpochs(),O=this.graph.nCols,P=m(this.spread,this.minDist),L=P.a,C=P.b;this.assignOptimizationStateParameters({headEmbedding:l,tailEmbedding:f,head:N,tail:S,epochsPerSample:R,a:L,b:C,nEpochs:T,nVertices:O})},s.prototype.optimizeLayoutStep=function(l){for(var f=this.optimizationState,h=f.head,N=f.tail,S=f.headEmbedding,R=f.tailEmbedding,T=f.epochsPerSample,O=f.epochOfNextSample,P=f.epochOfNextNegativeSample,L=f.epochsPerNegativeSample,C=f.moveOther,U=f.initialAlpha,$=f.alpha,D=f.gamma,W=f.a,G=f.b,Q=f.dim,J=f.nEpochs,Y=f.nVertices,H=4,X=0;X<T.length;X++)if(!(O[X]>l)){var x=h[X],nt=N[X],A=S[x],it=R[nt],ot=g(A,it),gt=0;ot>0&&(gt=-2*W*G*Math.pow(ot,G-1),gt/=W*Math.pow(ot,G)+1);for(var Z=0;Z<Q;Z++){var st=a(gt*(A[Z]-it[Z]),H);A[Z]+=st*$,C&&(it[Z]+=-st*$)}O[X]+=T[X];for(var wt=Math.floor((l-P[X])/L[X]),tt=0;tt<wt;tt++){var mt=v.tauRandInt(Y,this.random),bt=R[mt],Mt=g(A,bt),vt=0;if(Mt>0)vt=2*D*G,vt/=(.001+Mt)*(W*Math.pow(Mt,G)+1);else if(x===mt)continue;for(var Z=0;Z<Q;Z++){var st=4;vt>0&&(st=a(vt*(A[Z]-bt[Z]),H)),A[Z]+=st*$}}P[X]+=wt*L[X]}return f.alpha=U*(1-l/J),f.currentEpoch+=1,S},s.prototype.optimizeLayoutAsync=function(l){var f=this;return l===void 0&&(l=function(){return!0}),new Promise(function(h,N){var S=function(){return r(f,void 0,void 0,function(){var R,T,O,P,L,C;return t(this,function(U){try{if(R=this.optimizationState,T=R.nEpochs,O=R.currentEpoch,this.embedding=this.optimizeLayoutStep(O),P=this.optimizationState.currentEpoch,L=l(P)===!1,C=P===T,!L&&!C)setTimeout(function(){return S()},0);else return[2,h(C)]}catch($){N($)}return[2]})})};setTimeout(function(){return S()},0)})},s.prototype.optimizeLayout=function(l){l===void 0&&(l=function(){return!0});for(var f=!1,h=[];!f;){var N=this.optimizationState,S=N.nEpochs,R=N.currentEpoch;h=this.optimizeLayoutStep(R);var T=this.optimizationState.currentEpoch,O=l(T)===!1;f=T===S||O}return h},s.prototype.getNEpochs=function(){var l=this.graph;if(this.nEpochs>0)return this.nEpochs;var f=l.nRows;return f<=2500?500:f<=5e3?400:f<=7500?300:200},s}();e.UMAP=z;function _(s,l){for(var f=0,h=0;h<s.length;h++)f+=Math.pow(s[h]-l[h],2);return Math.sqrt(f)}e.euclidean=_;function b(s,l){for(var f=0,h=0,N=0,S=0;S<s.length;S++)f+=s[S]*l[S],h+=Math.pow(s[S],2),N+=Math.pow(l[S],2);return h===0&&N===0?0:h===0||N===0?1:1-f/Math.sqrt(h*N)}e.cosine=b;var d=function(){function s(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return s}();function a(s,l){return s>l?l:s<-l?-l:s}function g(s,l){for(var f=0,h=0;h<s.length;h++)f+=Math.pow(s[h]-l[h],2);return f}function m(s,l){var f=function(U){var $=n(U,2),D=$[0],W=$[1];return function(G){return 1/(1+D*Math.pow(G,2*W))}},h=v.linear(0,s*3,300).map(function(U){return U<l?1:U}),N=v.zeros(h.length).map(function(U,$){var D=h[$]>=l;return D?Math.exp(-(h[$]-l)/s):U}),S=[.5,.5],R={x:h,y:N},T={damping:1.5,initialValues:S,gradientDifference:.1,maxIterations:100,errorTolerance:.01},O=F.default(R,f,T).parameterValues,P=n(O,2),L=P[0],C=P[1];return{a:L,b:C}}e.findABParams=m;function w(s,l,f,h){return f===void 0&&(f=1),h===void 0&&(h=5),s.map(function(N,S,R){return l[S]===-1||l[R]===-1?N*Math.exp(-f):l[S]!==l[R]?N*Math.exp(-h):N})}e.fastIntersection=w;function j(s){s=y.normalize(s,"max");var l=y.transpose(s),f=y.pairwiseMultiply(l,s);return s=y.add(s,y.subtract(l,f)),y.eliminateZeros(s)}e.resetLocalConnectivity=j;function V(s,l,f){for(var h=v.zeros(s.length).map(function(O){return v.zeros(f[0].length)}),N=0;N<s.length;N++)for(var S=0;S<s[0].length;S++)for(var R=0;R<f[0].length;R++){var T=s[N][S];h[N][R]+=l[N][S]*f[T][R]}return h}e.initTransform=V}),je=lt(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.UMAP=be.UMAP}),ke=je.UMAP;export{ke as UMAP};
