function M(r){var t=null,e=function(){return t==null&&(t=r()),t};return e}function Z(r,t){return r.filter(function(e){return e!==t})}function ee(r,t){var e=new Set,n=function(o){return e.add(o)};r.forEach(n),t.forEach(n);var a=[];return e.forEach(function(i){return a.push(i)}),a}function te(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function A(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function re(r,t,e){return t&&A(r.prototype,t),e&&A(r,e),r}function H(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var ne=function(){function r(t){te(this,r),H(this,"entered",[]),H(this,"isNodeInDocument",void 0),this.isNodeInDocument=t}return re(r,[{key:"enter",value:function(e){var n=this,a=this.entered.length,i=function(l){return n.isNodeInDocument(l)&&(!l.contains||l.contains(e))};return this.entered=ee(this.entered.filter(i),[e]),a===0&&this.entered.length>0}},{key:"leave",value:function(e){var n=this.entered.length;return this.entered=Z(this.entered.filter(this.isNodeInDocument),e),n>0&&this.entered.length===0}},{key:"reset",value:function(){this.entered=[]}}]),r}(),ae=M(function(){return/firefox/i.test(navigator.userAgent)}),X=M(function(){return Boolean(window.safari)});function ie(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function R(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function oe(r,t,e){return t&&R(r.prototype,t),e&&R(r,e),r}function b(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var F=function(){function r(t,e){ie(this,r),b(this,"xs",void 0),b(this,"ys",void 0),b(this,"c1s",void 0),b(this,"c2s",void 0),b(this,"c3s",void 0);for(var n=t.length,a=[],i=0;i<n;i++)a.push(i);a.sort(function(I,Q){return t[I]<t[Q]?-1:1});for(var o=[],l=[],s,f,d=0;d<n-1;d++)s=t[d+1]-t[d],f=e[d+1]-e[d],o.push(s),l.push(f/s);for(var c=[l[0]],v=0;v<o.length-1;v++){var g=l[v],p=l[v+1];if(g*p<=0)c.push(0);else{s=o[v];var D=o[v+1],E=s+D;c.push(3*E/((E+D)/g+(E+s)/p))}}c.push(l[l.length-1]);for(var S=[],T=[],m,h=0;h<c.length-1;h++){m=l[h];var w=c[h],y=1/o[h],O=w+c[h+1]-m-m;S.push((m-w-O)*y),T.push(O*y*y)}this.xs=t,this.ys=e,this.c1s=c,this.c2s=S,this.c3s=T}return oe(r,[{key:"interpolate",value:function(e){var n=this.xs,a=this.ys,i=this.c1s,o=this.c2s,l=this.c3s,s=n.length-1;if(e===n[s])return a[s];for(var f=0,d=l.length-1,c;f<=d;){c=Math.floor(.5*(f+d));var v=n[c];if(v<e)f=c+1;else if(v>e)d=c-1;else return a[c]}s=Math.max(0,d);var g=e-n[s],p=g*g;return a[s]+i[s]*g+o[s]*p+l[s]*g*p}}]),r}(),se=1;function $(r){var t=r.nodeType===se?r:r.parentElement;if(!t)return null;var e=t.getBoundingClientRect(),n=e.top,a=e.left;return{x:a,y:n}}function C(r){return{x:r.clientX,y:r.clientY}}function ue(r){var t;return r.nodeName==="IMG"&&(ae()||!((t=document.documentElement)!==null&&t!==void 0&&t.contains(r)))}function le(r,t,e,n){var a=r?t.width:e,i=r?t.height:n;return X()&&r&&(i/=window.devicePixelRatio,a/=window.devicePixelRatio),{dragPreviewWidth:a,dragPreviewHeight:i}}function fe(r,t,e,n,a){var i=ue(t),o=i?r:t,l=$(o),s={x:e.x-l.x,y:e.y-l.y},f=r.offsetWidth,d=r.offsetHeight,c=n.anchorX,v=n.anchorY,g=le(i,t,f,d),p=g.dragPreviewWidth,D=g.dragPreviewHeight,E=function(){var O=new F([0,.5,1],[s.y,s.y/d*D,s.y+D-d]),I=O.interpolate(v);return X()&&i&&(I+=(window.devicePixelRatio-1)*D),I},S=function(){var O=new F([0,.5,1],[s.x,s.x/f*p,s.x+p-f]);return O.interpolate(c)},T=a.offsetX,m=a.offsetY,h=T===0||T,w=m===0||m;return{x:h?T:S(),y:w?m:E()}}var Y="__NATIVE_FILE__",z="__NATIVE_URL__",B="__NATIVE_TEXT__",j="__NATIVE_HTML__",U=Object.freeze({__proto__:null,FILE:Y,URL:z,TEXT:B,HTML:j});function P(r,t,e){var n=t.reduce(function(a,i){return a||r.getData(i)},"");return n!=null?n:e}var N;function L(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var _=(N={},L(N,Y,{exposeProperties:{files:function(t){return Array.prototype.slice.call(t.files)},items:function(t){return t.items}},matchesTypes:["Files"]}),L(N,j,{exposeProperties:{html:function(t,e){return P(t,e,"")}},matchesTypes:["Html","text/html"]}),L(N,z,{exposeProperties:{urls:function(t,e){return P(t,e,"").split(`
`)}},matchesTypes:["Url","text/uri-list"]}),L(N,B,{exposeProperties:{text:function(t,e){return P(t,e,"")}},matchesTypes:["Text","text/plain"]}),N);function de(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function W(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function ce(r,t,e){return t&&W(r.prototype,t),e&&W(r,e),r}function K(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var ve=function(){function r(t){de(this,r),K(this,"item",void 0),K(this,"config",void 0),this.config=t,this.item={},this.initializeExposedProperties()}return ce(r,[{key:"initializeExposedProperties",value:function(){var e=this;Object.keys(this.config.exposeProperties).forEach(function(n){Object.defineProperty(e.item,n,{configurable:!0,enumerable:!0,get:function(){return console.warn(`Browser doesn't allow reading "`.concat(n,'" until the drop event.')),null}})})}},{key:"loadDataTransfer",value:function(e){var n=this;if(e){var a={};Object.keys(this.config.exposeProperties).forEach(function(i){a[i]={value:n.config.exposeProperties[i](e,n.config.matchesTypes),configurable:!0,enumerable:!0}}),Object.defineProperties(this.item,a)}}},{key:"canDrag",value:function(){return!0}},{key:"beginDrag",value:function(){return this.item}},{key:"isDragging",value:function(e,n){return n===e.getSourceId()}},{key:"endDrag",value:function(){}}]),r}();function ge(r,t){var e=new ve(_[r]);return e.loadDataTransfer(t),e}function k(r){if(!r)return null;var t=Array.prototype.slice.call(r.types||[]);return Object.keys(_).filter(function(e){var n=_[e].matchesTypes;return n.some(function(a){return t.indexOf(a)>-1})})[0]||null}function he(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function V(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function pe(r,t,e){return t&&V(r.prototype,t),e&&V(r,e),r}function x(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var me=function(){function r(t,e){he(this,r),x(this,"ownerDocument",null),x(this,"globalContext",void 0),x(this,"optionsArgs",void 0),this.globalContext=t,this.optionsArgs=e}return pe(r,[{key:"window",get:function(){if(this.globalContext)return this.globalContext;if(typeof window!="undefined")return window}},{key:"document",get:function(){var e;return(e=this.globalContext)!==null&&e!==void 0&&e.document?this.globalContext.document:this.window?this.window.document:void 0}},{key:"rootElement",get:function(){var e;return((e=this.optionsArgs)===null||e===void 0?void 0:e.rootElement)||this.window}}]),r}();function q(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),e.push.apply(e,n)}return e}function G(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?q(Object(e),!0).forEach(function(n){u(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):q(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}function De(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function J(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Te(r,t,e){return t&&J(r.prototype,t),e&&J(r,e),r}function u(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var Ee=function(){function r(t,e,n){var a=this;De(this,r),u(this,"options",void 0),u(this,"actions",void 0),u(this,"monitor",void 0),u(this,"registry",void 0),u(this,"enterLeaveCounter",void 0),u(this,"sourcePreviewNodes",new Map),u(this,"sourcePreviewNodeOptions",new Map),u(this,"sourceNodes",new Map),u(this,"sourceNodeOptions",new Map),u(this,"dragStartSourceIds",null),u(this,"dropTargetIds",[]),u(this,"dragEnterTargetIds",[]),u(this,"currentNativeSource",null),u(this,"currentNativeHandle",null),u(this,"currentDragSourceNode",null),u(this,"altKeyPressed",!1),u(this,"mouseMoveTimeoutTimer",null),u(this,"asyncEndDragFrameId",null),u(this,"dragOverTargetIds",null),u(this,"getSourceClientOffset",function(i){var o=a.sourceNodes.get(i);return o&&$(o)||null}),u(this,"endDragNativeItem",function(){!a.isDraggingNativeItem()||(a.actions.endDrag(),a.currentNativeHandle&&a.registry.removeSource(a.currentNativeHandle),a.currentNativeHandle=null,a.currentNativeSource=null)}),u(this,"isNodeInDocument",function(i){return Boolean(i&&a.document&&a.document.body&&a.document.body.contains(i))}),u(this,"endDragIfSourceWasRemovedFromDOM",function(){var i=a.currentDragSourceNode;i==null||a.isNodeInDocument(i)||a.clearCurrentDragSourceNode()&&a.monitor.isDragging()&&a.actions.endDrag()}),u(this,"handleTopDragStartCapture",function(){a.clearCurrentDragSourceNode(),a.dragStartSourceIds=[]}),u(this,"handleTopDragStart",function(i){if(!i.defaultPrevented){var o=a.dragStartSourceIds;a.dragStartSourceIds=null;var l=C(i);a.monitor.isDragging()&&a.actions.endDrag(),a.actions.beginDrag(o||[],{publishSource:!1,getSourceClientOffset:a.getSourceClientOffset,clientOffset:l});var s=i.dataTransfer,f=k(s);if(a.monitor.isDragging()){if(s&&typeof s.setDragImage=="function"){var d=a.monitor.getSourceId(),c=a.sourceNodes.get(d),v=a.sourcePreviewNodes.get(d)||c;if(v){var g=a.getCurrentSourcePreviewNodeOptions(),p=g.anchorX,D=g.anchorY,E=g.offsetX,S=g.offsetY,T={anchorX:p,anchorY:D},m={offsetX:E,offsetY:S},h=fe(c,v,l,T,m);s.setDragImage(v,h.x,h.y)}}try{s==null||s.setData("application/json",{})}catch(O){}a.setCurrentDragSourceNode(i.target);var w=a.getCurrentSourcePreviewNodeOptions(),y=w.captureDraggingState;y?a.actions.publishDragSource():setTimeout(function(){return a.actions.publishDragSource()},0)}else if(f)a.beginDragNativeItem(f);else{if(s&&!s.types&&(i.target&&!i.target.hasAttribute||!i.target.hasAttribute("draggable")))return;i.preventDefault()}}}),u(this,"handleTopDragEndCapture",function(){a.clearCurrentDragSourceNode()&&a.monitor.isDragging()&&a.actions.endDrag()}),u(this,"handleTopDragEnterCapture",function(i){a.dragEnterTargetIds=[];var o=a.enterLeaveCounter.enter(i.target);if(!(!o||a.monitor.isDragging())){var l=i.dataTransfer,s=k(l);s&&a.beginDragNativeItem(s,l)}}),u(this,"handleTopDragEnter",function(i){var o=a.dragEnterTargetIds;if(a.dragEnterTargetIds=[],!!a.monitor.isDragging()){a.altKeyPressed=i.altKey,o.length>0&&a.actions.hover(o,{clientOffset:C(i)});var l=o.some(function(s){return a.monitor.canDropOnTarget(s)});l&&(i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect=a.getCurrentDropEffect()))}}),u(this,"handleTopDragOverCapture",function(){a.dragOverTargetIds=[]}),u(this,"handleTopDragOver",function(i){var o=a.dragOverTargetIds;if(a.dragOverTargetIds=[],!a.monitor.isDragging()){i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="none");return}a.altKeyPressed=i.altKey,a.actions.hover(o||[],{clientOffset:C(i)});var l=(o||[]).some(function(s){return a.monitor.canDropOnTarget(s)});l?(i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect=a.getCurrentDropEffect())):a.isDraggingNativeItem()?i.preventDefault():(i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="none"))}),u(this,"handleTopDragLeaveCapture",function(i){a.isDraggingNativeItem()&&i.preventDefault();var o=a.enterLeaveCounter.leave(i.target);!o||a.isDraggingNativeItem()&&setTimeout(function(){return a.endDragNativeItem()},0)}),u(this,"handleTopDropCapture",function(i){if(a.dropTargetIds=[],a.isDraggingNativeItem()){var o;i.preventDefault(),(o=a.currentNativeSource)===null||o===void 0||o.loadDataTransfer(i.dataTransfer)}else k(i.dataTransfer)&&i.preventDefault();a.enterLeaveCounter.reset()}),u(this,"handleTopDrop",function(i){var o=a.dropTargetIds;a.dropTargetIds=[],a.actions.hover(o,{clientOffset:C(i)}),a.actions.drop({dropEffect:a.getCurrentDropEffect()}),a.isDraggingNativeItem()?a.endDragNativeItem():a.monitor.isDragging()&&a.actions.endDrag()}),u(this,"handleSelectStart",function(i){var o=i.target;typeof o.dragDrop=="function"&&(o.tagName==="INPUT"||o.tagName==="SELECT"||o.tagName==="TEXTAREA"||o.isContentEditable||(i.preventDefault(),o.dragDrop()))}),this.options=new me(e,n),this.actions=t.getActions(),this.monitor=t.getMonitor(),this.registry=t.getRegistry(),this.enterLeaveCounter=new ne(this.isNodeInDocument)}return Te(r,[{key:"profile",value:function(){var e,n;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:((e=this.dragStartSourceIds)===null||e===void 0?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:((n=this.dragOverTargetIds)===null||n===void 0?void 0:n.length)||0}}},{key:"window",get:function(){return this.options.window}},{key:"document",get:function(){return this.options.document}},{key:"rootElement",get:function(){return this.options.rootElement}},{key:"setup",value:function(){var e=this.rootElement;if(e!==void 0){if(e.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}},{key:"teardown",value:function(){var e=this.rootElement;if(e!==void 0&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId)){var n;(n=this.window)===null||n===void 0||n.cancelAnimationFrame(this.asyncEndDragFrameId)}}},{key:"connectDragPreview",value:function(e,n,a){var i=this;return this.sourcePreviewNodeOptions.set(e,a),this.sourcePreviewNodes.set(e,n),function(){i.sourcePreviewNodes.delete(e),i.sourcePreviewNodeOptions.delete(e)}}},{key:"connectDragSource",value:function(e,n,a){var i=this;this.sourceNodes.set(e,n),this.sourceNodeOptions.set(e,a);var o=function(f){return i.handleDragStart(f,e)},l=function(f){return i.handleSelectStart(f)};return n.setAttribute("draggable","true"),n.addEventListener("dragstart",o),n.addEventListener("selectstart",l),function(){i.sourceNodes.delete(e),i.sourceNodeOptions.delete(e),n.removeEventListener("dragstart",o),n.removeEventListener("selectstart",l),n.setAttribute("draggable","false")}}},{key:"connectDropTarget",value:function(e,n){var a=this,i=function(f){return a.handleDragEnter(f,e)},o=function(f){return a.handleDragOver(f,e)},l=function(f){return a.handleDrop(f,e)};return n.addEventListener("dragenter",i),n.addEventListener("dragover",o),n.addEventListener("drop",l),function(){n.removeEventListener("dragenter",i),n.removeEventListener("dragover",o),n.removeEventListener("drop",l)}}},{key:"addEventListeners",value:function(e){!e.addEventListener||(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}},{key:"removeEventListeners",value:function(e){!e.removeEventListener||(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}},{key:"getCurrentSourceNodeOptions",value:function(){var e=this.monitor.getSourceId(),n=this.sourceNodeOptions.get(e);return G({dropEffect:this.altKeyPressed?"copy":"move"},n||{})}},{key:"getCurrentDropEffect",value:function(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}},{key:"getCurrentSourcePreviewNodeOptions",value:function(){var e=this.monitor.getSourceId(),n=this.sourcePreviewNodeOptions.get(e);return G({anchorX:.5,anchorY:.5,captureDraggingState:!1},n||{})}},{key:"isDraggingNativeItem",value:function(){var e=this.monitor.getItemType();return Object.keys(U).some(function(n){return U[n]===e})}},{key:"beginDragNativeItem",value:function(e,n){this.clearCurrentDragSourceNode(),this.currentNativeSource=ge(e,n),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}},{key:"setCurrentDragSourceNode",value:function(e){var n=this;this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;var a=1e3;this.mouseMoveTimeoutTimer=setTimeout(function(){var i;return(i=n.rootElement)===null||i===void 0?void 0:i.addEventListener("mousemove",n.endDragIfSourceWasRemovedFromDOM,!0)},a)}},{key:"clearCurrentDragSourceNode",value:function(){if(this.currentDragSourceNode){if(this.currentDragSourceNode=null,this.rootElement){var e;(e=this.window)===null||e===void 0||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)}return this.mouseMoveTimeoutTimer=null,!0}return!1}},{key:"handleDragStart",value:function(e,n){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(n))}},{key:"handleDragEnter",value:function(e,n){this.dragEnterTargetIds.unshift(n)}},{key:"handleDragOver",value:function(e,n){this.dragOverTargetIds===null&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(n)}},{key:"handleDrop",value:function(e,n){this.dropTargetIds.unshift(n)}}]),r}(),ye=function(t,e,n){return new Ee(t,e,n)};export{ye as HTML5Backend};
