import{p as nt}from"../../common/process-2545f00a.js";var je=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function On(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ne(e,t){return t={exports:{}},e(t,t.exports),t.exports}var he=1e3,de=he*60,ge=de*60,oe=ge*24,Sn=oe*7,Mn=oe*365.25,Pn=function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return $n(e);if(n==="number"&&isFinite(e))return t.long?Un(e):In(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function $n(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var n=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return n*Mn;case"weeks":case"week":case"w":return n*Sn;case"days":case"day":case"d":return n*oe;case"hours":case"hour":case"hrs":case"hr":case"h":return n*ge;case"minutes":case"minute":case"mins":case"min":case"m":return n*de;case"seconds":case"second":case"secs":case"sec":case"s":return n*he;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function In(e){var t=Math.abs(e);return t>=oe?Math.round(e/oe)+"d":t>=ge?Math.round(e/ge)+"h":t>=de?Math.round(e/de)+"m":t>=he?Math.round(e/he)+"s":e+"ms"}function Un(e){var t=Math.abs(e);return t>=oe?Le(e,t,oe,"day"):t>=ge?Le(e,t,ge,"hour"):t>=de?Le(e,t,de,"minute"):t>=he?Le(e,t,he,"second"):e+" ms"}function Le(e,t,n,i){var o=t>=n*1.5;return Math.round(e/n)+" "+i+(o?"s":"")}function jn(e){n.debug=n,n.default=n,n.coerce=u,n.disable=c,n.enable=o,n.enabled=h,n.humanize=Pn,n.destroy=d,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let g=0;for(let y=0;y<f.length;y++)g=(g<<5)-g+f.charCodeAt(y),g|=0;return n.colors[Math.abs(g)%n.colors.length]}n.selectColor=t;function n(f){let g,y=null;function v(...R){if(!v.enabled)return;const M=v,z=Number(new Date),me=z-(g||z);M.diff=me,M.prev=g,M.curr=z,g=z,R[0]=n.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let E=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,(V,le)=>{if(V==="%%")return"%";E++;const q=n.formatters[le];if(typeof q=="function"){const ee=R[E];V=q.call(M,ee),R.splice(E,1),E--}return V}),n.formatArgs.call(M,R),(M.log||n.log).apply(M,R)}return v.namespace=f,v.useColors=n.useColors(),v.color=n.selectColor(f),v.extend=i,v.destroy=n.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>y===null?n.enabled(f):y,set:R=>{y=R}}),typeof n.init=="function"&&n.init(v),v}function i(f,g){const y=n(this.namespace+(typeof g=="undefined"?":":g)+f);return y.log=this.log,y}function o(f){n.save(f),n.names=[],n.skips=[];let g;const y=(typeof f=="string"?f:"").split(/[\s,]+/),v=y.length;for(g=0;g<v;g++)!y[g]||(f=y[g].replace(/\*/g,".*?"),f[0]==="-"?n.skips.push(new RegExp("^"+f.substr(1)+"$")):n.names.push(new RegExp("^"+f+"$")))}function c(){const f=[...n.names.map(p),...n.skips.map(p).map(g=>"-"+g)].join(",");return n.enable(""),f}function h(f){if(f[f.length-1]==="*")return!0;let g,y;for(g=0,y=n.skips.length;g<y;g++)if(n.skips[g].test(f))return!1;for(g=0,y=n.names.length;g<y;g++)if(n.names[g].test(f))return!0;return!1}function p(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function u(f){return f instanceof Error?f.stack||f.message:f}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Nn=jn,N=Ne(function(e,t){t.formatArgs=i,t.save=o,t.load=c,t.useColors=n,t.storage=h(),t.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;u.splice(1,0,d,"color: inherit");let f=0,g=0;u[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(f++,y==="%c"&&(g=f))}),u.splice(g,0,d)}t.log=console.debug||console.log||(()=>{});function o(u){try{u?t.storage.setItem("debug",u):t.storage.removeItem("debug")}catch(d){}}function c(){let u;try{u=t.storage.getItem("debug")}catch(d){}return!u&&typeof nt!="undefined"&&"env"in nt&&(u=nt.env.DEBUG),u}function h(){try{return localStorage}catch(u){}}e.exports=Nn(t);const{formatters:p}=e.exports;p.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}),Ms=N.formatArgs,Ps=N.save,$s=N.load,Is=N.useColors,Us=N.storage,js=N.destroy,Ns=N.colors,Ls=N.log;let jt,De="default",st="";const it=()=>{jt=N(st?`fetch-mock:${De}:${st}`:`fetch-mock:${De}`)},Ln=e=>N(`fetch-mock:${De}:${e}`);it();var ae={debug:(...e)=>{jt(...e)},setDebugNamespace:e=>{st=e,it()},setDebugPhase:e=>{De=e||"default",it()},getDebug:e=>Ln(e)};const{debug:Dn,setDebugPhase:Nt}=ae,U={};U.mock=function(...e){return Nt("setup"),e.length&&this.addRoute(e),this._mock()},U.addRoute=function(e){Dn("Adding route",e);const t=this.compileRoute(e),n=this.routes.filter(({identifier:i,method:o})=>(typeof i=="function"?i===t.identifier:String(i)===String(t.identifier))&&(!o||!t.method||o===t.method));if(this.getOption("overwriteRoutes",t)===!1||!n.length)return this._uncompiledRoutes.push(e),this.routes.push(t);if(this.getOption("overwriteRoutes",t)===!0)return n.forEach(i=>{const o=this.routes.indexOf(i);this._uncompiledRoutes.splice(o,1,e),this.routes.splice(o,1,t)}),this.routes;if(n.length)throw new Error("fetch-mock: Adding route with same name or matcher as existing route. See `overwriteRoutes` option.");this._uncompiledRoutes.push(e),this.routes.push(t)},U._mock=function(){return this.isSandbox||(this.realFetch=this.realFetch||this.global.fetch,this.global.fetch=this.fetchHandler),Nt(),this},U.catch=function(e){return this.fallbackResponse&&console.warn("calling fetchMock.catch() twice - are you sure you want to overwrite the previous fallback response"),this.fallbackResponse=e||"ok",this._mock()},U.spy=function(e){return this._mock(),e?this.mock(e,this.getNativeFetch()):this.catch(this.getNativeFetch())};const Be=(e,t,n)=>{U[e]=function(i,o,c){return this[t](i,o,Object.assign(c||{},n))}},ze=(e,t)=>{U[e]=function(n,i){return this[t]({},n,i)}};Be("sticky","mock",{sticky:!0}),Be("once","mock",{repeat:1}),ze("any","mock"),ze("anyOnce","once"),["get","post","put","delete","head","patch"].forEach(e=>{Be(e,"mock",{method:e}),Be(`${e}Once`,"once",{method:e}),ze(`${e}Any`,e),ze(`${e}AnyOnce`,`${e}Once`)});const Bn=e=>{typeof e=="function"&&(console.warn("Deprecated: Passing fetch-mock reset methods\ndirectly in as handlers for before/after test runner hooks.\nWrap in an arrow function instead e.g. `() => fetchMock.restore()`"),e())},zn=({sticky:e})=>t=>e?[]:t.filter(({sticky:n})=>n);U.resetBehavior=function(e={}){Bn(e);const t=zn(e);return this.routes=t(this.routes),this._uncompiledRoutes=t(this._uncompiledRoutes),this.realFetch&&!this.routes.length&&(this.global.fetch=this.realFetch,this.realFetch=void 0),this.fallbackResponse=void 0,this},U.resetHistory=function(){return this._calls=[],this._holdingPromises=[],this.routes.forEach(e=>e.reset&&e.reset()),this},U.restore=U.reset=function(e){return this.resetBehavior(e),this.resetHistory(),this};var qn=U;const{getDebug:Gn}=ae,Lt=["body","headers","throws","status","redirectUrl"];class kn{constructor(t){this.debug=Gn("ResponseBuilder()"),this.debug("Response builder created with options",t),Object.assign(this,t)}exec(){this.debug("building response"),this.normalizeResponseConfig(),this.constructFetchOpts(),this.constructResponseBody();const t=new this.fetchMock.config.Response(this.body,this.options),n=this.buildObservableResponse(t);return[t,n]}sendAsObject(){return Lt.some(t=>this.responseConfig[t])?!Object.keys(this.responseConfig).every(t=>Lt.includes(t)):!0}normalizeResponseConfig(){typeof this.responseConfig=="number"?(this.debug("building response using status",this.responseConfig),this.responseConfig={status:this.responseConfig}):(typeof this.responseConfig=="string"||this.sendAsObject())&&(this.debug("building text response from",this.responseConfig),this.responseConfig={body:this.responseConfig})}validateStatus(t){if(!t)return this.debug("No status provided. Defaulting to 200"),200;if(typeof t=="number"&&parseInt(t,10)!==t&&t>=200||t<600)return this.debug("Valid status provided",t),t;throw new TypeError(`fetch-mock: Invalid status ${t} passed on response object.
To respond with a JSON object that has status as a property assign the object to body
e.g. {"body": {"status: "registered"}}`)}constructFetchOpts(){this.options=this.responseConfig.options||{},this.options.url=this.responseConfig.redirectUrl||this.url,this.options.status=this.validateStatus(this.responseConfig.status),this.options.statusText=this.fetchMock.statusTextMap[String(this.options.status)],this.options.headers=new this.fetchMock.config.Headers(this.responseConfig.headers||{})}getOption(t){return this.fetchMock.getOption(t,this.route)}convertToJson(){this.getOption("sendAsJson")&&this.responseConfig.body!=null&&typeof this.body=="object"&&(this.debug("Stringifying JSON response body"),this.body=JSON.stringify(this.body),this.options.headers.has("Content-Type")||this.options.headers.set("Content-Type","application/json"))}setContentLength(){this.getOption("includeContentLength")&&typeof this.body=="string"&&!this.options.headers.has("Content-Length")&&(this.debug("Setting content-length header:",this.body.length.toString()),this.options.headers.set("Content-Length",this.body.length.toString()))}constructResponseBody(){if(this.body=this.responseConfig.body,this.convertToJson(),this.setContentLength(),this.Stream){this.debug("Creating response stream");const t=new this.Stream.Readable;this.body!=null&&t.push(this.body,"utf-8"),t.push(null),this.body=t}this.body=this.body}buildObservableResponse(t){const n=this.fetchMock;return t._fmResults={},this.debug("Wrapping Response in ES proxy for observability"),new Proxy(t,{get:(i,o)=>{if(this.responseConfig.redirectUrl){if(o==="url")return this.debug("Retrieving redirect url",this.responseConfig.redirectUrl),this.responseConfig.redirectUrl;if(o==="redirected")return this.debug("Retrieving redirected status",!0),!0}return typeof i[o]=="function"?(this.debug("Wrapping body promises in ES proxies for observability"),new Proxy(i[o],{apply:(c,h,p)=>{this.debug(`Calling res.${o}`);const u=c.apply(t,p);return u.then&&(n._holdingPromises.push(u.catch(()=>null)),i._fmResults[o]=u),u}})):i[o]}})}}var Hn=e=>new kn(e).exec();let X;const ot=new RegExp("^[a-z]+://","i"),Wn=new RegExp("^//","i"),Dt=e=>typeof e.raw=="function"?Object.entries(e.raw()):e[Symbol.iterator]?[...e]:Object.entries(e),Bt=e=>e.reduce((t,[n,i])=>Object.assign(t,{[n]:i}),{}),at=e=>{if(typeof e=="function"||e instanceof RegExp||/^(begin|end|glob|express|path)\:/.test(e))return e;if(ot.test(e))return new X(e).href;if(Wn.test(e))return new X(e,"http://dummy").href;{const t=new X(e,"http://dummy");return t.pathname+t.search}},Jn=async e=>{try{return"body"in e?e.body.toString():e.clone().text()}catch(t){}};var qe={setUrlImplementation:e=>{X=e},normalizeRequest:(e,t,n)=>{if(n.prototype.isPrototypeOf(e)){const i={method:e.method},o=Jn(e);typeof o!="undefined"&&(i.body=o);const c={url:at(e.url),options:Object.assign(i,t),request:e,signal:t&&t.signal||e.signal},h=Dt(e.headers);return h.length&&(c.options.headers=Bt(h)),c}else{if(typeof e=="string"||typeof e=="object"&&"href"in e)return{url:at(e),options:t,signal:t&&t.signal};throw typeof e=="object"?new TypeError("fetch-mock: Unrecognised Request object. Read the Config and Installation sections of the docs"):new TypeError("fetch-mock: Invalid arguments passed to fetch")}},normalizeUrl:at,getPath:e=>(ot.test(e)?new X(e):new X(e,"http://dummy")).pathname,getQuery:e=>{const t=ot.test(e)?new X(e):new X(e,"http://dummy");return t.search?t.search.substr(1):""},headers:{normalize:e=>Bt(Dt(e)),toLowerCase:e=>Object.keys(e).reduce((t,n)=>(t[n.toLowerCase()]=e[n],t),{}),equal:(e,t)=>(e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],e.length!==t.length?!1:e.every((n,i)=>n===t[i]))}};const{debug:_e,setDebugPhase:zt,getDebug:Ge}=ae,L={};class Kn extends Error{constructor(){super(...arguments);this.name="AbortError",this.message="The operation was aborted.",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}const Xn=e=>typeof navigator=="undefined"||!navigator.vendor||navigator.vendor!=="Apple Computer, Inc."?e:async t=>{const{method:n}=t;if(!["POST","PUT","PATCH"].includes(n))return e(t);const i=await t.clone().text(),{cache:o,credentials:c,headers:h,integrity:p,mode:u,redirect:d,referrer:f}=t,g={body:i,cache:o,credentials:c,headers:h,integrity:p,mode:u,redirect:d,referrer:f,method:n};return e(t.url,g)},Zn=async({response:e,responseIsFetch:t=!1},n,i,o)=>{const c=Ge("resolve()");for(c("Recursively resolving function and promise responses");;)if(typeof e=="function"){if(c("  Response is a function"),t)return o?(c("  -> Calling fetch with Request instance"),e(o)):(c("  -> Calling fetch with url and options"),e(n,i));c("  -> Calling response function"),e=e(n,i,o)}else if(typeof e.then=="function")c("  Response is a promise"),c("  -> Resolving promise"),e=await e;else return c("  Response is not a function or a promise"),c("  -> Exiting response resolution recursion"),e};L.needsAsyncBodyExtraction=function({request:e}){return e&&this.routes.some(({usesBody:t})=>t)},L.fetchHandler=function(e,t){zt("handle");const n=Ge("fetchHandler()");n("fetch called with:",e,t);const i=qe.normalizeRequest(e,t,this.config.Request);return n("Request normalised"),n("  url",i.url),n("  options",i.options),n("  request",i.request),n("  signal",i.signal),this.needsAsyncBodyExtraction(i)?(n("Need to wait for Body to be streamed before calling router: switching to async mode"),this._extractBodyThenHandle(i)):this._fetchHandler(i)},L._extractBodyThenHandle=async function(e){return e.options.body=await e.options.body,this._fetchHandler(e)},L._fetchHandler=function({url:e,options:t,request:n,signal:i}){const{route:o,callLog:c}=this.executeRouter(e,t,n);this.recordCall(c);let h;return this._holdingPromises.push(new this.config.Promise(p=>h=p)),new this.config.Promise((p,u)=>{if(i){_e("signal exists - enabling fetch abort");const d=()=>{_e("aborting fetch"),u(typeof DOMException!="undefined"?new DOMException("The operation was aborted.","AbortError"):new Kn),h()};i.aborted&&(_e("signal is already aborted - aborting the fetch"),d()),i.addEventListener("abort",d)}this.generateResponse({route:o,url:e,options:t,request:n,callLog:c}).then(p,u).then(h,h).then(()=>{zt()})})},L.fetchHandler.isMock=!0,L.executeRouter=function(e,t,n){const i=Ge("executeRouter()"),o={url:e,options:t,request:n,isUnmatched:!0};if(i("Attempting to match request to a route"),this.getOption("fallbackToNetwork")==="always")return i("  Configured with fallbackToNetwork=always - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0}};const c=this.router(e,t,n);if(c)return i("  Matching route found"),{route:c,callLog:{url:e,options:t,request:n,identifier:c.identifier}};if(this.getOption("warnOnFallback")&&console.warn(`Unmatched ${t&&t.method||"GET"} to ${e}`),this.fallbackResponse)return i("  No matching route found - using fallbackResponse"),{route:{response:this.fallbackResponse},callLog:o};if(!this.getOption("fallbackToNetwork"))throw new Error(`fetch-mock: No fallback response defined for ${t&&t.method||"GET"} to ${e}`);return i("  Configured to fallbackToNetwork - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0},callLog:o}},L.generateResponse=async function({route:e,url:t,options:n,request:i,callLog:o={}}){const c=Ge("generateResponse()"),h=await Zn(e,t,n,i);if(h.throws&&typeof h!="function")throw c("response.throws is defined - throwing an error"),h.throws;if(this.config.Response.prototype.isPrototypeOf(h))return c("response is already a Response instance - returning it"),o.response=h,h;const[p,u]=Hn({url:t,responseConfig:h,fetchMock:this,route:e});return o.response=p,u},L.router=function(e,t,n){const i=this.routes.find((o,c)=>(_e(`Trying to match route ${c}`),o.matcher(e,t,n)));if(i)return i},L.getNativeFetch=function(){const e=this.realFetch||this.isSandbox&&this.config.fetch;if(!e)throw new Error("fetch-mock: Falling back to network only available on global fetch-mock, or by setting config.fetch on sandboxed fetch-mock");return Xn(e)},L.recordCall=function(e){_e("Recording fetch call",e),e&&this._calls.push(e)};var Qn=L,Yn=function(e,t){if(typeof e!="string")throw new TypeError("Expected a string");for(var n=String(e),i="",o=t?!!t.extended:!1,c=t?!!t.globstar:!1,h=!1,p=t&&typeof t.flags=="string"?t.flags:"",u,d=0,f=n.length;d<f;d++)switch(u=n[d],u){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":i+="\\"+u;break;case"?":if(o){i+=".";break}case"[":case"]":if(o){i+=u;break}case"{":if(o){h=!0,i+="(";break}case"}":if(o){h=!1,i+=")";break}case",":if(h){i+="|";break}i+="\\"+u;break;case"*":for(var g=n[d-1],y=1;n[d+1]==="*";)y++,d++;var v=n[d+1];if(!c)i+=".*";else{var R=y>1&&(g==="/"||g===void 0)&&(v==="/"||v===void 0);R?(i+="((?:[^/]*(?:/|$))*)",d++):i+="([^/]*)"}break;default:i+=u}return(!p||!~p.indexOf("g"))&&(i="^"+i+"$"),new RegExp(i,p)},pe=Jt,Vn=ct,es=ss,ts=kt,rs=Wt,qt="/",Gt="./",ns=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function ct(e,t){for(var n=[],i=0,o=0,c="",h=t&&t.delimiter||qt,p=t&&t.delimiters||Gt,u=!1,d;(d=ns.exec(e))!==null;){var f=d[0],g=d[1],y=d.index;if(c+=e.slice(o,y),o=y+f.length,g){c+=g[1],u=!0;continue}var v="",R=e[o],M=d[2],z=d[3],me=d[4],E=d[5];if(!u&&c.length){var Y=c.length-1;p.indexOf(c[Y])>-1&&(v=c[Y],c=c.slice(0,Y))}c&&(n.push(c),c="",u=!1);var V=v!==""&&R!==void 0&&R!==v,le=E==="+"||E==="*",q=E==="?"||E==="*",ee=v||h,Te=z||me;n.push({name:M||i++,prefix:v,delimiter:ee,optional:q,repeat:le,partial:V,pattern:Te?is(Te):"[^"+Z(ee)+"]+?"})}return(c||o<e.length)&&n.push(c+e.substr(o)),n}function ss(e,t){return kt(ct(e,t))}function kt(e){for(var t=new Array(e.length),n=0;n<e.length;n++)typeof e[n]=="object"&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(i,o){for(var c="",h=o&&o.encode||encodeURIComponent,p=0;p<e.length;p++){var u=e[p];if(typeof u=="string"){c+=u;continue}var d=i?i[u.name]:void 0,f;if(Array.isArray(d)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but got array');if(d.length===0){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var g=0;g<d.length;g++){if(f=h(d[g],u),!t[p].test(f))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'"');c+=(g===0?u.prefix:u.delimiter)+f}continue}if(typeof d=="string"||typeof d=="number"||typeof d=="boolean"){if(f=h(String(d),u),!t[p].test(f))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but got "'+f+'"');c+=u.prefix+f;continue}if(u.optional){u.partial&&(c+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be '+(u.repeat?"an array":"a string"))}return c}}function Z(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function is(e){return e.replace(/([=!:$/()])/g,"\\$1")}function Ht(e){return e&&e.sensitive?"":"i"}function os(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}function as(e,t,n){for(var i=[],o=0;o<e.length;o++)i.push(Jt(e[o],t,n).source);return new RegExp("(?:"+i.join("|")+")",Ht(n))}function cs(e,t,n){return Wt(ct(e,n),t,n)}function Wt(e,t,n){n=n||{};for(var i=n.strict,o=n.start!==!1,c=n.end!==!1,h=Z(n.delimiter||qt),p=n.delimiters||Gt,u=[].concat(n.endsWith||[]).map(Z).concat("$").join("|"),d=o?"^":"",f=e.length===0,g=0;g<e.length;g++){var y=e[g];if(typeof y=="string")d+=Z(y),f=g===e.length-1&&p.indexOf(y[y.length-1])>-1;else{var v=y.repeat?"(?:"+y.pattern+")(?:"+Z(y.delimiter)+"(?:"+y.pattern+"))*":y.pattern;t&&t.push(y),y.optional?y.partial?d+=Z(y.prefix)+"("+v+")?":d+="(?:"+Z(y.prefix)+"("+v+"))?":d+=Z(y.prefix)+"("+v+")"}}return c?(i||(d+="(?:"+h+")?"),d+=u==="$"?"$":"(?="+u+")"):(i||(d+="(?:"+h+"(?="+u+"))?"),f||(d+="(?="+h+"|"+u+")")),new RegExp(d,Ht(n))}function Jt(e,t,n){return e instanceof RegExp?os(e,t):Array.isArray(e)?as(e,t,n):cs(e,t,n)}pe.parse=Vn,pe.compile=es,pe.tokensToFunction=ts,pe.tokensToRegExp=rs;function us(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var ls=function(e,t,n,i){t=t||"&",n=n||"=";var o={};if(typeof e!="string"||e.length===0)return o;var c=/\+/g;e=e.split(t);var h=1e3;i&&typeof i.maxKeys=="number"&&(h=i.maxKeys);var p=e.length;h>0&&p>h&&(p=h);for(var u=0;u<p;++u){var d=e[u].replace(c,"%20"),f=d.indexOf(n),g,y,v,R;f>=0?(g=d.substr(0,f),y=d.substr(f+1)):(g=d,y=""),v=decodeURIComponent(g),R=decodeURIComponent(y),us(o,v)?Array.isArray(o[v])?o[v].push(R):o[v]=[o[v],R]:o[v]=R}return o},Re=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},fs=function(e,t,n,i){return t=t||"&",n=n||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(o){var c=encodeURIComponent(Re(o))+n;return Array.isArray(e[o])?e[o].map(function(h){return c+encodeURIComponent(Re(h))}).join(t):c+encodeURIComponent(Re(e[o]))}).join(t):i?encodeURIComponent(Re(i))+n+encodeURIComponent(Re(e)):""},ce=Ne(function(e,t){t.decode=t.parse=ls,t.encode=t.stringify=fs}),Ds=ce.decode,Bs=ce.parse,zs=ce.encode,qs=ce.stringify,Kt=Ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(i){function o(c,h){return i.apply(this,arguments)}return o.toString=function(){return i.toString()},o}(function(i,o){return typeof i!="object"||i===null||typeof o!="object"||o===null?!1:Object.keys(o).every(function(c){if(!i.propertyIsEnumerable(c))return!1;var h=o[c],p=i[c];return!(typeof h=="object"&&h!==null?!n(p,h):p!==h)})});t.default=n,e.exports=t.default});On(Kt);var Xt=Ne(function(e,t){var n=200,i="__lodash_hash_undefined__",o=1,c=2,h=9007199254740991,p="[object Arguments]",u="[object Array]",d="[object AsyncFunction]",f="[object Boolean]",g="[object Date]",y="[object Error]",v="[object Function]",R="[object GeneratorFunction]",M="[object Map]",z="[object Number]",me="[object Null]",E="[object Object]",Y="[object Promise]",V="[object Proxy]",le="[object RegExp]",q="[object Set]",ee="[object String]",Te="[object Symbol]",sr="[object Undefined]",Ke="[object WeakMap]",ft="[object ArrayBuffer]",Fe="[object DataView]",ir="[object Float32Array]",or="[object Float64Array]",ar="[object Int8Array]",cr="[object Int16Array]",ur="[object Int32Array]",lr="[object Uint8Array]",fr="[object Uint8ClampedArray]",hr="[object Uint16Array]",dr="[object Uint32Array]",gr=/[\\^$.*+?()[\]{}|]/g,pr=/^\[object .+?Constructor\]$/,yr=/^(?:0|[1-9]\d*)$/,C={};C[ir]=C[or]=C[ar]=C[cr]=C[ur]=C[lr]=C[fr]=C[hr]=C[dr]=!0,C[p]=C[u]=C[ft]=C[f]=C[Fe]=C[g]=C[y]=C[v]=C[M]=C[z]=C[E]=C[le]=C[q]=C[ee]=C[Ke]=!1;var ht=typeof je=="object"&&je&&je.Object===Object&&je,mr=typeof self=="object"&&self&&self.Object===Object&&self,G=ht||mr||Function("return this")(),dt=t&&!t.nodeType&&t,gt=dt&&!0&&e&&!e.nodeType&&e,pt=gt&&gt.exports===dt,Xe=pt&&ht.process,yt=function(){try{return Xe&&Xe.binding&&Xe.binding("util")}catch(r){}}(),mt=yt&&yt.isTypedArray;function br(r,s){for(var a=-1,l=r==null?0:r.length,_=0,b=[];++a<l;){var A=r[a];s(A,a,r)&&(b[_++]=A)}return b}function vr(r,s){for(var a=-1,l=s.length,_=r.length;++a<l;)r[_+a]=s[a];return r}function wr(r,s){for(var a=-1,l=r==null?0:r.length;++a<l;)if(s(r[a],a,r))return!0;return!1}function Cr(r,s){for(var a=-1,l=Array(r);++a<r;)l[a]=s(a);return l}function _r(r){return function(s){return r(s)}}function Rr(r,s){return r.has(s)}function xr(r,s){return r==null?void 0:r[s]}function Ar(r){var s=-1,a=Array(r.size);return r.forEach(function(l,_){a[++s]=[_,l]}),a}function Tr(r,s){return function(a){return r(s(a))}}function Fr(r){var s=-1,a=Array(r.size);return r.forEach(function(l){a[++s]=l}),a}var Er=Array.prototype,Or=Function.prototype,Ee=Object.prototype,Ze=G["__core-js_shared__"],bt=Or.toString,D=Ee.hasOwnProperty,vt=function(){var r=/[^.]+$/.exec(Ze&&Ze.keys&&Ze.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),wt=Ee.toString,Sr=RegExp("^"+bt.call(D).replace(gr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ct=pt?G.Buffer:void 0,Oe=G.Symbol,_t=G.Uint8Array,Rt=Ee.propertyIsEnumerable,Mr=Er.splice,te=Oe?Oe.toStringTag:void 0,xt=Object.getOwnPropertySymbols,Pr=Ct?Ct.isBuffer:void 0,$r=Tr(Object.keys,Object),Qe=fe(G,"DataView"),be=fe(G,"Map"),Ye=fe(G,"Promise"),Ve=fe(G,"Set"),et=fe(G,"WeakMap"),ve=fe(Object,"create"),Ir=se(Qe),Ur=se(be),jr=se(Ye),Nr=se(Ve),Lr=se(et),At=Oe?Oe.prototype:void 0,tt=At?At.valueOf:void 0;function re(r){var s=-1,a=r==null?0:r.length;for(this.clear();++s<a;){var l=r[s];this.set(l[0],l[1])}}function Dr(){this.__data__=ve?ve(null):{},this.size=0}function Br(r){var s=this.has(r)&&delete this.__data__[r];return this.size-=s?1:0,s}function zr(r){var s=this.__data__;if(ve){var a=s[r];return a===i?void 0:a}return D.call(s,r)?s[r]:void 0}function qr(r){var s=this.__data__;return ve?s[r]!==void 0:D.call(s,r)}function Gr(r,s){var a=this.__data__;return this.size+=this.has(r)?0:1,a[r]=ve&&s===void 0?i:s,this}re.prototype.clear=Dr,re.prototype.delete=Br,re.prototype.get=zr,re.prototype.has=qr,re.prototype.set=Gr;function k(r){var s=-1,a=r==null?0:r.length;for(this.clear();++s<a;){var l=r[s];this.set(l[0],l[1])}}function kr(){this.__data__=[],this.size=0}function Hr(r){var s=this.__data__,a=Me(s,r);if(a<0)return!1;var l=s.length-1;return a==l?s.pop():Mr.call(s,a,1),--this.size,!0}function Wr(r){var s=this.__data__,a=Me(s,r);return a<0?void 0:s[a][1]}function Jr(r){return Me(this.__data__,r)>-1}function Kr(r,s){var a=this.__data__,l=Me(a,r);return l<0?(++this.size,a.push([r,s])):a[l][1]=s,this}k.prototype.clear=kr,k.prototype.delete=Hr,k.prototype.get=Wr,k.prototype.has=Jr,k.prototype.set=Kr;function ne(r){var s=-1,a=r==null?0:r.length;for(this.clear();++s<a;){var l=r[s];this.set(l[0],l[1])}}function Xr(){this.size=0,this.__data__={hash:new re,map:new(be||k),string:new re}}function Zr(r){var s=Pe(this,r).delete(r);return this.size-=s?1:0,s}function Qr(r){return Pe(this,r).get(r)}function Yr(r){return Pe(this,r).has(r)}function Vr(r,s){var a=Pe(this,r),l=a.size;return a.set(r,s),this.size+=a.size==l?0:1,this}ne.prototype.clear=Xr,ne.prototype.delete=Zr,ne.prototype.get=Qr,ne.prototype.has=Yr,ne.prototype.set=Vr;function Se(r){var s=-1,a=r==null?0:r.length;for(this.__data__=new ne;++s<a;)this.add(r[s])}function en(r){return this.__data__.set(r,i),this}function tn(r){return this.__data__.has(r)}Se.prototype.add=Se.prototype.push=en,Se.prototype.has=tn;function W(r){var s=this.__data__=new k(r);this.size=s.size}function rn(){this.__data__=new k,this.size=0}function nn(r){var s=this.__data__,a=s.delete(r);return this.size=s.size,a}function sn(r){return this.__data__.get(r)}function on(r){return this.__data__.has(r)}function an(r,s){var a=this.__data__;if(a instanceof k){var l=a.__data__;if(!be||l.length<n-1)return l.push([r,s]),this.size=++a.size,this;a=this.__data__=new ne(l)}return a.set(r,s),this.size=a.size,this}W.prototype.clear=rn,W.prototype.delete=nn,W.prototype.get=sn,W.prototype.has=on,W.prototype.set=an;function cn(r,s){var a=$e(r),l=!a&&Rn(r),_=!a&&!l&&rt(r),b=!a&&!l&&!_&&It(r),A=a||l||_||b,T=A?Cr(r.length,String):[],F=T.length;for(var x in r)(s||D.call(r,x))&&!(A&&(x=="length"||_&&(x=="offset"||x=="parent")||b&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||bn(x,F)))&&T.push(x);return T}function Me(r,s){for(var a=r.length;a--;)if(St(r[a][0],s))return a;return-1}function un(r,s,a){var l=s(r);return $e(r)?l:vr(l,a(r))}function we(r){return r==null?r===void 0?sr:me:te&&te in Object(r)?yn(r):_n(r)}function Tt(r){return Ce(r)&&we(r)==p}function Ft(r,s,a,l,_){return r===s?!0:r==null||s==null||!Ce(r)&&!Ce(s)?r!==r&&s!==s:ln(r,s,a,l,Ft,_)}function ln(r,s,a,l,_,b){var A=$e(r),T=$e(s),F=A?u:J(r),x=T?u:J(s);F=F==p?E:F,x=x==p?E:x;var P=F==E,j=x==E,O=F==x;if(O&&rt(r)){if(!rt(s))return!1;A=!0,P=!1}if(O&&!P)return b||(b=new W),A||It(r)?Et(r,s,a,l,_,b):gn(r,s,F,a,l,_,b);if(!(a&o)){var $=P&&D.call(r,"__wrapped__"),I=j&&D.call(s,"__wrapped__");if($||I){var K=$?r.value():r,H=I?s.value():s;return b||(b=new W),_(K,H,a,l,b)}}return O?(b||(b=new W),pn(r,s,a,l,_,b)):!1}function fn(r){if(!$t(r)||wn(r))return!1;var s=Mt(r)?Sr:pr;return s.test(se(r))}function hn(r){return Ce(r)&&Pt(r.length)&&!!C[we(r)]}function dn(r){if(!Cn(r))return $r(r);var s=[];for(var a in Object(r))D.call(r,a)&&a!="constructor"&&s.push(a);return s}function Et(r,s,a,l,_,b){var A=a&o,T=r.length,F=s.length;if(T!=F&&!(A&&F>T))return!1;var x=b.get(r);if(x&&b.get(s))return x==s;var P=-1,j=!0,O=a&c?new Se:void 0;for(b.set(r,s),b.set(s,r);++P<T;){var $=r[P],I=s[P];if(l)var K=A?l(I,$,P,s,r,b):l($,I,P,r,s,b);if(K!==void 0){if(K)continue;j=!1;break}if(O){if(!wr(s,function(H,ie){if(!Rr(O,ie)&&($===H||_($,H,a,l,b)))return O.push(ie)})){j=!1;break}}else if(!($===I||_($,I,a,l,b))){j=!1;break}}return b.delete(r),b.delete(s),j}function gn(r,s,a,l,_,b,A){switch(a){case Fe:if(r.byteLength!=s.byteLength||r.byteOffset!=s.byteOffset)return!1;r=r.buffer,s=s.buffer;case ft:return!(r.byteLength!=s.byteLength||!b(new _t(r),new _t(s)));case f:case g:case z:return St(+r,+s);case y:return r.name==s.name&&r.message==s.message;case le:case ee:return r==s+"";case M:var T=Ar;case q:var F=l&o;if(T||(T=Fr),r.size!=s.size&&!F)return!1;var x=A.get(r);if(x)return x==s;l|=c,A.set(r,s);var P=Et(T(r),T(s),l,_,b,A);return A.delete(r),P;case Te:if(tt)return tt.call(r)==tt.call(s)}return!1}function pn(r,s,a,l,_,b){var A=a&o,T=Ot(r),F=T.length,x=Ot(s),P=x.length;if(F!=P&&!A)return!1;for(var j=F;j--;){var O=T[j];if(!(A?O in s:D.call(s,O)))return!1}var $=b.get(r);if($&&b.get(s))return $==s;var I=!0;b.set(r,s),b.set(s,r);for(var K=A;++j<F;){O=T[j];var H=r[O],ie=s[O];if(l)var Ut=A?l(ie,H,O,s,r,b):l(H,ie,O,r,s,b);if(!(Ut===void 0?H===ie||_(H,ie,a,l,b):Ut)){I=!1;break}K||(K=O=="constructor")}if(I&&!K){var Ie=r.constructor,Ue=s.constructor;Ie!=Ue&&"constructor"in r&&"constructor"in s&&!(typeof Ie=="function"&&Ie instanceof Ie&&typeof Ue=="function"&&Ue instanceof Ue)&&(I=!1)}return b.delete(r),b.delete(s),I}function Ot(r){return un(r,Tn,mn)}function Pe(r,s){var a=r.__data__;return vn(s)?a[typeof s=="string"?"string":"hash"]:a.map}function fe(r,s){var a=xr(r,s);return fn(a)?a:void 0}function yn(r){var s=D.call(r,te),a=r[te];try{r[te]=void 0;var l=!0}catch(b){}var _=wt.call(r);return l&&(s?r[te]=a:delete r[te]),_}var mn=xt?function(r){return r==null?[]:(r=Object(r),br(xt(r),function(s){return Rt.call(r,s)}))}:Fn,J=we;(Qe&&J(new Qe(new ArrayBuffer(1)))!=Fe||be&&J(new be)!=M||Ye&&J(Ye.resolve())!=Y||Ve&&J(new Ve)!=q||et&&J(new et)!=Ke)&&(J=function(r){var s=we(r),a=s==E?r.constructor:void 0,l=a?se(a):"";if(l)switch(l){case Ir:return Fe;case Ur:return M;case jr:return Y;case Nr:return q;case Lr:return Ke}return s});function bn(r,s){return s=s==null?h:s,!!s&&(typeof r=="number"||yr.test(r))&&r>-1&&r%1==0&&r<s}function vn(r){var s=typeof r;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?r!=="__proto__":r===null}function wn(r){return!!vt&&vt in r}function Cn(r){var s=r&&r.constructor,a=typeof s=="function"&&s.prototype||Ee;return r===a}function _n(r){return wt.call(r)}function se(r){if(r!=null){try{return bt.call(r)}catch(s){}try{return r+""}catch(s){}}return""}function St(r,s){return r===s||r!==r&&s!==s}var Rn=Tt(function(){return arguments}())?Tt:function(r){return Ce(r)&&D.call(r,"callee")&&!Rt.call(r,"callee")},$e=Array.isArray;function xn(r){return r!=null&&Pt(r.length)&&!Mt(r)}var rt=Pr||En;function An(r,s){return Ft(r,s)}function Mt(r){if(!$t(r))return!1;var s=we(r);return s==v||s==R||s==d||s==V}function Pt(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=h}function $t(r){var s=typeof r;return r!=null&&(s=="object"||s=="function")}function Ce(r){return r!=null&&typeof r=="object"}var It=mt?_r(mt):hn;function Tn(r){return xn(r)?cn(r):dn(r)}function Fn(){return[]}function En(){return!1}e.exports=An});const{debug:m}=ae,{headers:ke,getPath:ut,getQuery:hs,normalizeUrl:Zt}=qe,xe=e=>t=>(m("Actual url:",t),e(t)),Qt={begin:e=>xe(t=>t.indexOf(e)===0),end:e=>xe(t=>t.substr(-e.length)===e),glob:e=>{const t=Yn(e);return xe(n=>t.test(n))},express:e=>{const t=pe(e);return xe(n=>t.test(ut(n)))},path:e=>xe(t=>ut(t)===e)},ds=({headers:e})=>{if(m("Generating header matcher"),!e){m("  No header expectations defined - skipping");return}const t=ke.toLowerCase(e);return m("  Expected headers:",t),(n,{headers:i={}})=>{m("Attempting to match headers");const o=ke.toLowerCase(ke.normalize(i));return m("  Expected headers:",t),m("  Actual headers:",o),Object.keys(t).every(c=>ke.equal(o[c],t[c]))}},gs=({method:e})=>{if(m("Generating method matcher"),!e){m("  No method expectations defined - skipping");return}return m("  Expected method:",e),(t,{method:n})=>{m("Attempting to match method");const i=n?n.toLowerCase():"get";return m("  Expected method:",e),m("  Actual method:",i),e===i}},ps=({query:e})=>{if(m("Generating query parameters matcher"),!e){m("  No query parameters expectations defined - skipping");return}const t=ce.parse(ce.stringify(e));m("  Expected query parameters:",e);const n=Object.keys(t);return i=>{m("Attempting to match query parameters");const o=ce.parse(hs(i));return m("  Expected query parameters:",t),m("  Actual query parameters:",o),n.every(c=>Array.isArray(o[c])?Array.isArray(t[c])?Xt(o[c].sort(),t[c].sort()):!1:o[c]===t[c])}},ys=({params:e,url:t})=>{if(m("Generating path parameters matcher"),!e){m("  No path parameters expectations defined - skipping");return}if(!/express:/.test(t))throw new Error("fetch-mock: matching on params is only possible when using an express: matcher");m("  Expected path parameters:",e);const n=Object.keys(e),i=[],o=pe(t.replace(/^express:/,""),i);return c=>{m("Attempting to match path parameters");const h=o.exec(ut(c))||[];h.shift();const p=i.reduce((u,{name:d},f)=>h[f]?Object.assign(u,{[d]:h[f]}):u,{});return m("  Expected path parameters:",e),m("  Actual path parameters:",p),n.every(u=>p[u]===e[u])}},ms=(e,t)=>{const n=t.getOption("matchPartialBody",e),{body:i}=e;return m("Generating body matcher"),(o,{body:c,method:h="get"})=>{if(m("Attempting to match body"),h.toLowerCase()==="get")return m("  GET request - skip matching body"),!0;let p;try{m("  Parsing request body as JSON"),p=JSON.parse(c)}catch(u){m("  Failed to parse request body as JSON",u)}return m("Expected body:",i),m("Actual body:",p),n&&m("matchPartialBody is true - checking for partial match only"),p&&(n?Kt(p,i):Xt(p,i))}},Yt=(e,t,n)=>{m("  Matching using full url",t);const i=Zt(t);return m("  Normalised url to:",t),e.identifier===t&&(m("  Updating route identifier to match normalized url:",t),e.identifier=i),o=>(m("Expected url:",i),m("Actual url:",o),n&&i.indexOf("?")?(m("Ignoring query string when matching url"),o.indexOf(i)===0):Zt(o)===i)},bs=({functionMatcher:e})=>(m("Detected user defined function matcher",e),(...t)=>(m("Calling function matcher with arguments",t),e(...t))),vs=e=>{m("Generating url matcher");const{url:t,query:n}=e;if(t==="*")return m("  Using universal * rule to match any url"),()=>!0;if(t instanceof RegExp)return m("  Using regular expression to match url:",t),i=>t.test(i);if(t.href)return m("  Using URL object to match url",t),Yt(e,t.href,n);for(const i in Qt)if(t.indexOf(i+":")===0){m(`  Using ${i}: pattern to match url`,t);const o=t.replace(new RegExp(`^${i}:`),"");return Qt[i](o)}return Yt(e,t,n)};var ws=[{name:"query",matcher:ps},{name:"method",matcher:gs},{name:"headers",matcher:ds},{name:"params",matcher:ys},{name:"body",matcher:ms,usesBody:!0},{name:"functionMatcher",matcher:bs},{name:"url",matcher:vs}];const{debug:Vt,setDebugNamespace:er,getDebug:He}=ae,tr=e=>e instanceof RegExp||typeof e=="string"||typeof e=="object"&&"href"in e,Cs=e=>typeof e=="function";class ue{constructor(t,n){this.fetchMock=n,He("compileRoute()")("Compiling route"),this.init(t),this.sanitize(),this.validate(),this.generateMatcher(),this.limit(),this.delayResponse()}validate(){if(!("response"in this))throw new Error("fetch-mock: Each route must define a response");if(!ue.registeredMatchers.some(({name:t})=>t in this))throw new Error("fetch-mock: Each route must specify some criteria for matching calls to fetch. To match all calls use '*'")}init(t){const[n,i,o={}]=t,c={};tr(n)||Cs(n)?c.matcher=n:Object.assign(c,n),typeof i!="undefined"&&(c.response=i),Object.assign(c,o),Object.assign(this,c)}sanitize(){const t=He("sanitize()");t("Sanitizing route properties"),this.method&&(t(`Converting method ${this.method} to lower case`),this.method=this.method.toLowerCase()),tr(this.matcher)&&(t("Mock uses a url matcher",this.matcher),this.url=this.matcher,delete this.matcher),this.functionMatcher=this.matcher||this.functionMatcher,t("Setting route.identifier..."),t(`  route.name is ${this.name}`),t(`  route.url is ${this.url}`),t(`  route.functionMatcher is ${this.functionMatcher}`),this.identifier=this.name||this.url||this.functionMatcher,t(`  -> route.identifier set to ${this.identifier}`)}generateMatcher(){er("generateMatcher()"),Vt("Compiling matcher for route");const t=ue.registeredMatchers.map(({name:n,matcher:i,usesBody:o})=>this[n]&&{matcher:i(this,this.fetchMock),usesBody:o}).filter(n=>Boolean(n));this.usesBody=t.some(({usesBody:n})=>n),Vt("Compiled matcher for route"),er(),this.matcher=(n,i={},o)=>t.every(({matcher:c})=>c(n,i,o))}limit(){const t=He("limit()");if(t("Limiting number of requests to handle by route"),!this.repeat){t("  No `repeat` value set on route. Will match any number of requests");return}t(`  Route set to repeat ${this.repeat} times`);const n=this.matcher;let i=this.repeat;this.matcher=(o,c)=>{if(i&&n(o,c))return i--,!0},this.reset=()=>i=this.repeat}delayResponse(){const t=He("delayResponse()");if(t("Applying response delay settings"),this.delay){t(`  Wrapping response in delay of ${this.delay} miliseconds`);const n=this.response;this.response=()=>(t(`Delaying response by ${this.delay} miliseconds`),new Promise(i=>setTimeout(()=>i(n),this.delay)))}else t("  No delay set on route. Will respond 'immediately' (but asynchronously)")}static addMatcher(t){ue.registeredMatchers.push(t)}}ue.registeredMatchers=[],ws.forEach(ue.addMatcher);var lt=ue;const{setDebugPhase:We,setDebugNamespace:Je,debug:w}=ae,{normalizeUrl:rr}=qe,B={},_s=e=>typeof e=="string"&&/^[\da-zA-Z\-]+$/.test(e),Rs=function(e,t={},n){return{matcher:e}=new lt([Object.assign({matcher:e,response:"ok"},t)],this),n.filter(({url:i,options:o})=>e(rr(i),o))},Q=e=>function(...t){We("inspect");const n=e.call(this,...t);return We(),n},xs=e=>{if(!e)return;const{url:t,options:n,request:i,identifier:o,isUnmatched:c,response:h}=e,p=[t,n];return p.request=i,p.identifier=o,p.isUnmatched=c,p.response=h,p};B.filterCalls=function(e,t){w("Filtering fetch calls");let n=this._calls,i="*";return[!0,"matched"].includes(e)?(w(`Filter provided is ${e}. Returning matched calls only`),n=n.filter(({isUnmatched:o})=>!o)):[!1,"unmatched"].includes(e)?(w(`Filter provided is ${e}. Returning unmatched calls only`),n=n.filter(({isUnmatched:o})=>o)):typeof e=="undefined"?(w("Filter provided is undefined. Returning all calls"),n=n):_s(e)?(w("Filter provided, looks like the name of a named route. Returning only calls handled by that route"),n=n.filter(({identifier:o})=>o===e)):(i=e==="*"?"*":rr(e),this.routes.some(({identifier:o})=>o===i)&&(w(`Filter provided, ${e}, identifies a route. Returning only calls handled by that route`),n=n.filter(o=>o.identifier===i))),(t||i!=="*")&&n.length&&(typeof t=="string"&&(t={method:t}),w("Compiling filter and options to route in order to filter all calls",e),n=Rs.call(this,i,t,n)),w(`Retrieved ${n.length} calls`),n.map(xs)},B.calls=Q(function(e,t){return w("retrieving matching calls"),this.filterCalls(e,t)}),B.lastCall=Q(function(e,t){return w("retrieving last matching call"),[...this.filterCalls(e,t)].pop()}),B.lastUrl=Q(function(e,t){return w("retrieving url of last matching call"),(this.lastCall(e,t)||[])[0]}),B.lastOptions=Q(function(e,t){return w("retrieving options of last matching call"),(this.lastCall(e,t)||[])[1]}),B.lastResponse=Q(function(e,t){w("retrieving respose of last matching call"),console.warn(`When doing all the following:
- using node-fetch
- responding with a real network response (using spy() or fallbackToNetwork)
- using \`fetchMock.LastResponse()\`
- awaiting the body content
... the response will hang unless your source code also awaits the response body.
This is an unavoidable consequence of the nodejs implementation of streams.
`);const n=(this.lastCall(e,t)||[]).response;try{return n.clone()}catch(i){return Object.entries(n._fmResults).forEach(([o,c])=>{n[o]=()=>c}),n}}),B.called=Q(function(e,t){return w("checking if matching call was made"),Boolean(this.filterCalls(e,t).length)}),B.flush=Q(async function(e){Je("flush"),w(`flushing all fetch calls. ${e?"":"Not "}waiting for response bodies to complete download`);const t=this._holdingPromises;this._holdingPromises=[],w(`${t.length} fetch calls to be awaited`),await Promise.all(t),w("All fetch calls have completed"),e&&this._holdingPromises.length&&(w("Awaiting all fetch bodies to download"),await this.flush(e),w("All fetch bodies have completed downloading")),Je()}),B.done=Q(function(e){We("inspect"),Je("done"),w("Checking to see if expected calls have been made");let t;e&&typeof e!="boolean"?(w("Checking to see if expected calls have been made for single route:",e),t=[{identifier:e}]):(w("Checking to see if expected calls have been made for all routes"),t=this.routes);const n=t.map(({identifier:i})=>{if(!this.called(i))return w("No calls made for route:",i),console.warn(`Warning: ${i} not called`),!1;const o=(this.routes.find(h=>h.identifier===i)||{}).repeat;if(!o)return w("Route has been called at least once, and no expectation of more set:",i),!0;const c=this.filterCalls(i).length;return w(`Route called ${c} times:`,i),o>c?(w(`Route called ${c} times, but expected ${o}:`,i),console.warn(`Warning: ${i} only called ${c} times, but ${o} expected`),!1):!0}).every(i=>i);return Je(),We(),n});var As=B;const{debug:nr}=ae,S=Object.assign({},Qn,qn,As);S.addMatcher=function(e){lt.addMatcher(e)},S.config={fallbackToNetwork:!1,includeContentLength:!0,sendAsJson:!0,warnOnFallback:!0,overwriteRoutes:void 0},S.createInstance=function(){nr("Creating fetch-mock instance");const e=Object.create(S);return e._uncompiledRoutes=(this._uncompiledRoutes||[]).slice(),e.routes=e._uncompiledRoutes.map(t=>this.compileRoute(t)),e.fallbackResponse=this.fallbackResponse||void 0,e.config=Object.assign({},this.config||S.config),e._calls=[],e._holdingPromises=[],e.bindMethods(),e},S.compileRoute=function(e){return new lt(e,this)},S.bindMethods=function(){this.fetchHandler=S.fetchHandler.bind(this),this.reset=this.restore=S.reset.bind(this),this.resetHistory=S.resetHistory.bind(this),this.resetBehavior=S.resetBehavior.bind(this)},S.sandbox=function(){nr("Creating sandboxed fetch-mock instance");const t=Object.assign((n,i)=>t.fetchHandler(n,i),S,this.createInstance(),{Headers:this.config.Headers,Request:this.config.Request,Response:this.config.Response});return t.bindMethods(),t.isSandbox=!0,t.default=t,t},S.getOption=function(e,t={}){return e in t?t[e]:this.config[e]};var Ae=S;const Ts={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var Fs=Ts;const ye=typeof window!="undefined"?window:self,{setUrlImplementation:Es}=qe;Es(ye.URL),Ae.global=ye,Ae.statusTextMap=Fs,Ae.config=Object.assign(Ae.config,{Promise:ye.Promise,Request:ye.Request,Response:ye.Response,Headers:ye.Headers});var Os=Ae.createInstance();export default Os;
